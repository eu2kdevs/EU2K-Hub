<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="L√°sd a fi√≥kadataid, √°ll√≠tsd √°t a szem√©lyes be√°ll√≠t√°sokat, √©s l√°ss egy √∂sszefoglal√≥t a heti teljes√≠tm√©nyedr≈ël.">
  <title data-translate="pages.account.title">Fi√≥k</title>
  <script>
    (function(){
      if (!document.getElementById('eu2k-page-overlay')) {
        var o = document.createElement('div');
        o.id = 'eu2k-page-overlay';
        o.style.cssText = 'position:fixed;inset:0;z-index:9999;background:#0B0F0B;border-radius:32px;opacity:1;transition:opacity 300ms ease-in-out;';
        var inner = document.createElement('div');
        inner.style.cssText = 'position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#0B0F0B;border-radius:32px;';
        var m = document.createElement('div');
        m.id = 'eu2k-overlay-mount';
        m.style.cssText = 'position:relative;width:100%;height:100%';
        inner.appendChild(m);
        o.appendChild(inner);
        document.documentElement.appendChild(o);
      }
    })();
  </script>
  <script src="/EU2K-Hub/assets/js/page-overlay-loader.js"></script>
  <link rel="stylesheet" href="account.css">
  <link rel="icon" href="/EU2K-Hub/favicon.ico">
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script src="/EU2K-Hub/assets/js/permissions.js"></script>
  <script src="/EU2K-Hub/assets/js/translations.js"></script>
  <script src="/EU2K-Hub/assets/js/welcome-screen.js"></script>
  <script src="/EU2K-Hub/assets/js/auth-state.js"></script>
  <script src="/EU2K-Hub/assets/js/test_firebase.js"></script>
  <script src="/EU2K-Hub/assets/js/firebase-performance.js"></script>
  <script src="/EU2K-Hub/assets/js/first-input-delay.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, OAuthProvider, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { doc, getDoc, setDoc, collection, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Make db and auth globally available
    window.db = db;
    window.auth = auth;

    // Import Firestore debug module
    import('./assets/js/firestore-debug.js').catch(err => {
      console.warn('Firestore debug module not loaded:', err);
    });

    // Initialize OAuth providers
    const msProvider = new OAuthProvider('microsoft.com');
    msProvider.setCustomParameters({
      tenant: 'organizations'
    });
    msProvider.addScope('https://graph.microsoft.com/User.Read');
    msProvider.addScope('https://graph.microsoft.com/User.ReadBasic.All');

    const googleProvider = new GoogleAuthProvider();
    googleProvider.addScope('profile');
    googleProvider.addScope('email');

    // Bejelentkez√©si funkci√≥k
    window.startMicrosoftSignIn = async () => {
      try {
        console.log('ü™ü Microsoft bejelentkez√©s ind√≠t√°sa...');
        const result = await signInWithPopup(auth, msProvider);
        console.log('‚úÖ Microsoft bejelentkez√©s sikeres:', result.user);
        await handleSuccessfulLogin(result.user, 'microsoft');
      } catch (error) {
        console.error('‚ùå Microsoft bejelentkez√©si hiba:', error);
        alert('Microsoft bejelentkez√©si hiba: ' + error.message);
      }
    };

    window.startGoogleSignIn = async () => {
      try {
        console.log('üîç Google bejelentkez√©s ind√≠t√°sa...');
        const result = await signInWithPopup(auth, googleProvider);
        console.log('‚úÖ Google bejelentkez√©s sikeres:', result.user);
        await handleSuccessfulLogin(result.user, 'google');
      } catch (error) {
        console.error('‚ùå Google bejelentkez√©si hiba:', error);
        alert('Google bejelentkez√©si hiba: ' + error.message);
      }
    };

    // Sikeres bejelentkez√©s kezel√©se
    async function handleSuccessfulLogin(user, provider) {
      try {
        // API adatok lek√©r√©se √©s t√°rol√°sa
        await fetchAndStoreUserData(user, provider);
        
        // Ellen≈ërizz√ºk, hogy l√©tezik-e m√°r a felhaszn√°l√≥ a Firestore-ban
        const userDocRef = doc(db, 'users', user.uid);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          // Megl√©v≈ë felhaszn√°l√≥ - norm√°l bejelentkez√©s
          console.log('‚úÖ Megl√©v≈ë felhaszn√°l√≥ bejelentkeztet√©se');
          await updateUserProfile(); // Friss√≠tj√ºk a profil adatokat
          window.location.reload(); // Friss√≠tj√ºk az oldalt a bejelentkezett √°llapot megjelen√≠t√©s√©hez
        } else {
          // √öj felhaszn√°l√≥ - √°tir√°ny√≠t√°s onboarding-ra
          console.log('üÜï √öj felhaszn√°l√≥ - √°tir√°ny√≠t√°s onboarding-ra');
          await redirectToOnboarding(user, provider);
        }
      } catch (error) {
        console.error('‚ùå Bejelentkez√©s ut√°ni feldolgoz√°si hiba:', error);
        alert('Hiba t√∂rt√©nt a bejelentkez√©s feldolgoz√°sa sor√°n.');
      }
    }
    
    // Felhaszn√°l√≥i adatok lek√©r√©se √©s t√°rol√°sa
    async function fetchAndStoreUserData(user, provider) {
      try {
        if (provider === 'microsoft') {
          // Microsoft Graph API adatok lek√©r√©se
          const accessToken = await user.getIdToken();
          const graphResponse = await fetch('https://graph.microsoft.com/v1.0/me', {
            headers: {
              'Authorization': `Bearer ${accessToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (graphResponse.ok) {
            const graphData = await graphResponse.json();
            localStorage.setItem('eu2k-graph-data', JSON.stringify(graphData));
            console.log('‚úÖ Microsoft Graph adatok mentve:', graphData);
          }
        } else if (provider === 'google') {
          // Google API adatok t√°rol√°sa
          const googleData = {
            displayName: user.displayName,
            email: user.email,
            photoURL: user.photoURL
          };
          localStorage.setItem('eu2k-google-data', JSON.stringify(googleData));
          console.log('‚úÖ Google adatok mentve:', googleData);
        }
      } catch (error) {
        console.error('‚ùå Felhaszn√°l√≥i adatok lek√©r√©si hiba:', error);
      }
    }
    
    // Profil adatok friss√≠t√©se
    async function updateUserProfile() {
      try {
        const graphData = localStorage.getItem('eu2k-graph-data');
        const googleData = localStorage.getItem('eu2k-google-data');
        
        // DOM elemek lek√©r√©se
        const nameElement = document.querySelector('.user-name');
        const emailElement = document.querySelector('.detail-item span');
        const classElement = document.querySelector('.detail-item:last-child span');
        const avatarElement = document.querySelector('.avatar');
        
        if (graphData) {
          const data = JSON.parse(graphData);
          
          // N√©v friss√≠t√©se
          if (nameElement) nameElement.textContent = data.displayName || 'Tur√≥czi √Åd√°m';
          
          // Email friss√≠t√©se
          if (emailElement) emailElement.textContent = data.mail || 'turoczi.adam@europa2000.hu';
          
          // Oszt√°ly kisz√°m√≠t√°sa √©s friss√≠t√©se
          if (classElement && data.jobTitle) {
            const hasNumber = /\d/.test(data.jobTitle);
            if (hasNumber) {
              const currentYear = new Date().getFullYear();
              const match = data.jobTitle.match(/(\d{4})([A-Z]?)/);
              if (match) {
                const graduationYear = parseInt(match[1]);
                const classLetter = match[2] || '';
                const grade = Math.max(7, Math.min(12, 19 - (graduationYear - currentYear)));
                classElement.textContent = `${grade}.${classLetter} Oszt√°ly`;
              }
            } else {
              classElement.textContent = data.jobTitle;
            }
          }
          
          // Profilk√©p friss√≠t√©se Microsoft Graph API alapj√°n
          await updateProfilePicture('microsoft', data.id);
          
        } else if (googleData) {
          const data = JSON.parse(googleData);
          
          // N√©v friss√≠t√©se (vezet√©kn√©v + keresztn√©v sorrendben)
          if (nameElement && data.displayName) {
            const nameParts = data.displayName.split(' ');
            if (nameParts.length >= 2) {
              // Felt√©telezz√ºk, hogy az els≈ë r√©sz a keresztn√©v, a t√∂bbi a vezet√©kn√©v
              const firstName = nameParts[0];
              const lastName = nameParts.slice(1).join(' ');
              nameElement.textContent = `${lastName} ${firstName}`;
            } else {
              nameElement.textContent = data.displayName;
            }
          }
          
          // Email friss√≠t√©se
          if (emailElement) emailElement.textContent = data.email || 'turoczi.adam@europa2000.hu';
          
          // Logo friss√≠t√©se email domain alapj√°n
          updateAccountLogo(data.email || 'turoczi.adam@europa2000.hu');
          
          // Sz√ºl≈ëi fi√≥k jobtitle kezel√©se
          if (classElement) {
            // Ellen≈ërizz√ºk, hogy van-e student_name a Firestore-ban
            const currentUser = auth.currentUser;
            if (currentUser) {
              const userDocRef = doc(db, 'users', currentUser.uid);
              getDoc(userDocRef).then(userDoc => {
                if (userDoc.exists()) {
                  const userData = userDoc.data();
                  const studentName = userData.general_data?.general?.student_name;
                  
                  if (studentName) {
                    classElement.textContent = `${studentName} Sz√ºl≈ëje`;
                  } else {
                    classElement.textContent = 'Sz√ºl≈ë';
                  }
                } else {
                  classElement.textContent = 'Sz√ºl≈ë';
                }
              }).catch(error => {
                console.error('‚ùå Firestore lek√©r√©si hiba:', error);
                classElement.textContent = 'Sz√ºl≈ë';
              });
            } else {
              classElement.textContent = 'Sz√ºl≈ë';
            }
          }
          
          // Profilk√©p friss√≠t√©se Google alapj√°n
          await updateProfilePicture('google', null, data.photoURL);
        }
      } catch (error) {
        console.error('‚ùå Profil friss√≠t√©si hiba:', error);
      }
    }
    
    // Account logo friss√≠t√©se email domain alapj√°n
    function updateAccountLogo(email) {
      const logoElement = document.querySelector('.school-logo');
      if (!logoElement || !email) return;
      
      const domain = email.split('@')[1]?.toLowerCase();
      let logoPath = '/EU2K-Hub/assets/account/eu2k_logo.png'; // Default
      let altText = 'EU2K Logo';
      
      // Email domain alap√∫ logo meghat√°roz√°s
      if (domain === 'gmail.com') {
        logoPath = '/EU2K-Hub/assets/account/google.png';
        altText = 'Google Logo';
      } else if (domain === 'citronmail.hu') {
        logoPath = '/EU2K-Hub/assets/account/citronmail.png';
        altText = 'Citronmail Logo';
      } else if (['outlook.com', 'outlook.hu', 'hotmail.com', 'hotmail.hu'].includes(domain)) {
        logoPath = '/EU2K-Hub/assets/account/microsoft.png';
        altText = 'Microsoft Logo';
      } else if (domain === 'icloud.com') {
        logoPath = '/EU2K-Hub/assets/account/apple.png';
        altText = 'Apple Logo';
      } else if (domain === 'yahoo.com') {
        logoPath = '/EU2K-Hub/assets/account/yahoo.png';
        altText = 'Yahoo Logo';
      } else if (domain === 'freemail.hu') {
        logoPath = '/EU2K-Hub/assets/account/freemail.png';
        altText = 'Freemail Logo';
      }
      
      logoElement.src = logoPath;
      logoElement.alt = altText;
      
      console.log(`üé® Logo friss√≠tve: ${domain} ‚Üí ${logoPath}`);
    }
    
    // Profilk√©p friss√≠t√©se
    async function updateProfilePicture(provider, userId, photoURL = null) {
      try {
        const avatarElement = document.querySelector('.avatar');
        if (!avatarElement) return;
        
        // Ellen≈ërizz√ºk a useProvidedPfp be√°ll√≠t√°st a Firestore-b√≥l
        const currentUser = auth.currentUser;
        if (currentUser) {
          const userDocRef = doc(db, 'users', currentUser.uid);
          const userDoc = await getDoc(userDocRef);
          
          if (userDoc.exists()) {
            const userData = userDoc.data();
            const generalData = userData.general_data?.general;
            const userType = generalData?.user_type;
            
            // Di√°k √©s tan√°r eset√©n alap√©rtelmezetten iskolai profilk√©p pr√≥b√°l√°sa
            if ((userType === 'student' || userType === 'teacher') && provider === 'microsoft') {
              try {
                // Microsoft Graph API profilk√©p pr√≥b√°l√°sa
                const graphPhotoUrl = `https://graph.microsoft.com/v1.0/me/photo/$value`;
                const img = new Image();
                img.onload = () => {
                  avatarElement.src = graphPhotoUrl;
                };
                img.onerror = () => {
                  // Ha nincs iskolai profilk√©p, magenta.png
                  avatarElement.src = '/EU2K-Hub/assets/avatars/magenta.png';
                };
                img.src = graphPhotoUrl;
                return;
              } catch (error) {
                console.log('Nincs el√©rhet≈ë iskolai profilk√©p');
                avatarElement.src = '/EU2K-Hub/assets/avatars/magenta.png';
                return;
              }
            }
            
            // Sz√ºl≈ë vagy egy√©b esetben a be√°ll√≠t√°sok alapj√°n
            if (generalData?.useProvidedPfp === true) {
              // El≈ësz√∂r pr√≥b√°ljuk a Firestore-b√≥l mentett profil URL-j√©t
              if (generalData.profilePictureUrl) {
                avatarElement.src = generalData.profilePictureUrl;
              } else {
                // API-b√≥l sz√°rmaz√≥ profilk√©p haszn√°lata
                if (provider === 'microsoft') {
                  // Microsoft Graph API profilk√©p
                  const graphPhotoUrl = `https://graph.microsoft.com/v1.0/me/photo/$value`;
                  avatarElement.src = graphPhotoUrl;
                } else if (provider === 'google' && photoURL) {
                  // Google profilk√©p
                  avatarElement.src = photoURL;
                }
              }
            } else {
              // Preset avatar haszn√°lata
              const pfpColor = generalData?.pfpColor || 'magenta';
              avatarElement.src = `/EU2K-Hub/assets/avatars/${pfpColor}.png`;
            }
          } else {
            // Ha nincs Firestore dokumentum, alap√©rtelmezett magenta avatar
            avatarElement.src = '/EU2K-Hub/assets/avatars/magenta.png';
          }
        }
      } catch (error) {
        console.error('‚ùå Profilk√©p friss√≠t√©si hiba:', error);
        // Fallback magenta avatar
        const avatarElement = document.querySelector('.avatar');
        if (avatarElement) {
          avatarElement.src = '/EU2K-Hub/assets/avatars/magenta.png';
        }
      }
    }

    // √Åtir√°ny√≠t√°s onboarding-ra felhaszn√°l√≥ t√≠pus szerint
    async function redirectToOnboarding(user, provider) {
      try {
        let userType = 'student'; // default
        
        if (provider === 'microsoft') {
          // Microsoft Graph API adatok haszn√°lata
          const graphData = localStorage.getItem('eu2k-graph-data');
          if (graphData) {
            const data = JSON.parse(graphData);
            if (data.jobTitle) {
              // JobTitle alap√∫ eld√∂nt√©s: ha van sz√°m ‚Üí di√°k, ha nincs ‚Üí tan√°r
              if (/\d/.test(data.jobTitle)) {
                userType = 'student';
              } else {
                userType = 'teacher';
              }
            }
          }
        } else if (provider === 'google') {
          // Google fi√≥k ‚Üí sz√ºl≈ëi profil
          userType = 'parent';
        }
        
        // √Åtir√°ny√≠t√°s a megfelel≈ë onboarding oldalra
        let redirectUrl = '/EU2K-Hub/welcome/onboarding_student.html';
        if (userType === 'teacher') {
          redirectUrl = '/EU2K-Hub/welcome/onboarding_teacher.html';
        } else if (userType === 'parent') {
          redirectUrl = '/EU2K-Hub/welcome/onboarding_parent.html';
        }
        
        console.log(`üîÑ √Åtir√°ny√≠t√°s ${userType} onboarding-ra: ${redirectUrl}`);
        window.location.href = redirectUrl;
        
      } catch (error) {
        console.error('‚ùå Onboarding √°tir√°ny√≠t√°si hiba:', error);
        // Fallback - alap√©rtelmezett di√°k onboarding
        window.location.href = '/EU2K-Hub/welcome/onboarding_student.html';
      }
    }

    // Delete confirmation popup functions
    window.showDeleteConfirmation = function() {
      document.getElementById('delete-confirmation-popup').style.display = 'flex';
    };

    window.hideDeleteConfirmation = function() {
      document.getElementById('delete-confirmation-popup').style.display = 'none';
    };

    // Adatok t√∂rl√©se funkci√≥
    window.confirmDeleteUserData = async function() {
      try {
        const currentUser = auth.currentUser;
        if (!currentUser) {
          console.error('‚ùå Nincs bejelentkezett felhaszn√°l√≥');
          return;
        }

        // Firestore dokumentum t√∂rl√©se
        const userDocRef = doc(db, 'users', currentUser.uid);
        await deleteDoc(userDocRef);
        console.log('‚úÖ Firestore dokumentum t√∂r√∂lve');

        // LocalStorage teljes t√∂rl√©se
        localStorage.removeItem('eu2k-graph-data');
        localStorage.removeItem('eu2k-google-data');
        localStorage.removeItem('GDPR_REMOVAL_FLAG');
        localStorage.removeItem('eu2k-auth-start-time');
        localStorage.removeItem('eu2k-debug-logs');
        localStorage.removeItem('eu2k-auth-logged-in');
        localStorage.removeItem('eu2k-auth-display-name');
        localStorage.removeItem('eu2k-onboarding-target');
        localStorage.removeItem('termsAccepted');
        console.log('‚úÖ LocalStorage teljesen t√∂r√∂lve');

        // Kijelentkez√©s
        await auth.signOut();
        console.log('‚úÖ Kijelentkez√©s sikeres');

        // √Åtir√°ny√≠t√°s az onboarding els≈ë l√©p√©s√©re
        window.location.href = '/EU2K-Hub/welcome/onboarding_student.html#step1';
      } catch (error) {
        console.error('‚ùå Adatok t√∂rl√©si hiba:', error);
        alert('Hiba t√∂rt√©nt az adatok t√∂rl√©se sor√°n. Pr√≥b√°ld √∫jra!');
      }
    };
    
    // Kijelentkez√©s funkci√≥
    window.logoutUser = async function() {
      try {
        const { getAuth, signOut } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const auth = getAuth();
        
        await signOut(auth);
        console.log('‚úÖ Kijelentkez√©s sikeres');
        
        // √Åtir√°ny√≠t√°s a f≈ëoldalra
        window.location.href = '/EU2K-Hub/';
      } catch (error) {
        console.error('‚ùå Kijelentkez√©si hiba:', error);
        alert('Hiba t√∂rt√©nt a kijelentkez√©s sor√°n. Pr√≥b√°ld √∫jra!');
      }
    };
  </script>
  <!-- Duplik√°lt footer st√≠lus elt√°vol√≠tva -->
</head>

<body>
  <div class="app-bg">
    <aside class="sidebar">
      <nav class="nav-menu">
        <a class="nav-item" href="/EU2K-Hub/index.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/home_icon.svg" class="nav-icon" alt="Otthon">
          </div>
          <span data-translate="navigation.home">Otthon</span>
        </a>
        <a class="nav-item" href="/EU2K-Hub/qr-code.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/qr_code_icon.svg" class="nav-icon" alt="QR-K√≥d">
          </div>
          <span data-translate="navigation.qr">QR-K√≥d</span>
        </a>
        <a class="nav-item" href="/EU2K-Hub/youhub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/youhub_icon.svg" class="nav-icon" alt="YouHub">
          </div>
          <span data-translate="navigation.youhub">YouHub</span>
        </a>
        <a class="nav-item" href="/EU2K-Hub/event_hub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/event_hub_icon.svg" class="nav-icon" alt="Event Hub">
          </div>
          <span data-translate="navigation.event_hub">Event Hub</span>
        </a>
      </nav>
    </aside>
    <main class="main-area">
      <div class="main-content">
        <header class="header">
          <div class="header-icons">
            <a href="/EU2K-Hub/settings/settings.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/settings_icon.svg" class="header-icon" alt="Settings">
            </a>
          </div>
        </header>
        <div id="logged-out-view" class="account-container" style="display: none;">
          <img src="/EU2K-Hub/assets/account_icon.svg" class="account-icon" alt="Fi√≥k">
          <h1 class="account-title" data-translate="pages.account.title">Fi√≥k</h1>
          <p class="account-description" data-translate="pages.account.description_part1">
            Jelentkezz be az <strong>Iskolai fi√≥koddal</strong>, hogy hozz√°f√©rj elk√©peszt≈ë funkci√≥khoz, mint a <strong>Statisztik√°k</strong>, <strong>Szem√©lyes √ârtes√≠t√©sek</strong>, <strong>Javaslatok</strong>, <strong>Napt√°r</strong>, √©s m√©g sok m√°s. Vagy haszn√°ld a <strong>szem√©lyes fi√≥kod</strong>, ha sz√ºl≈ë vagy, √≠gy <strong>fel√ºgyelni</strong> tudod a gyermeked tev√©kenys√©g√©t a Hub-on!
          </p>
          
          <!-- √Åtir√°ny√≠t√°s onboarding-ra -->
          <div class="login-buttons-container" style="display: flex; flex-direction: column; gap: 12px; margin-top: 30px;">
            <button class="login-button microsoft-login" onclick="window.location.href='/EU2K-Hub/welcome/onboarding_student.html#step2'">
              <img src="/EU2K-Hub/assets/login.svg" class="login-icon" alt="Login">
              <span class="login-text" data-translate="account.login_button">Bejelentkez√©s</span>
            </button>
          </div>
        </div>
        <div id="logged-in-view" class="account-view" style="display: none;">
          <div class="left-column">
            <img src="/EU2K-Hub/assets/avatars/magenta.png" class="avatar" alt="Avatar">
            <h2 class="user-name">Tur√≥czi √Åd√°m</h2>
            <div class="account-type">
              <img src="/EU2K-Hub/assets/account/eu2k_logo.png" class="school-logo" alt="EU2K Logo">
              <span>Iskolai Fi√≥k</span>
            </div>
            <div class="user-details">
              <div class="detail-item">
                <img src="/EU2K-Hub/assets/account/email.svg" class="detail-icon" alt="Email">
                <span>turoczi.adam@europa2000.hu</span>
              </div>
              <div class="detail-item">
                <img src="/EU2K-Hub/assets/account/birthday.svg" class="detail-icon" alt="Birthday">
                <span>December 1.</span>
              </div>
              <div class="detail-item">
                <img src="/EU2K-Hub/assets/account/class.svg" class="detail-icon" alt="Class">
                <span>8.E Oszt√°ly</span>
              </div>
            </div>
            <button class="logout-button" onclick="logoutUser()">
              <img src="/EU2K-Hub/assets/logout.svg" class="logout-icon" alt="Kijelentkez√©s">
              <span>Kijelentkez√©s</span>
            </button>
            <button class="delete-data-button" onclick="showDeleteConfirmation()">
              <img src="/EU2K-Hub/assets/warning.svg" class="delete-icon" alt="Adatok t√∂rl√©se">
              <span>Adatok t√∂rl√©se</span>
            </button>
          </div>
          <div class="divider"></div>
          <div class="right-column">
            <div class="button-group">
              <a href="#" class="button-group-item active" data-page="messages" data-icon="messages">
                <img src="/EU2K-Hub/assets/account/messages.svg" class="button-group-icon" alt="√úzenetk√ºld√©s">
                <span data-translate="pages.account.nav_messages">√úzenetk√ºld√©s</span>
              </a>
              <a href="#" class="button-group-item" data-page="functions" data-icon="functions">
                <img src="/EU2K-Hub/assets/account/functions.svg" class="button-group-icon" alt="Funkci√≥k">
                <span data-translate="pages.account.nav_functions">Funkci√≥k</span>
              </a>
              <a href="#" class="button-group-item" data-page="security" data-icon="safety">
                <img src="/EU2K-Hub/assets/account/safety.svg" class="button-group-icon" alt="Biztons√°g √©s Fel√ºgyelet">
                <span data-translate="pages.account.nav_security">Biztons√°g √©s Fel√ºgyelet</span>
              </a>
            </div>
            <div id="messages-page" class="account-page active">
              <div class="card card-top">
                <span data-translate="pages.account.private_messages">Priv√°t √úzenetek</span>
                <md-switch icons disabled></md-switch>
              </div>
              <div class="card card-middle">
                <span data-translate="pages.account.who_can_message">Ki k√ºldhet neked √ºzeneteket?</span>
                <div class="notice">
                  <img src="/EU2K-Hub/assets/warning.svg" class="notice-icon" alt="Info">
                  <span data-translate="pages.account.message_notice">Ezt a be√°ll√≠t√°st csak te tudod m√≥dos√≠tani.</span>
                </div>
                <div class="radio-group">
                  <div class="radio-item">
                    <span data-translate="pages.account.everyone">Mindenki</span>
                    <md-radio disabled name="message-privacy" value="everyone"></md-radio>
                  </div>
                  <div class="radio-item">
                    <span data-translate="pages.account.nobody">Senki</span>
                    <md-radio disabled name="message-privacy" value="nobody"></md-radio>
                  </div>
                  <div class="radio-item">
                    <span data-translate="pages.account.classmates_only">Csak oszt√°lyt√°rsak</span>
                    <md-radio disabled name="message-privacy" value="classmates"></md-radio>
                  </div>
                </div>
              </div>
              <div class="card card-bottom">
                <div class="card-header">
                  <span data-translate="pages.account.word_filter">Sz√≥filter</span>
                  <md-switch icons disabled></md-switch>
                </div>
                <div class="textbox-container">
                  <textarea data-translate-placeholder="pages.account.word_filter_placeholder" disabled placeholder="Ide √≠rj... (vessz≈ëvel, √©s egy sz√≥k√∂zzel ut√°na v√°laszd el a szavakat)"></textarea>
                </div>
                <div class="notice-middle">
                  <img src="/EU2K-Hub/assets/settings_icons/notifications_page/info.svg" class="notice-icon" alt="Info">
                  <span data-translate="pages.account.word_filter_notice2">A Sz√≥filter a szavak s√∫lyoss√°ga, √©s t√∫lzott haszn√°latuk alapj√°n d√∂nt.</span>
                </div>
                <div class="notice-bottom">
                  <img src="/EU2K-Hub/assets/settings_icons/notifications_page/info.svg" class="notice-icon" alt="Info">
                  <span data-translate="pages.account.word_filter_notice">√çrd be, hogy Auto, √≠gy egy el≈ëre meg√≠rt list√°nyi szavak lesznek lesz≈±rve.</span>
                </div>
              </div>
            </div>
            <div id="functions-page" class="account-page">
              <div class="card card-top">
                <span data-translate="pages.account.ai_functions">AI Funkci√≥k</span>
                <md-switch icons selected id="functions-enabled-switch"></md-switch>
              </div>
              <div class="card card-middle">
                <span data-translate="pages.account.smart_help">Okos Seg√≠ts√©g:</span>
                <div class="notice-top">
                  <img src="/EU2K-Hub/assets/warning.svg" class="notice-icon" alt="Info">
                  <span data-translate="pages.account.ai_rec_stay_on">Aj√°nlott ezeket a funkci√≥kat bekapcsolva tartani.</span>
                </div>
                <div class="notice-bottom">
                  <img src="/EU2K-Hub/assets/settings_icons/notifications_page/info.svg" class="notice-icon" alt="Info">
                  <span data-translate="pages.account.ai_no_acc_notice">Ezen funkci√≥k haszn√°lat√°hoz nem kell bejelentkezned.</span>
                </div>
                <div class="radio-group">
                  <div class="radio-item">
                    <span data-translate="pages.account.ai_translation">AI Ford√≠t√°s v√°ltoz√≥ tartalmakn√°l</span>
                    <md-switch icons selected id="ai-translate-switch"></md-switch>
                  </div>
                  <div class="radio-item-bottom">
                    <span data-translate="pages.account.ai_correction">AI hibajav√≠t√°s a beviteli mez≈ëkben</span>
                    <md-switch icons selected id="ai-correction-switch"></md-switch>
                  </div>
                </div>
              </div>
              <div class="card card-bottom">
                <div class="card-header">
                  <span data-translate="pages.account.word_filter">Funkci√≥k ki √©s be kapcsol√°sa</span>
                  <md-switch icons disabled selected></md-switch>
                </div>
                <div class="card-inside card-inside-first">
                  <span data-translate="pages.account.word_filter_notice2">Event Hub</span>
                  <md-switch icons selected disabled></md-switch>
                </div>
                <div class="card-inside-with-description card-inside-middle">
                  <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span data-translate="pages.account.word_filter_notice2">Esem√©nynapt√°rak</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div style="margin-top: 8px; font-size: 0.9rem; color: #A0A0A0;">
                    <span data-translate="pages.account.word_filter_notice2">√ìrarend, Csenget√©si Rend, Dolgozat-el≈ërejelz≈ë</span>
                  </div>
                </div>
                <div class="card-inside-with-description card-inside-middle">
                  <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span data-translate="pages.account.word_filter_notice">K√∂zlem√©nyek</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div style="margin-top: 8px; font-size: 0.9rem; color: #A0A0A0;">
                    <span data-translate="pages.account.word_filter_notice">H√≠rek, Esem√©nyek, √öj Dolgok</span>
                  </div>
                </div>
                <div class="card-inside-2 card-inside-2-bottom">
                  <div class="card-header">
                    <span data-translate="pages.account.word_filter">YouHub</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div class="card-inside-inside card-inside-inside-first">
                    <span data-translate="pages.account.word_filter_notice">Class Hub a YouHubban</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div class="card-inside-inside card-inside-inside-middle">
                    <span data-translate="pages.account.word_filter_notice">√ârtes√≠t√©sek a YouHubban</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div class="card-inside-inside card-inside-inside-middle">
                    <span data-translate="pages.account.word_filter_notice">Javaslatok √©s Hive</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                  <div class="card-inside-inside card-inside-inside-last">
                    <span data-translate="pages.account.word_filter_notice">Napt√°r</span>
                    <md-switch icons selected disabled></md-switch>
                  </div>
                </div>
              </div>
            </div>
            <div id="security-page" class="account-page">
              <div class="card-supervision card-top">
                <span data-translate="pages.account.supervision_enabled">Fel√ºgyelet Enged√©lyez√©se</span>
                <md-switch id="supervision-enabled-switch" icons disabled></md-switch>
              </div>
              <div class="card card-middle">
                  <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span data-translate="pages.account.parent_notifications">Sz√ºl≈ëi √ârtes√≠t√©sek</span>
                    <md-switch id="parent-notifications-switch" icons disabled></md-switch>
                  </div>
                </div>
                <div class="card card-bottom">
                  <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span data-translate="pages.account.activity_monitoring">Aktivit√°s Figyel√©s</span>
                    <md-switch id="activity-monitoring-switch" icons disabled></md-switch>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
       <div id="site-footer" class="footer" aria-label="Site footer">
        <div class="footer-container">
          <div class="footer-left">
            <img src="/EU2K-Hub/EU2K-Hub/eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
          </div>
          <div class="footer-center">
            <a class="footer-privacy" data-translate="pages.index.privacy_policy" href="/EU2K-Hub/privacy_policy.html">Adatkezel√©si T√°j√©koztat√≥</a>
                <a class="footer-privacy" data-translate="pages.index.terms_of_service" href="/EU2K-Hub/terms_of_service.html">Haszn√°lati Felt√©telek</a>
          </div>
          <div class="footer-right">
            <img src="/EU2K-Hub/EU2K-Hub/eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
            <img src="/EU2K-Hub/EU2K-Hub/eu2k_dok_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Delete Confirmation Popup -->
  <div id="delete-confirmation-popup" class="popup-overlay" style="display: none;">
    <div class="popup-container">
      <div class="popup-content">
        <!-- Account ikon -->
        <img src="/EU2K-Hub/assets/account.svg" class="popup-icon" alt="Account">

        <!-- F≈ëc√≠m -->
        <h1 class="popup-title">Biztos ki szeretn√©d t√∂r√∂lni az adataidat?</h1>

        <!-- Le√≠r√°s -->
        <p class="popup-description">
          Ezzel ki fogsz jelentkezni √©s az adataid t√∂r√∂lve lesznek √∂r√∂kre, mindent √∫jra kell kezdened. Biztos folytatod?
        </p>

        <!-- Gombok -->
        <div class="popup-buttons">
          <button class="popup-button-secondary" onclick="hideDeleteConfirmation()">
            <span>M√©gse</span>
          </button>
          <button class="popup-button-primary" onclick="confirmDeleteUserData()">
            <span>Igen, t√∂rl√∂m</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Felhaszn√°l√≥i adatok bet√∂lt√©se Microsoft Graph/Google API-b√≥l
    async function loadUserData() {
      try {
        // Auth ellen≈ërz√©s
        const { getAuth, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const auth = getAuth();
        
        return new Promise((resolve) => {
          onAuthStateChanged(auth, async (user) => {
            if (user) {
              console.log('üîç Firebase user objektum:', {
                uid: user.uid,
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                providerData: user.providerData
              });
              
              let userData = {
                displayName: user.displayName || 'Ismeretlen Felhaszn√°l√≥',
                email: user.email || 'Nincs email',
                photoURL: user.photoURL || '/EU2K-Hub/assets/avatars/magenta.png',
                jobTitle: 'Di√°k', // Default
                accountType: 'Szem√©lyes Fi√≥k'
              };
              
              console.log('üìã Alap√©rtelmezett userData:', userData);
              
              // Firebase general_data lek√©r√©se a photoURL-√©rt
              try {
                const { doc, getDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
                const db = getFirestore();
                const generalRef = doc(db, 'users', user.uid, 'general_data', 'general');
                const generalDoc = await getDoc(generalRef);
                
                if (generalDoc.exists()) {
                  const generalData = generalDoc.data();
                  console.log('üìä Firebase general_data:', generalData);
                  
                  // PhotoURL haszn√°lata Firebase-b≈ël, ha el√©rhet≈ë √©s nem blob URL
                  if (generalData.photoURL && !generalData.photoURL.includes('blob:')) {
                    userData.photoURL = generalData.photoURL;
                    console.log('üñºÔ∏è PhotoURL bet√∂ltve Firebase-b≈ël:', userData.photoURL);
                  } else if (generalData.photoURL && generalData.photoURL.includes('blob:')) {
                    console.warn('‚ö†Ô∏è Blob URL √©szlelve Firebase-ben, kihagy√°s:', generalData.photoURL);
                    // Ne haszn√°ljuk a blob URL-t, hagyjuk az eredeti user.photoURL-t
                  }
                  
                  // Egy√©b adatok friss√≠t√©se Firebase-b≈ël
                  if (generalData.displayName) {
                    userData.displayName = generalData.displayName;
                  }
                  if (generalData.email) {
                    userData.email = generalData.email;
                  }
                  if (generalData.jobTitle) {
                    userData.jobTitle = generalData.jobTitle;
                  }
                  if (generalData.accountType) {
                    userData.accountType = generalData.accountType === 'school' ? 'Iskolai Fi√≥k' : 
                                         generalData.accountType === 'parent' ? 'Google Fi√≥k' : 
                                         generalData.accountType === 'teacher' ? 'Iskolai Fi√≥k' : 'Szem√©lyes Fi√≥k';
                  }
                } else {
                  console.log('‚ö†Ô∏è Nincs general_data dokumentum a Firebase-ben');
                }
              } catch (firebaseError) {
                console.error('‚ùå Firebase general_data lek√©r√©si hiba:', firebaseError);
              }

              // Microsoft Graph adatok lek√©r√©se
              if (user.providerData && user.providerData.some(p => p.providerId === 'microsoft.com')) {
                console.log('üîç Microsoft provider √©szlelve, Graph API h√≠v√°s...');
                try {
                  // Microsoft Graph token lek√©r√©se - Firebase ID token nem haszn√°lhat√≥ Microsoft Graph API-hoz
                  // Helyette haszn√°ljuk a user objektumb√≥l el√©rhet≈ë adatokat
                  console.log('‚ö†Ô∏è Microsoft Graph API token nem el√©rhet≈ë Firebase-b≈ël, alap√©rtelmezett adatok haszn√°lata');
                  
                  // Alap√©rtelmezett Microsoft adatok haszn√°lata
                  if (user.displayName) {
                    userData.displayName = user.displayName;
                  }
                  if (user.email) {
                    userData.email = user.email;
                  }
                  // Microsoft fi√≥kok eset√©n alap√©rtelmezett jobTitle
                  userData.jobTitle = userData.jobTitle || 'Di√°k';
                  userData.accountType = 'Iskolai Fi√≥k';
                  
                  // Microsoft photoURL haszn√°lata, ha el√©rhet≈ë √©s nem blob
                  if (user.photoURL && !user.photoURL.includes('blob:')) {
                    userData.photoURL = user.photoURL;
                    console.log('üñºÔ∏è Microsoft photoURL be√°ll√≠tva:', userData.photoURL);
                  } else {
                    console.warn('‚ö†Ô∏è Microsoft photoURL nem el√©rhet≈ë vagy blob URL');
                    userData.photoURL = '/EU2K-Hub/assets/avatars/magenta.png';
                  }
                  
                  console.log('‚úÖ Microsoft adatok bet√∂ltve (offline m√≥d):', userData);
                } catch (e) {
                  console.warn('‚ö†Ô∏è Microsoft Graph adatok lek√©r√©se sikertelen:', e);
                }
              }

              // Google API adatok lek√©r√©se (ha Google provider)
              if (user.providerData && user.providerData.some(p => p.providerId === 'google.com')) {
                console.log('üîç Google provider √©szlelve, People API h√≠v√°s...');
                try {
                  // Google People API haszn√°lata (ha el√©rhet≈ë)
                  const accessToken = await user.getIdToken();
                  if (accessToken) {
                    const peopleResponse = await fetch('https://people.googleapis.com/v1/people/me?personFields=names,emailAddresses,photos,organizations', {
                      headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                      }
                    });
                    
                    if (peopleResponse.ok) {
                      const peopleData = await peopleResponse.json();
                      console.log('üìä Google People API v√°lasz:', peopleData);
                      if (peopleData.names && peopleData.names[0]) {
                        userData.displayName = peopleData.names[0].displayName || userData.displayName;
                        console.log('üë§ N√©v friss√≠tve:', userData.displayName);
                      }
                      if (peopleData.emailAddresses && peopleData.emailAddresses[0]) {
                        userData.email = peopleData.emailAddresses[0].value || userData.email;
                        console.log('üìß Email friss√≠tve:', userData.email);
                      }
                      if (peopleData.photos && peopleData.photos[0]) {
                        // Google photoURL jav√≠t√°sa - blob URL elker√ºl√©se
                        const photoUrl = peopleData.photos[0].url;
                        if (photoUrl && !photoUrl.includes('blob:')) {
                          userData.photoURL = photoUrl;
                          console.log('üñºÔ∏è Google profilk√©p friss√≠tve:', userData.photoURL);
                        } else {
                          console.warn('‚ö†Ô∏è Google photo blob URL √©szlelve, user.photoURL haszn√°lata');
                          userData.photoURL = user.photoURL || '/EU2K-Hub/assets/avatars/magenta.png';
                        }
                      }
                      if (peopleData.organizations && peopleData.organizations[0]) {
                        userData.jobTitle = peopleData.organizations[0].title || userData.jobTitle;
                        console.log('üè¢ Szervezet/poz√≠ci√≥ friss√≠tve:', userData.jobTitle);
                      }
                      userData.accountType = userData.email.includes('@europa2000.hu') ? 'Iskolai Fi√≥k' : 'Google Fi√≥k';
                      console.log('‚úÖ Google People API adatok bet√∂ltve √©s alkalmazva:', userData);
                    } else {
                      console.warn('‚ùå Google People API hiba:', peopleResponse.status, peopleResponse.statusText);
                    }
                  }
                } catch (e) {
                  console.warn('‚ö†Ô∏è Google People API adatok lek√©r√©se sikertelen:', e);
                }
              }

              // Oszt√°ly meghat√°roz√°sa jobTitle alapj√°n √©s fi√≥k t√≠pus szerint
              // Ellen≈ërizz√ºk, hogy sz√ºl≈ëi fi√≥kr√≥l van-e sz√≥
              const isParentAccount = userData.email && !userData.email.includes('@europa2000.hu');
              
              if (isParentAccount) {
                // Sz√ºl≈ëi fi√≥kok eset√©n ne jelenjen meg oszt√°ly
                userData.jobTitle = 'Sz√ºl≈ë';
              } else if (userData.jobTitle && userData.jobTitle.match(/\d+\.[A-Z]/)) {
                userData.jobTitle = userData.jobTitle + ' Oszt√°ly';
              } else if (userData.jobTitle === 'Di√°k' || !userData.jobTitle) {
                userData.jobTitle = '8.E Oszt√°ly'; // Default csak iskolai fi√≥kok eset√©n
              }
              
              // Logo friss√≠t√©se email domain alapj√°n
              try {
                // updateAccountLogo f√ºggv√©ny helyett egyszer≈± logo be√°ll√≠t√°s
                if (userData.email && userData.email.includes('@europa2000.hu')) {
                  console.log('üé® Europa2000 domain √©szlelve, megfelel≈ë logo be√°ll√≠t√°sa');
                  // Itt lehetne logo logika, de most csak logoljuk
                } else {
                  console.log('üé® K√ºls≈ë domain, alap√©rtelmezett logo');
                }
                console.log('üé® Account logo friss√≠t√©s sikeres');
              } catch (logoError) {
                console.error('‚ùå Account logo friss√≠t√©si hiba:', logoError);
              }
              
              console.log('üéØ V√©gs≈ë userData objektum:', userData);

              resolve(userData);
            } else {
              console.log('‚ùå Nincs bejelentkezett felhaszn√°l√≥');
              resolve(null);
            }
          });
        });
      } catch (e) {
        console.error('‚ö†Ô∏è Felhaszn√°l√≥i adatok bet√∂lt√©se sikertelen:', e);
        return null;
      }
    }

    // Felhaszn√°l√≥i profil friss√≠t√©se Firebase-ben
    async function updateUserProfile() {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, setDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        
        if (!user) {
          console.log('‚ùå Nincs bejelentkezett felhaszn√°l√≥ a profil friss√≠t√©shez');
          return;
        }

        console.log('üîÑ Profil friss√≠t√©s kezd√©se Firebase-ben...');
        
        // Felhaszn√°l√≥i adatok √∂sszegy≈±jt√©se
        const userData = await loadUserData();
        if (!userData) {
          console.log('‚ùå Nem siker√ºlt bet√∂lteni a felhaszn√°l√≥i adatokat');
          return;
        }

        // Profil adatok objektum l√©trehoz√°sa
        const profileData = {
          displayName: userData.displayName || user.displayName || '',
          email: userData.email || user.email || '',
          jobTitle: userData.jobTitle || 'Di√°k', // Fix: jobTitle ment√©se
          accountType: userData.accountType || 'Szem√©lyes Fi√≥k',
          photoURL: userData.photoURL || user.photoURL || '', // Fix: photoURL ment√©se Microsoft/Google linkkel
          lastUpdated: new Date().toISOString(),
          uid: user.uid
        };

        // Microsoft Graph photoURL jav√≠t√°sa
        if (user.providerData && user.providerData.some(p => p.providerId === 'microsoft.com')) {
          try {
            // Microsoft Graph photo URL lek√©r√©se
            const accessToken = await user.getIdToken();
            if (accessToken) {
              const photoResponse = await fetch('https://graph.microsoft.com/v1.0/me/photo/$value', {
                headers: {
                  'Authorization': `Bearer ${accessToken}`
                }
              });
              
              if (photoResponse.ok) {
                // Microsoft Graph photo URL haszn√°lata blob helyett
                profileData.photoURL = `https://graph.microsoft.com/v1.0/me/photo/$value`;
                console.log('üñºÔ∏è Microsoft Graph photoURL be√°ll√≠tva:', profileData.photoURL);
              }
            }
          } catch (e) {
            console.warn('‚ö†Ô∏è Microsoft Graph photo lek√©r√©se sikertelen:', e);
          }
        }

        // Google photoURL jav√≠t√°sa
        if (user.providerData && user.providerData.some(p => p.providerId === 'google.com')) {
          if (user.photoURL && !user.photoURL.includes('blob:')) {
            profileData.photoURL = user.photoURL;
            console.log('üñºÔ∏è Google photoURL be√°ll√≠tva:', profileData.photoURL);
          }
        }

        console.log('üíæ Profil adatok ment√©se:', profileData);

        // Profil adatok ment√©se Firebase-be
        const userDocRef = doc(db, 'users', user.uid, 'general_data', 'general');
        await setDoc(userDocRef, profileData, { merge: true });
        
        console.log('‚úÖ Profil sikeresen friss√≠tve Firebase-ben');
        
      } catch (error) {
        console.error('‚ùå Profil friss√≠t√©si hiba:', error);
      }
    }

    // UI friss√≠t√©se a bet√∂lt√∂tt adatokkal
    function updateUserInterface(userData) {
      if (!userData) {
        console.log('‚ùå Nincs userData az UI friss√≠t√©shez');
        return;
      }
      
      console.log('üîÑ UI friss√≠t√©s kezd√©se:', userData);

      // Avatar friss√≠t√©se
      const avatarImg = document.querySelector('.avatar');
      if (avatarImg && userData.photoURL) {
        console.log('üñºÔ∏è Avatar friss√≠t√©se:', userData.photoURL);
        avatarImg.src = userData.photoURL;
        avatarImg.onerror = () => {
          console.log('‚ö†Ô∏è Avatar bet√∂lt√©si hiba, fallback haszn√°lata');
          avatarImg.src = '/EU2K-Hub/assets/avatars/magenta.png'; // Fallback
        };
      } else {
        console.log('‚ùå Avatar elem nem tal√°lhat√≥ vagy nincs photoURL');
      }

      // N√©v friss√≠t√©se
      const userNameEl = document.querySelector('.user-name');
      if (userNameEl) {
        console.log('üë§ Felhaszn√°l√≥n√©v friss√≠t√©se:', userData.displayName);
        userNameEl.textContent = userData.displayName;
      } else {
        console.log('‚ùå .user-name elem nem tal√°lhat√≥');
      }

      // Fi√≥k t√≠pus friss√≠t√©se
      const accountTypeEl = document.querySelector('.account-type span');
      if (accountTypeEl) {
        console.log('üè∑Ô∏è Fi√≥k t√≠pus friss√≠t√©se:', userData.accountType);
        accountTypeEl.textContent = userData.accountType;
      } else {
        console.log('‚ùå .account-type span elem nem tal√°lhat√≥');
      }

      // Email friss√≠t√©se
      const emailEl = document.querySelector('.detail-item span');
      if (emailEl) {
        console.log('üìß Email friss√≠t√©se:', userData.email);
        emailEl.textContent = userData.email;
      } else {
        console.log('‚ùå .detail-item span elem nem tal√°lhat√≥');
      }

      // Oszt√°ly friss√≠t√©se
      const classEl = document.querySelectorAll('.detail-item span')[2];
      if (classEl) {
        console.log('üéì Oszt√°ly/poz√≠ci√≥ friss√≠t√©se:', userData.jobTitle);
        classEl.textContent = userData.jobTitle;
      } else {
        console.log('‚ùå Harmadik .detail-item span elem nem tal√°lhat√≥');
      }

      console.log('‚úÖ UI friss√≠t√©s befejezve');
    }

    document.addEventListener('DOMContentLoaded', async function () {
      const loggedOutView = document.getElementById('logged-out-view');
      const loggedInView = document.getElementById('logged-in-view');

      // Firebase auth state ellen≈ërz√©s
      const { getAuth, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
      const auth = getAuth();
      
      onAuthStateChanged(auth, async (user) => {
        console.log('üîÑ Auth state v√°ltoz√°s √©szlelve:', user ? 'Bejelentkezve' : 'Kijelentkezve');
        
        if (user) {
          console.log('‚úÖ Felhaszn√°l√≥ bejelentkezve, UI v√°lt√°s logged-in view-ra');
          // Bejelentkezett felhaszn√°l√≥ - logged-in view megjelen√≠t√©se
          loggedOutView.style.display = 'none';
          loggedInView.style.display = 'flex';
          
          console.log('üìä Felhaszn√°l√≥i adatok bet√∂lt√©se kezd√©se...');
          // Felhaszn√°l√≥i adatok bet√∂lt√©se √©s UI friss√≠t√©se
          const userData = await loadUserData();
          if (userData) {
            console.log('‚úÖ UserData bet√∂ltve, UI friss√≠t√©s kezd√©se');
            updateUserInterface(userData);
          } else {
            console.log('‚ùå UserData bet√∂lt√©se sikertelen');
          }
          
          console.log('üîÑ Firestore profil friss√≠t√©s kezd√©se...');
          // Profil adatok friss√≠t√©se Firestore-b√≥l
          await updateUserProfile();
          console.log('‚úÖ Firestore profil friss√≠t√©s befejezve');
          
          console.log('üîÑ Settings adatok bet√∂lt√©se √©s UI szinkroniz√°l√°s...');
          // Settings adatok bet√∂lt√©se √©s UI friss√≠t√©se
          await loadAndApplySettings();
          console.log('‚úÖ Settings adatok bet√∂ltve √©s alkalmazva');
        } else {
          console.log('‚ùå Nincs bejelentkezve, UI v√°lt√°s logged-out view-ra');
          // Nincs bejelentkezett felhaszn√°l√≥ - logged-out view megjelen√≠t√©se
          loggedOutView.style.display = 'flex';
          loggedInView.style.display = 'none';
        }
      });

      // Button Group Logic
      // Hashtag navigation
      const navButtons = document.querySelectorAll('.button-group-item');
      const pages = document.querySelectorAll('.account-page');

      function showPage(pageId) {
        pages.forEach(page => {
          page.classList.remove('active');
        });
        document.getElementById(pageId + '-page').classList.add('active');

        navButtons.forEach(button => {
          button.classList.remove('active');
          if (button.dataset.page === pageId) {
            button.classList.add('active');
          }
        });
        updateBorderRadius();
      }

      navButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          const pageId = this.dataset.page;
          location.hash = pageId;
        });
      });
      
      function updateBorderRadius() {
        navButtons.forEach((button, index) => {
          button.classList.remove('btn-first', 'btn-middle', 'btn-last');

          if (index === 0) {
            button.classList.add('btn-first');
          } else if (index === navButtons.length - 1) {
            button.classList.add('btn-last');
          } else {
            button.classList.add('btn-middle');
          }
        });
      }

      window.addEventListener('hashchange', () => {
        const pageId = location.hash.substring(1) || 'messages';
        showPage(pageId);
      });

      // Initial page load
      const initialPage = location.hash.substring(1) || 'messages';
      showPage(initialPage);

      // Radio button logic
      const radioButtons = document.querySelectorAll('md-radio[name="message-privacy"]');
      radioButtons.forEach(radio => {
        radio.addEventListener('click', function() {
          radioButtons.forEach(r => r.checked = false);
          this.checked = true;
        });
      });

      // Bejelentkez√©si gombok event listenerei
      const microsoftBtn = document.getElementById('account-microsoft-signin');
      const office365Btn = document.getElementById('account-office365-signin');
      const googleBtn = document.getElementById('account-google-signin');
      
      if (microsoftBtn) {
        microsoftBtn.addEventListener('click', () => {
          if (window.startMicrosoftSignIn) {
            window.startMicrosoftSignIn();
          }
        });
      }
      
      if (office365Btn) {
        office365Btn.addEventListener('click', () => {
          if (window.startMicrosoftSignIn) {
            window.startMicrosoftSignIn(); // Office 365 is ugyanaz mint Microsoft
          }
        });
      }
      
      if (googleBtn) {
        googleBtn.addEventListener('click', () => {
          if (window.startGoogleSignIn) {
            window.startGoogleSignIn();
          }
        });
      }

      // Manually trigger translation for the newly added elements
      if (window.translationManager) {
        window.translationManager.applyTranslations();
      }

      // Adatok t√∂rl√©se gomb funkcionalit√°s
      const deleteDataBtn = document.getElementById('delete-data-btn');
      if (deleteDataBtn) {
        deleteDataBtn.addEventListener('click', async function() {
          try {
            // Onboarding t√∂rl≈ë k√©perny≈ë megjelen√≠t√©se
            const confirmDelete = confirm('Biztosan t√∂r√∂lni szeretn√©d az √∂sszes adatodat? Ez a m≈±velet visszavonhatatlan!');
            if (!confirmDelete) return;

            // M√°sodik meger≈ës√≠t√©s
            const finalConfirm = confirm('Utols√≥ figyelmeztet√©s: Az √∂sszes adatod v√©glegesen t√∂rl≈ëdni fog. Folytatod?');
            if (!finalConfirm) return;

            // Firestore user dokumentum t√∂rl√©se
            const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
            const { doc, deleteDoc, collection, getDocs, query } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
            const auth = getAuth();
            const user = auth.currentUser;

            if (user && window.db) {
              // Felhaszn√°l√≥ √∂sszes dokumentum√°nak t√∂rl√©se
              const userDocRef = doc(window.db, 'users', user.uid);
              
              // Alkollekci√≥k t√∂rl√©se (general_data, settings, stb.)
              const subCollections = ['general_data', 'settings', 'notifications', 'messages'];
              for (const subCol of subCollections) {
                try {
                  const subColRef = collection(window.db, 'users', user.uid, subCol);
                  const subDocs = await getDocs(subColRef);
                  for (const subDoc of subDocs.docs) {
                    await deleteDoc(subDoc.ref);
                  }
                  console.log(`‚úÖ ${subCol} alkollekci√≥ t√∂r√∂lve`);
                } catch (e) {
                  console.warn(`‚ö†Ô∏è ${subCol} alkollekci√≥ t√∂rl√©se sikertelen:`, e);
                }
              }

              // F≈ë user dokumentum t√∂rl√©se
              await deleteDoc(userDocRef);
              console.log('‚úÖ Felhaszn√°l√≥i dokumentum t√∂r√∂lve');

              // LocalStorage t√∂rl√©se
              localStorage.removeItem('schoolAccount');
              localStorage.removeItem('publicAccount');
              localStorage.removeItem('onboardingCompleted');
              localStorage.removeItem('termsAccepted');
              localStorage.removeItem('eu2k-auth-display-name');
              localStorage.removeItem('welcomeScreenVisited');
              console.log('‚úÖ LocalStorage t√∂r√∂lve');

              // Kijelentkeztet√©s
              await auth.signOut();
              console.log('‚úÖ Kijelentkeztet√©s sikeres');

              // Visszair√°ny√≠t√°s onboarding Step 1-re
              alert('Az adatok sikeresen t√∂r√∂lve lettek. Visszair√°ny√≠t√°s az onboarding folyamatra.');
              window.location.href = '/EU2K-Hub/welcome/onboarding_student.html';
            } else {
              alert('Hiba: Nem tal√°lhat√≥ bejelentkezett felhaszn√°l√≥ vagy adatb√°zis kapcsolat.');
            }
          } catch (error) {
            console.error('‚ö†Ô∏è Adatok t√∂rl√©se sikertelen:', error);
            alert('Hiba t√∂rt√©nt az adatok t√∂rl√©se sor√°n. K√©rlek pr√≥b√°ld √∫jra k√©s≈ëbb.');
          }
        });
      }

      // Switch functionality for disabling elements with Firebase sync
      const privateMessagesSwitch = document.querySelector('.card-top md-switch');
      const wordFilterSwitch = document.querySelector('.card-header md-switch');
      const messageRadios = document.querySelectorAll('md-radio[name="message-privacy"]');
      const wordFilterTextarea = document.querySelector('.textbox-container textarea');

      if (privateMessagesSwitch) {
        privateMessagesSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          messageRadios.forEach(radio => {
            radio.disabled = !isEnabled;
          });
          // Also disable/enable the word filter switch itself
          if (wordFilterSwitch) {
            wordFilterSwitch.disabled = !isEnabled;
            // If disabling, also disable the textbox
            if (!isEnabled && wordFilterTextarea) {
              wordFilterTextarea.disabled = true;
            }
          }
          
          // Firebase-be ment√©s
          await updateMessageSettings({
            messagesEnabled: isEnabled
          });
        });
      }

      if (wordFilterSwitch && wordFilterTextarea) {
        wordFilterSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          wordFilterTextarea.disabled = !isEnabled;
          
          // Firebase-be ment√©s
          await updateMessageSettings({
            wordFilterEnabled: isEnabled
          });
        });
      }
      
      // Radio button Firebase sync
      messageRadios.forEach(radio => {
        radio.addEventListener('click', async function() {
          messageRadios.forEach(r => r.checked = false);
          this.checked = true;
          
          // Firebase-be ment√©s
          await updateMessageSettings({
            whoCanSendYouMessages: this.value
          });
        });
      });
      
      // Functions switch esem√©nykezel≈ëk inicializ√°l√°sa
      addFunctionsSwitchListeners();
      
      // Supervision switch esem√©nykezel≈ëk inicializ√°l√°sa
      addSupervisionSwitchListeners();
    });
    
    // Settings kollekci√≥ kezel√©se
    async function initializeUserSettings() {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, getDoc, setDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        if (!user) return;
        
        const userData = await loadUserData();
        const isStudent = userData && userData.email && userData.email.includes('@europa2000.hu');
        
        // Messages settings - haszn√°ljuk a users kollekci√≥t settings helyett
        const messagesRef = doc(db, 'users', user.uid, 'settings', 'messages');
        const messagesDoc = await getDoc(messagesRef);
        
        if (!messagesDoc.exists()) {
          await setDoc(messagesRef, {
            messagesEnabled: false,
            whoCanSendYouMessages: 'nobody',
            wordFilterEnabled: false,
            words: 'preset'
          });
        }
        
        // Functions settings - haszn√°ljuk a users kollekci√≥t settings helyett
        const functionsRef = doc(db, 'users', user.uid, 'settings', 'functions');
        const functionsDoc = await getDoc(functionsRef);
        
        if (!functionsDoc.exists()) {
          await setDoc(functionsRef, {
            functionsEnabled: true,
            aiTranslate: true,
            aiCorrection: true
          });
        }
        
        // Supervision settings (csak di√°kfi√≥kok eset√©n) - haszn√°ljuk a users kollekci√≥t settings helyett
        if (isStudent) {
          const supervisionRef = doc(db, 'users', user.uid, 'settings', 'supervision');
          const supervisionDoc = await getDoc(supervisionRef);
          
          if (!supervisionDoc.exists()) {
            await setDoc(supervisionRef, {
              supervisionEnabled: true,
              parentNotifications: false,
              activityMonitoring: false
            });
          }
        }
        
        console.log('‚úÖ Settings kollekci√≥ inicializ√°lva');
      } catch (error) {
        console.error('‚ùå Settings inicializ√°l√°si hiba:', error);
      }
    }
    
    // Settings bet√∂lt√©se √©s UI alkalmaz√°sa
    async function loadAndApplySettings() {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, getDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        if (!user) return;
        
        // Initialize settings if they don't exist
        await initializeUserSettings();
        
        // Load messages settings - haszn√°ljuk a users kollekci√≥t settings helyett
        const messagesRef = doc(db, 'users', user.uid, 'settings', 'messages');
        const messagesDoc = await getDoc(messagesRef);
        
        if (messagesDoc.exists()) {
          const messagesData = messagesDoc.data();
          
          // Apply messages settings to UI
          const messagesSwitch = document.querySelector('#messages-page .card-top md-switch');
          if (messagesSwitch) {
            if (messagesData.messagesEnabled) {
              messagesSwitch.setAttribute('selected', '');
            } else {
              messagesSwitch.removeAttribute('selected');
            }
          }
          
          // Apply radio button settings
          const radioButtons = document.querySelectorAll('md-radio[name="message-privacy"]');
          radioButtons.forEach(radio => {
            if (radio.value === messagesData.whoCanSendYouMessages) {
              radio.setAttribute('checked', '');
            } else {
              radio.removeAttribute('checked');
            }
          });
          
          // Apply word filter settings
          const wordFilterSwitch = document.querySelector('.card-header md-switch');
          if (wordFilterSwitch) {
            if (messagesData.wordFilterEnabled) {
              wordFilterSwitch.setAttribute('selected', '');
            } else {
              wordFilterSwitch.removeAttribute('selected');
            }
          }
        }
        
        // Load functions settings - haszn√°ljuk a users kollekci√≥t settings helyett
        const functionsRef = doc(db, 'users', user.uid, 'settings', 'functions');
        const functionsDoc = await getDoc(functionsRef);
        
        if (functionsDoc.exists()) {
          const functionsData = functionsDoc.data();
          console.log('Functions settings loaded:', functionsData);
          
          // Apply functions settings to UI
          const functionsEnabledSwitch = document.getElementById('functions-enabled-switch');
          if (functionsEnabledSwitch) {
            if (functionsData.functionsEnabled) {
              functionsEnabledSwitch.setAttribute('selected', '');
            } else {
              functionsEnabledSwitch.removeAttribute('selected');
            }
          }
          
          const aiTranslateSwitch = document.getElementById('ai-translate-switch');
          if (aiTranslateSwitch) {
            if (functionsData.aiTranslate) {
              aiTranslateSwitch.setAttribute('selected', '');
            } else {
              aiTranslateSwitch.removeAttribute('selected');
            }
          }
          
          const aiCorrectionSwitch = document.getElementById('ai-correction-switch');
          if (aiCorrectionSwitch) {
            if (functionsData.aiCorrection) {
              aiCorrectionSwitch.setAttribute('selected', '');
            } else {
              aiCorrectionSwitch.removeAttribute('selected');
            }
          }
        }
        
        // Load supervision settings (csak di√°kfi√≥kok eset√©n)
        const userData = await loadUserData();
        const isStudent = userData && userData.email && userData.email.includes('@europa2000.hu');
        
        if (isStudent) {
          const supervisionRef = doc(db, 'settings', user.uid, 'supervision', 'config');
          const supervisionDoc = await getDoc(supervisionRef);
          
          if (supervisionDoc.exists()) {
            const supervisionData = supervisionDoc.data();
            console.log('Supervision settings loaded:', supervisionData);
            
            // Apply supervision settings to UI
            const supervisionEnabledSwitch = document.getElementById('supervision-enabled-switch');
            if (supervisionEnabledSwitch) {
              if (supervisionData.supervisionEnabled) {
                supervisionEnabledSwitch.setAttribute('selected', '');
              } else {
                supervisionEnabledSwitch.removeAttribute('selected');
              }
            }
            
            const parentNotificationsSwitch = document.getElementById('parent-notifications-switch');
            if (parentNotificationsSwitch) {
              if (supervisionData.parentNotifications) {
                parentNotificationsSwitch.setAttribute('selected', '');
              } else {
                parentNotificationsSwitch.removeAttribute('selected');
              }
            }
            
            const activityMonitoringSwitch = document.getElementById('activity-monitoring-switch');
            if (activityMonitoringSwitch) {
              if (supervisionData.activityMonitoring) {
                activityMonitoringSwitch.setAttribute('selected', '');
              } else {
                activityMonitoringSwitch.removeAttribute('selected');
              }
            }
          }
        }
        
        console.log('‚úÖ Settings UI szinkroniz√°lva');
      } catch (error) {
        console.error('‚ùå Settings bet√∂lt√©si hiba:', error);
      }
    }
    
    // Messages settings friss√≠t√©se
    async function updateMessageSettings(settings) {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, setDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        if (!user) return;
        
        const messagesRef = doc(db, 'settings', user.uid, 'messages', 'config');
        await setDoc(messagesRef, settings, { merge: true });
        
        console.log('‚úÖ Messages settings friss√≠tve:', settings);
      } catch (error) {
        console.error('‚ùå Messages settings friss√≠t√©si hiba:', error);
      }
    }
    
    // Functions settings friss√≠t√©se
    async function updateFunctionSettings(settings) {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, setDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        if (!user) return;
        
        const functionsRef = doc(db, 'settings', user.uid, 'functions', 'config');
        await setDoc(functionsRef, settings, { merge: true });
        
        console.log('‚úÖ Functions settings friss√≠tve:', settings);
      } catch (error) {
        console.error('‚ùå Functions settings friss√≠t√©si hiba:', error);
      }
    }
    
    // Supervision settings friss√≠t√©se
    async function updateSupervisionSettings(settings) {
      try {
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
        const { doc, setDoc, getFirestore } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js');
        
        const auth = getAuth();
        const db = getFirestore();
        const user = auth.currentUser;
        if (!user) return;
        
        const supervisionRef = doc(db, 'settings', user.uid, 'supervision', 'config');
        await setDoc(supervisionRef, settings, { merge: true });
        
        console.log('‚úÖ Supervision settings friss√≠tve:', settings);
      } catch (error) {
        console.error('‚ùå Supervision settings friss√≠t√©si hiba:', error);
      }
    }
    
    // Functions switch esem√©nykezel≈ëk hozz√°ad√°sa
    function addFunctionsSwitchListeners() {
      const functionsEnabledSwitch = document.getElementById('functions-enabled-switch')
      
      // Funkci√≥ az AI switchek enged√©lyez√©s√©nek/letilt√°s√°nak kezel√©s√©re
      function toggleAISwitches(enabled) {
        if (aiTranslateSwitch) {
          aiTranslateSwitch.disabled = !enabled;
          if (!enabled) {
            aiTranslateSwitch.removeAttribute('selected');
          }
        }
        if (aiCorrectionSwitch) {
          aiCorrectionSwitch.disabled = !enabled;
          if (!enabled) {
            aiCorrectionSwitch.removeAttribute('selected');
          }
        }
      }
      
      if (functionsEnabledSwitch) {
        // Kezdeti √°llapot be√°ll√≠t√°sa
        toggleAISwitches(functionsEnabledSwitch.selected);
        
        functionsEnabledSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          toggleAISwitches(isEnabled);
          await updateFunctionSettings({ functionsEnabled: isEnabled });
          
          // Ha letiltjuk a funkci√≥kat, akkor az AI switcheket is kikapcsoljuk
          if (!isEnabled) {
            await updateFunctionSettings({ aiTranslate: false, aiCorrection: false });
          }
        });
      }
      
      const aiTranslateSwitch = document.getElementById('ai-translate-switch');
      if (aiTranslateSwitch) {
        aiTranslateSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          await updateFunctionSettings({ aiTranslate: isEnabled });
        });
      }
      
      const aiCorrectionSwitch = document.getElementById('ai-correction-switch');
      if (aiCorrectionSwitch) {
        aiCorrectionSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          await updateFunctionSettings({ aiCorrection: isEnabled });
        });
      }
    }
    
    // Supervision switch esem√©nykezel≈ëk hozz√°ad√°sa
    function addSupervisionSwitchListeners() {
      const supervisionEnabledSwitch = document.getElementById('supervision-enabled-switch');
      if (supervisionEnabledSwitch) {
        supervisionEnabledSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          await updateSupervisionSettings({ supervisionEnabled: isEnabled });
        });
      }
      
      const parentNotificationsSwitch = document.getElementById('parent-notifications-switch');
      if (parentNotificationsSwitch) {
        parentNotificationsSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          await updateSupervisionSettings({ parentNotifications: isEnabled });
        });
      }
      
      const activityMonitoringSwitch = document.getElementById('activity-monitoring-switch');
      if (activityMonitoringSwitch) {
        activityMonitoringSwitch.addEventListener('change', async (event) => {
          const isEnabled = event.target.selected;
          await updateSupervisionSettings({ activityMonitoring: isEnabled });
        });
      }
    }
  </script>
</body>

</html>