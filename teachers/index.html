<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="√údv√∂z√∂llek az EU2K Hub-ban! Fedezd fel a leg√∫jabb esem√©nyeket, h√≠reket √©s tanul√°si lehet≈ës√©geket egy helyen.">
  <title data-translate="pages.index.title" data-translate-fallback="EU2K Hub">EU2K Teacher Hub</title>
  <link rel="stylesheet" href="home.css">
  <link rel="icon" href="/EU2K-Hub/favicon.ico">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body,
    * {
      font-family: "Roboto", sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      font-variation-settings: "wdth" 100;
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #newsRow {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #newsRow::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #event-frame {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #event-frame::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }
  </style>
  
  <!-- Common footer style (copied pattern from index.html) -->
  <style id="footer-common-style">
    /* Common footer style */
    .footer { margin-top: 8px; position: relative; }
    #site-footer .footer-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 18px;
      border-radius: 12px;
      background: #0E1512;
    }
    #site-footer .footer-left img,
    #site-footer .footer-right img {
      height: 28px;
      object-fit: contain;
    }
    #site-footer .footer-center {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #site-footer .footer-privacy {
      color: #C4C8C3;
      text-decoration: underline;
      cursor: pointer;
      font-size: 14px;
    }
    @media (max-width: 900px) {
      #site-footer .footer-container {
        flex-direction: column;
        gap: 8px;
        padding: 10px 12px;
      }
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "s6n7qpfkv4");
  </script>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore, collection, onSnapshot, query, orderBy, limit, startAfter, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // Make db globally available
    window.db = db;

    /* ---------------------- NEWS ----------------------- */
    let lastVisible = null;
    let loadingNews = false;
    const pageSize = 14; // Friss√≠tve 14 k√°rty√°ra

    // Fallback news data
    function loadFallbackNews() {
      console.log('üì∞ Loading fallback news data...');
      const fallbackNews = [
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        }
      ];

      const cards = document.querySelectorAll("#newsRow .news-card");

      fallbackNews.slice(0, cards.length).forEach((newsItem, index) => {
        const card = cards[index];

        // k√©p
        const rect = card.querySelector(".red-rect");
        if (rect) {
          rect.style.backgroundImage = `url(${newsItem.image})`;
          rect.style.backgroundSize = "cover";
          rect.style.backgroundPosition = "center";
          rect.style.backgroundColor = "var(--red)";
        }

        // c√≠m
        const titleSpan = card.querySelector(".news-label > span:first-child");
        if (titleSpan) {
          let title = newsItem.title;
          if (title.length > 30) title = title.substring(0, 30) + "...";
          titleSpan.textContent = title;
        }

        // le√≠r√°s
        const descSpan = card.querySelector(".news-label > span.desc");
        if (descSpan) {
          let desc = newsItem.desc;
          if (desc.length > 60) desc = desc.substring(0, 60) + "...";
          descSpan.textContent = desc;
        }

        // kattinthat√≥s√°g
        card.style.cursor = (newsItem.link !== "#") ? "pointer" : "default";
        card.onclick = null; // Clear previous onclick
        if (newsItem.link !== "#") {
          card.onclick = () => {
            let url = newsItem.link.trim();
            if (!url.startsWith("http://") && !url.startsWith("https://")) url = "https://" + url;
            window.open(url, "_blank");
          };
        }
      });

      console.log('‚úÖ Fallback news loaded successfully');
    }

    // Load h√≠rek
    async function loadNews() {
      console.log('üîÑ Loading news...');
      try {
        const hirekRef = collection(db, "homePageData", "news", "hirek");
        console.log('üîó Trying to connect to collection: homePageData/news/hirek');

        // Lek√©rj√ºk az √∂sszes dokumentumot
        const snapshot = await getDocs(hirekRef);
        console.log('üì∞ News snapshot:', snapshot.docs.length, 'documents found');

        // Debug: log all document IDs and their order
        snapshot.docs.forEach((doc, index) => {
          console.log(`üìÑ Document ${index}: ID=${doc.id}, data:`, doc.data());
        });

        if (snapshot.docs.length === 0) {
          console.warn('‚ö†Ô∏è No news documents found in Firebase collection');
          // Use fallback data
          loadFallbackNews();
          return;
        }

        // Rendezz√ºk a dokumentumokat ID szerint cs√∂kken≈ë sorrendben (legnagyobb sz√°m el√∂l)
        const sortedDocs = snapshot.docs.sort((a, b) => {
          const idA = parseInt(a.id) || 0;
          const idB = parseInt(b.id) || 0;
          return idB - idA; // Cs√∂kken≈ë sorrend
        });

        console.log('üì∞ Sorted news by ID (desc):', sortedDocs.map(doc => doc.id));

        const cards = document.querySelectorAll("#newsRow .news-card");
        console.log('üéØ Found', cards.length, 'news cards in DOM');

        if (cards.length === 0) {
          console.error('‚ùå No news cards found! Check if #newsRow exists and contains .news-card elements');
          return;
        }

        // Az √∂sszes el√©rhet≈ë dokumentumot feldolgozzuk, de maximum annyi k√°rty√°t t√∂lt√ºnk fel, amennyi van
        const docsToProcess = sortedDocs.slice(0, Math.min(sortedDocs.length, cards.length));
        console.log(`üì∞ Processing ${docsToProcess.length} news items for ${cards.length} cards`);

        docsToProcess.forEach((doc, index) => {
          const data = doc.data();
          const card = cards[index];
          console.log(`üìÑ Processing news ${index + 1}: ID=${doc.id}, Title="${data.title || 'No title'}"`);

          // k√©p
          const rect = card.querySelector(".red-rect");
          if (rect) {
            if (data.image && data.image.trim() !== '') {
              rect.style.backgroundImage = `url(${data.image})`;
              rect.style.backgroundSize = "cover";
              rect.style.backgroundPosition = "center";
              rect.style.backgroundColor = "transparent";
            } else {
              rect.style.backgroundImage = '';
              rect.style.backgroundColor = "var(--red)";
            }
          }

          // c√≠m
          const titleSpan = card.querySelector(".news-label > span:first-child");
          if (titleSpan) {
            let title = data.title || "Nincs c√≠m";
            if (title.length > 30) title = title.substring(0, 30) + "...";
            titleSpan.textContent = title;
          }

          // le√≠r√°s - a description mez≈ë haszn√°lata
          const descSpan = card.querySelector(".news-label > span.desc");
          if (descSpan) {
            let desc = data.description || data.desc || "";
            if (desc.length > 60) desc = desc.substring(0, 60) + "...";
            descSpan.textContent = desc;
          }

          // kattinthat√≥s√°g
          card.style.cursor = (data.link && data.link.trim() !== '') ? "pointer" : "default";
          card.onclick = null; // Clear previous onclick
          if (data.link && data.link.trim() !== '') {
            card.onclick = () => {
              let url = data.link.trim();
              if (!url.startsWith("http://") && !url.startsWith("https://")) url = "https://" + url;
              window.open(url, "_blank");
            };
          }
        });

        console.log('‚úÖ News loading completed successfully');
      } catch (error) {
        console.error('‚ùå Error loading news:', error);
        console.log('üîÑ Falling back to placeholder content...');

        // Fallback: Load fallback news instead of just placeholders
        loadFallbackNews();
      }
    }

    // Dinamikus m√©retez√©s a h√≠rk√°rty√°khoz
    function handleNewsCardResize() {
      const newsRow = document.getElementById("newsRow");
      const cards = Array.from(document.querySelectorAll("#newsRow .news-card"));

      if (!newsRow || cards.length === 0) return;

      const containerWidth = newsRow.clientWidth;
      const defaultCardWidth = 272; // Alap√©rtelmezett k√°rtya sz√©less√©g (CSS-b≈ël)
      const cardGap = 12; // K√°rty√°k k√∂z√∂tti t√°vols√°g (CSS-b≈ël)
      const minCards = 2; // Minimum 2 k√°rtya mindig l√°that√≥ legyen

      // Sz√°moljuk ki, hogy h√°ny k√°rtya f√©r el
      let maxVisibleCards = 6;
      for (let cardCount = 6; cardCount >= minCards; cardCount--) {
        const totalWidth = (defaultCardWidth * cardCount) + (cardGap * (cardCount - 1));
        if (totalWidth <= containerWidth) {
          maxVisibleCards = cardCount;
          break;
        }
      }

      console.log(`üìè Container width: ${containerWidth}px, showing ${maxVisibleCards} cards`);

      // Mutassuk/rejts√ºk el a k√°rty√°kat
      cards.forEach((card, index) => {
        if (index < maxVisibleCards) {
          card.style.display = 'flex';
          card.style.minWidth = `${defaultCardWidth}px`;
          card.style.maxWidth = `${defaultCardWidth}px`;
          card.style.width = `${defaultCardWidth}px`;
        } else {
          card.style.display = 'none';
        }
      });

      // Ha van extra hely, osszuk el a k√°rty√°k k√∂z√∂tt
      const totalUsedWidth = (defaultCardWidth * maxVisibleCards) + (cardGap * (maxVisibleCards - 1));
      if (containerWidth > totalUsedWidth && maxVisibleCards > 0) {
        const extraSpace = containerWidth - totalUsedWidth;
        const extraPerCard = extraSpace / maxVisibleCards;
        const newCardWidth = defaultCardWidth + extraPerCard;

        cards.slice(0, maxVisibleCards).forEach(card => {
          card.style.minWidth = `${newCardWidth}px`;
          card.style.maxWidth = `${newCardWidth}px`;
          card.style.width = `${newCardWidth}px`;
        });

        console.log(`üìè Cards resized to: ${newCardWidth.toFixed(1)}px each`);
      }
    }

    // Carousel gombok
    function initNewsCarousel() {
      const row = document.getElementById("newsRow");
      const leftBtn = document.querySelector(".carousel-btn.left");
      const rightBtn = document.querySelector(".carousel-btn.right");

      leftBtn.addEventListener("click", () => row.scrollBy({ left: -300, behavior: "smooth" }));
      rightBtn.addEventListener("click", () => row.scrollBy({ left: 300, behavior: "smooth" }));

      // infinite scroll trigger
      row.addEventListener("scroll", () => {
        if (row.scrollLeft + row.clientWidth >= row.scrollWidth - 50) {
          loadNews(false);
        }
      });

      // M√©retez√©s inicializ√°l√°sa
      handleNewsCardResize();
    }

    /* ---------------------- EVENTS ----------------------- */
    function handleDynamicLayout() {
      const mainContent = document.querySelector('.main-content');
      const containers = Array.from(document.querySelectorAll('.event-container'));
      if (!mainContent || containers.length === 0) return;

      const mainContentWidth = mainContent.clientWidth;
      const availableWidth = mainContentWidth - 64;

      const defaultWidths = [120, 400, 400, 400, 120, 120, 56];
      const defaultHeights = [205, 205, 205, 205, 205, 205, 205];
      const hideOrder = [4, 3, 2, 0, 5];

      containers.forEach(c => c.classList.remove("hidden"));

      let totalWidth = defaultWidths.reduce((a, b) => a + b, 0) + (defaultWidths.length - 1) * 8;

      for (let i = 0; i < hideOrder.length; i++) {
        if (totalWidth <= availableWidth) break;
        const idx = hideOrder[i];
        containers[idx].classList.add("hidden");
        totalWidth -= defaultWidths[idx] + 8;
      }

      const visibleContainers = containers.filter(c => !c.classList.contains('hidden'));
      if (visibleContainers.length > 0) {
        const visibleWidths = visibleContainers.map(c => defaultWidths[containers.indexOf(c)]);
        const visibleTotalWidth = visibleWidths.reduce((a, b) => a + b, 0) + (visibleContainers.length - 1) * 8;
        const scaleRatio = Math.min(1 + (availableWidth - visibleTotalWidth) / visibleTotalWidth, 1.5);

        visibleContainers.forEach(c => {
          const idx = containers.indexOf(c);
          const card = c.querySelector('.red-card');
          if (card) {
            card.style.width = `${defaultWidths[idx] * scaleRatio}px`;
            card.style.height = `${defaultHeights[idx] * scaleRatio}px`;
          }
        });
      }

      loadEvents();
    }

    async function loadEvents() {
      console.log('Loading events...');
      try {
        const eventsRef = collection(db, 'homePageData', 'events', 'esemenyek');
        console.log('Trying to connect to database...');

        const snapshot = await getDocs(eventsRef);
        console.log('Events snapshot:', snapshot.docs.length, 'documents found');

        // Debug: log all document IDs
        snapshot.docs.forEach((doc, index) => {
          console.log(`Event Document ${index}: ID=${doc.id}, data:`, doc.data());
        });

        if (snapshot.docs.length === 0) {
          console.warn('No event documents found in Firebase collection');
          return;
        }

        let events = [];
        const now = new Date();
        // Minden esem√©nyt figyelembe vesz√ºnk, nem csak a k√∂vetkez≈ë 1 h√≥napot,
        // √≠gy a k√∂zeli m√∫lt esem√©nyei is beker√ºlnek, √©s a legk√∂zelebbi esem√©ny
        // val√≥ban k√∂z√©pre ker√ºlhet

        snapshot.forEach(doc => {
          const data = doc.data();
          const eventDate = data.date?.toDate ? data.date.toDate() : null;
          if (!eventDate) return;
          events.push({ id: parseInt(doc.id), data, date: eventDate });
        });

        console.log('Collected events (all with valid date):', events.length);
        events.sort((a, b) => a.id - b.id);

        let closestEventIndex = -1;
        let minDateDiff = Infinity;

        events.forEach((event, index) => {
          const diff = Math.abs(event.date - now);
          if (diff < minDateDiff) {
            minDateDiff = diff;
            closestEventIndex = index;
          }
        });

        if (closestEventIndex === -1 && events.length > 0) {
          closestEventIndex = events.length - 1; // Leg√∫jabb (legnagyobb ID)
        }

        // Lok√°lis kont√©nerek √©s l√°that√≥ kont√©nerek meghat√°roz√°sa az aktu√°lis layout alapj√°n
        const containers = Array.from(document.querySelectorAll('.event-container'));
        const visibleContainers = containers.filter(c => !c.classList.contains('hidden'));
        if (visibleContainers.length === 0) {
          console.warn('No visible event containers found after layout calculation');
          return;
        }
        // Prefer√°lt k√∂z√©p: a 3 nagy k√°rtya k√∂z√ºl a 2. (containers[2]) ha l√°that√≥,
        // ha nem, pr√≥b√°ljuk a containers[1]-et, majd containers[3]-at, v√©g√ºl fallback k√∂z√©pre
        const preferOrder = [2, 1, 3];
        let centerContainerIndex = Math.floor(visibleContainers.length / 2);
        for (const idx of preferOrder) {
          const el = containers[idx];
          const visibleIdx = el ? visibleContainers.indexOf(el) : -1;
          if (visibleIdx !== -1) {
            centerContainerIndex = visibleIdx;
            break;
          }
        }
        const arrangedIndices = new Array(visibleContainers.length).fill(null);

        if (closestEventIndex !== -1) {
          arrangedIndices[centerContainerIndex] = closestEventIndex;

          // R√©gebbi esem√©nyek (kisebb ID) elhelyez√©se balra
          let leftIndex = centerContainerIndex - 1;
          for (let i = closestEventIndex - 1; i >= 0 && leftIndex >= 0; i--) {
            arrangedIndices[leftIndex--] = i;
          }

          // √öjabb esem√©nyek (nagyobb ID) elhelyez√©se jobbra
          let rightIndex = centerContainerIndex + 1;
          for (let i = closestEventIndex + 1; i < events.length && rightIndex < visibleContainers.length; i++) {
            arrangedIndices[rightIndex++] = i;
          }
        }

        visibleContainers.forEach((container, i) => {
          const itemIndex = arrangedIndices[i];
          const item = itemIndex != null ? events[itemIndex] : null;

          const card = container.querySelector('.red-card');
          const titleSpan = container.querySelector('.event-label-text > span:first-child');
          const descSpan = container.querySelector('.event-label-text > span.desc');
          const placeSpan = container.querySelector('.event-label-text > span.place');
          const arrowContainer = container.querySelector('.arrow-container');

          if (!item) {
            if (card) {
              card.style.backgroundImage = '';
              card.style.backgroundColor = '';
            }
            if (titleSpan) titleSpan.textContent = '';
            if (descSpan) descSpan.textContent = '';
            if (placeSpan) placeSpan.textContent = '';
            if (arrowContainer) {
              arrowContainer.style.opacity = '0';
              arrowContainer.style.cursor = 'default';
              arrowContainer.onclick = (e) => e.stopPropagation();
            }
            return;
          }

          console.log(`Processing event ${i + 1}: ID=${item.id}, Title="${item.data.title || 'No title'}"`);

          if (card) {
            if (item.data.image && item.data.image.trim() !== '') {
              card.style.backgroundImage = `url(${item.data.image})`;
              card.style.backgroundSize = 'cover';
              card.style.backgroundPosition = 'center';
              card.style.backgroundColor = 'transparent';
            } else {
              card.style.backgroundImage = '';
              card.style.backgroundColor = 'var(--red)';
            }
          }

          if (titleSpan) {
            let title = item.data.title || "Nincs c√≠m";
            if (title.length > 30) title = title.substring(0, 30) + '...';
            titleSpan.textContent = title;
          }

          if (descSpan) {
            let desc = item.data.description || "";
            if (desc.length > 50) desc = desc.substring(0, 50) + '...';
            descSpan.textContent = desc;
          }

          if (placeSpan && item.data.place) {
            placeSpan.textContent = "Helysz√≠n: " + item.data.place;
          }

          if (arrowContainer) {
            if (item.data.link && item.data.link.trim() !== '') {
              arrowContainer.style.opacity = '1';
              arrowContainer.style.cursor = 'pointer';
              arrowContainer.style.filter = 'none';
              arrowContainer.onclick = (e) => {
                e.stopPropagation();
                let url = item.data.link.trim();
                if (!url.startsWith('http://') && !url.startsWith('https://')) url = 'https://' + url;
                window.open(url, '_blank');
              };
            } else {
              arrowContainer.style.opacity = '0.3';
              arrowContainer.style.cursor = 'not-allowed';
              arrowContainer.style.filter = 'grayscale(100%)';
              arrowContainer.onclick = (e) => e.stopPropagation();
            }
          }
        });

        console.log('Events loading completed successfully');
      } catch (error) {
        console.error('‚ùå Error loading events:', error);
      }
    }

    /* ---------------------- INIT ----------------------- */
    window.addEventListener("load", () => {
      console.log('Page loaded, initializing...');

      // DOM elemek ellen≈ërz√©se
      const newsRow = document.getElementById('newsRow');
      const newsCards = document.querySelectorAll('#newsRow .news-card');
      console.log('üîç DOM check:', {
        newsRow: !!newsRow,
        newsCardsCount: newsCards.length,
        db: !!window.db
      });

      if (!newsRow) {
        console.error('‚ùå newsRow element not found!');
        return;
      }

      if (newsCards.length === 0) {
        console.error('‚ùå No news cards found!');
        return;
      }

      // Kis k√©sleltet√©s, hogy biztosan bet√∂lt≈ëdjenek a DOM elemek √©s Firebase
      setTimeout(() => {
        console.log('Starting delayed initialization...');
        loadNews();
        handleDynamicLayout();
        initNewsCarousel();
        // Kis k√©sleltet√©s a h√≠rek bet√∂lt√©se ut√°n a m√©retez√©shez
        setTimeout(handleNewsCardResize, 100);
      }, 200);
    });

    window.addEventListener("resize", () => {
      handleDynamicLayout();
      handleNewsCardResize();
    });
  </script>
<style id="footer-common-style">
  /* Common footer + minimal main content padding */
  .footer { margin-top: 8px; position: relative; }
  /* Reserve space so footer doesn't overlap content */
  .main-area .main-content { padding-bottom: 84px; }
  #site-footer .footer-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 14px 18px;
    border-radius: 12px;
    background: #0E1512;
  }
  #site-footer .footer-left img,
  #site-footer .footer-right img {
    height: 28px;
    object-fit: contain;
  }
  #site-footer .footer-center {
    flex: 1 1 auto;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #site-footer .footer-privacy {
    color: #C4C8C3;
    text-decoration: underline;
    cursor: pointer;
    font-size: 14px;
  }
  @media (max-width: 900px) {
    #site-footer .footer-container {
      flex-direction: column;
      gap: 8px;
      padding: 10px 12px;
    }
  }
</style>
</head>

<body>
  <div class="app-bg">
    <aside class="sidebar">
      <nav class="nav-menu">
        <a class="nav-item" href="control_panel.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/control_panel.svg" class="nav-icon" alt="Vez√©rl≈ëpult">
          </div>
          <span>Vez√©rl≈ëpult</span>
        </a>
        <a class="nav-item" href="students.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/students.svg" class="nav-icon" alt="Di√°kok">
          </div>
          <span>Di√°kok</span>
        </a>
        <a class="nav-item" href="calendar.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/calendar.svg" class="nav-icon" alt="Napt√°r">
          </div>
          <span>Napt√°r</span>
        </a>
        <a class="nav-item" href="hive.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/hive.svg" class="nav-icon" alt="Hive">
          </div>
          <span>Hive</span>
        </a>
        <div class="sidebar-divider"></div>
        <a class="nav-item active" href="index.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/home_icon.svg" class="nav-icon" alt="Otthon">
          </div>
          <span data-translate="navigation.home">Otthon</span>
        </a>
        <a class="nav-item" href="qr-code.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/qr_code_icon.svg" class="nav-icon" alt="QR-K√≥d">
          </div>
          <span data-translate="navigation.qr" data-translate-fallback="QR-K√≥d">QR-K√≥d</span>
        </a>
        <a class="nav-item" href="youhub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/youhub_icon.svg" class="nav-icon" alt="YouHub">
          </div>
          <span data-translate="navigation.youhub">YouHub</span>
        </a>
        <a class="nav-item" href="event_hub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/event_hub_icon.svg" class="nav-icon" alt="Event Hub">
          </div>
          <span data-translate="navigation.event_hub">Event Hub</span>
        </a>
      </nav>
    </aside>
    <main class="main-area">
      <div class="main-content">
        <header class="header">
          <div class="welcome-container">
            <img src="/EU2K-Hub/assets/welcome_hand_icon.svg" class="welcome-icon" alt="Welcome">
            <h1 class="welcome-text" data-translate="pages.index.welcome"
              data-translate-fallback="√údv√∂z√∂llek a Hub-ban!">√údv√∂z√∂llek a Hub-ban!</h1>
          </div>
          <div class="header-icons">
            <a href="/EU2K-Hub/system/account.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/account_icon.svg" class="header-icon" alt="Account">
            </a>
            <a href="/EU2K-Hub/settings/settings.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/settings_icon.svg" class="header-icon" alt="Settings">
            </a>
          </div>
        </header>
        <section class="events-section">
          <div class="section-title">
            <span data-translate="pages.index.upcoming_events" data-translate-fallback="K√∂zelg≈ë Esem√©nyek">K√∂zelg≈ë
              Esem√©nyek</span>
            <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>
          <div class="event-frame">
            <div class="top-cards-row">
              <!-- Medium 1 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Large 1 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Large 2 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Large 3 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Medium 2 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Medium 3 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Small -->
              <div class="event-container">
                <div class="red-card small"></div>
              </div>

            </div>
          </div>
        </section>
        <section class="news-section">
          <div class="section-title">
            <span data-translate="pages.index.news" data-translate-fallback="H√≠rek">H√≠rek</span>
            <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>

          <!-- carousel wrapper -->
          <div class="news-carousel">
            <button class="carousel-btn left">‚Äπ</button>

            <div class="bottom-cards-row" id="newsRow">
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
            </div>
            <button class="carousel-btn right">‚Ä∫</button>
          </div>
          <div style="text-align:center;margin-top:24px;">
            <md-filled-button id="publishBtnNav">H√≠r / Esem√©ny Publik√°l√°sa</md-filled-button>
          </div>
        </section>
        <section id="publish-section" style="display:none;"></section>
      </div>
    </main>
    <div id="site-footer" class="footer" aria-label="Site footer">
      <div class="footer-container">
        <div class="footer-left">
          <img src="../eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
        </div>
        <div class="footer-center">
          <a class="footer-privacy" href="/EU2K-Hub/index.html#privacy-policy">Adatkezel√©si T√°j√©koztat√≥</a>
        </div>
        <div class="footer-right">
          <img src="../eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
          <img src="../eu2k_dok_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
        </div>
      </div>
    </div>
  </div>
  <div id="event-mask"></div>

  <!-- √öj dolgok Popup -->
  <div id="newThingsPopup" class="new-things-overlay" style="display: none;">
    <div class="new-things-container">
      <div class="new-things-close-btn" onclick="closeNewThingsPopup()">
        <img src="/EU2K-Hub/assets/close.svg" alt="Bez√°r√°s">
      </div>
      <div class="new-things-content">
        <div class="new-things-header">
          <img src="/EU2K-Hub/assets/sparkles.svg" class="new-things-icon-top" alt="√öj dolgok">
        </div>
        <h2 class="new-things-title" data-translate="pages.index.new_things_title">New things in the Hub</h2>
        <p class="new-things-subtitle" id="newThingsSubtitle">EU2K Hub 0.2abc - Z√°rt B√©ta</p>
        <div class="new-things-image-container">
          <img src="/EU2K-Hub/assets/placeholder_img.svg" class="new-things-image" alt="√öj dolgok">
        </div>
        <div class="new-things-list">
          <!-- A lista dinamikusan lesz felt√∂ltve JavaScript √°ltal -->
        </div>
        <div class="new-things-footer">
          <a href="https://eu2kdevs.hu" target="_blank" class="new-things-link"
            data-translate="pages.index.more_info_link">
            Tov√°bbiak az <b>eu2kdevs.hu</b> oldalon.
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // √öj dolgok popup kezel√©se
    let newThingsData = null;

    // Popup megnyit√°sa
    function showNewThingsPopup() {
      const popup = document.getElementById('newThingsPopup');
      if (popup) {
        popup.style.display = 'flex';
      }
    }

    // Popup bez√°r√°sa
    function closeNewThingsPopup() {
      const popup = document.getElementById('newThingsPopup');
      if (popup) {
        popup.style.display = 'none';
      }
    }

    // Popup bez√°r√°sa overlay-re kattint√°skor
    document.addEventListener('DOMContentLoaded', () => {
      const popup = document.getElementById('newThingsPopup');
      if (popup) {
        popup.addEventListener('click', (e) => {
          if (e.target === popup) {
            closeNewThingsPopup();
          }
        });
      }
    });

    // Firebase adatok lek√©r√©se √©s popup megjelen√≠t√©se
    async function checkAndShowNewThings() {
      try {
        // Firestore v9 f√ºggv√©nyek import√°l√°sa
        const { collection, getDocs, query, orderBy, limit } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");

        // Jelenlegi id≈ë lek√©r√©se (egyszer≈±s√≠tett verzi√≥)
        const now = new Date();
        const currentTime = now.getTime();

        // Updates kollekci√≥ lek√©rdez√©se
        const updatesRef = collection(db, 'homePageData', 'new-things', 'updates');
        const q = query(updatesRef, orderBy('publish_date', 'desc'), limit(10));
        const snapshot = await getDocs(q);

        let latestUpdate = null;
        let latestTimestamp = 0;
        let latestUpdateId = null;

        snapshot.forEach(doc => {
          const data = doc.data();
          const publishDate = data.publish_date;

          if (publishDate) {
            const timestamp = publishDate.toDate ? publishDate.toDate().getTime() : publishDate;

            // Ellen≈ërizz√ºk, hogy a timestamp nem j√∂v≈ëbeli-e (1 √≥ra tolerancia)
            const oneHourInMs = 60 * 60 * 1000;
            if (timestamp <= currentTime + oneHourInMs && timestamp > latestTimestamp) {
              latestTimestamp = timestamp;
              latestUpdate = { ...data, document_id: doc.id }; // Add document ID to data
              latestUpdateId = doc.id;
            }
          }
        });

        if (latestUpdate) {
          const lastShownUpdateId = localStorage.getItem('lastShownNewThingsUpdateId');

          if (lastShownUpdateId !== latestUpdateId) {
            // Pre-translate content
            const translations = {};
            for (const lang of ['en', 'hu']) {
              translations[lang] = {
                state: await translateWithAI(latestUpdate.state, lang),
                new_thing1: await translateWithAI(latestUpdate.new_thing1, lang),
                new_thing2: await translateWithAI(latestUpdate.new_thing2, lang),
              };
            }
            latestUpdate.translations = translations;
            newThingsData = latestUpdate;

            updatePopupContent(newThingsData);
            showNewThingsPopup();

            localStorage.setItem('lastShownNewThingsUpdateId', latestUpdateId);
          }
        }

      } catch (error) {
        console.error('Hiba az √∫j dolgok lek√©rdez√©sekor:', error);
      }
    }

    // Popup tartalom friss√≠t√©se
    function updatePopupContent(data) {
      if (!data) return;
      const targetLanguage = window.translationManager.currentLanguage;
      const translatedData = data.translations[targetLanguage];

      const subtitle = document.getElementById('newThingsSubtitle');
      if (subtitle) {
        const docName = data.document_name || data.document_id || '0.2abc';
        subtitle.textContent = `EU2K Hub ${docName} - ${translatedData.state}`;
      }

      const newThingsList = document.querySelector('.new-things-list');
      if (newThingsList) {
        newThingsList.innerHTML = '';
        const ul = document.createElement('ul');
        ul.style.margin = '0';
        ul.style.paddingLeft = '20px';
        ul.style.listStyleType = 'disc';

        if (translatedData.new_thing1) {
          const li1 = document.createElement('li');
          li1.textContent = translatedData.new_thing1;
          li1.style.color = '#C2C3C2';
          li1.style.marginBottom = '8px';
          li1.style.lineHeight = '1.5';
          ul.appendChild(li1);
        }

        if (translatedData.new_thing2) {
          const li2 = document.createElement('li');
          li2.textContent = translatedData.new_thing2;
          li2.style.color = '#C2C3C2';
          li2.style.marginBottom = '8px';
          li2.style.lineHeight = '1.5';
          ul.appendChild(li2);
        }

        newThingsList.appendChild(ul);
      }

      window.translationManager.applyTranslations();
    }

    // Oldal bet√∂lt√©sekor csekkol√°s
    window.addEventListener('DOMContentLoaded', () => {
      // K√©sleltetett csekkol√°s, hogy a Firebase bet√∂lt≈ëdj√∂n
      setTimeout(checkAndShowNewThings, 1000);
    });

    // Debug f√ºggv√©ny a localStorage reset-hez √©s popup √∫jra megjelen√≠t√©s√©hez
    // Haszn√°lat a konzolban: resetNewThingsPopup()
    window.resetNewThingsPopup = function () {
      console.log('üîÑ Resetting new things popup tracking...');

      // T√∂r√∂lj√ºk a localStorage-b√≥l az utolj√°ra megjelen√≠tett update ID-t
      localStorage.removeItem('lastShownNewThingsUpdateId');
      console.log('‚úÖ Cleared lastShownNewThingsUpdateId from localStorage');

      // √öjra futtatjuk a checkAndShowNewThings f√ºggv√©nyt
      console.log('üîç Checking for new updates...');
      checkAndShowNewThings().then(() => {
        console.log('‚ú® Check complete! If there are updates, the popup should appear.');
      }).catch(error => {
        console.error('‚ùå Error during check:', error);
      });
    };

    // Debug f√ºggv√©ny az √∂sszes new things adat t√∂rl√©s√©hez
    // Haszn√°lat a konzolban: clearAllNewThingsData()
    window.clearAllNewThingsData = function () {
      console.log('üóëÔ∏è Clearing all new things data...');

      // T√∂r√∂lj√ºk az √∂sszes kapcsol√≥d√≥ localStorage elemet
      const keysToRemove = ['lastShownNewThingsUpdateId', 'lastNewThingsCheck'];
      keysToRemove.forEach(key => {
        if (localStorage.getItem(key)) {
          localStorage.removeItem(key);
          console.log(`‚úÖ Removed ${key}`);
        }
      });

      console.log('‚ú® All new things data cleared!');
    };

    // Debug f√ºggv√©ny az aktu√°lis √°llapot megjelen√≠t√©s√©hez
    // Haszn√°lat a konzolban: showNewThingsStatus()
    window.showNewThingsStatus = function () {
      console.log('üìä Current New Things Status:');
      console.log('Last shown update ID:', localStorage.getItem('lastShownNewThingsUpdateId') || 'None');
      console.log('Last check date:', localStorage.getItem('lastNewThingsCheck') || 'None');
      console.log('Current new things data:', newThingsData || 'No data loaded');
    };
  </script>

  <script src="/EU2K-Hub/assets/js/permissions.js"></script>
  <script src="/EU2K-Hub/assets/js/translations.js"></script>
  <script src="/EU2K-Hub/assets/js/welcome-screen.js"></script>

  <script>
    // Check if user has accepted terms of service
    document.addEventListener('DOMContentLoaded', () => {
      const termsAccepted = localStorage.getItem('termsAccepted');
      if (termsAccepted !== 'true') {
        // Redirect to onboarding if terms not accepted
        window.location.href = '/EU2K-Hub/welcome/onboarding_student.html';
      }
    });
  </script>
  <script>
    // SPA routing √©s tartalomv√°lt√°s - Hash alap√∫ navig√°ci√≥
    const publishSection = document.getElementById('publish-section');
    const publishBtnNav = document.getElementById('publishBtnNav');
    const dashboardSections = [
      document.querySelector('.header'),
      document.querySelector('.events-section'),
      document.querySelector('.news-section')
    ];

    function showPage(pageId) {
      // Minden oldal elrejt√©se
      dashboardSections.forEach(section => section.style.display = 'none');
      publishSection.style.display = 'none';

      // Megfelel≈ë oldal megjelen√≠t√©se
      if (pageId === 'publish') {
        publishSection.style.display = '';

        // Template bet√∂lt√©se ha sz√ºks√©ges
        if (!publishSection.innerHTML.trim()) {
          const template = document.getElementById('courses-page');
          if (template) {
            publishSection.appendChild(template.content.cloneNode(true));
            setupCoursesPageLogic();
          }
        }
      } else {
        // Dashboard megjelen√≠t√©se (alap√©rtelmezett)
        dashboardSections.forEach(section => section.style.display = '');
      }
    }

    function navigate(event, pageId) {
      event.preventDefault();
      location.hash = pageId;
    }

    // Publik√°l√°s gomb esem√©nykezel≈ë
    if (publishBtnNav) {
      publishBtnNav.addEventListener('click', e => {
        navigate(e, 'publish');
      });
    }

    // Hash v√°ltoz√°s figyel√©se
    window.addEventListener('hashchange', () => {
      const page = location.hash.substring(1) || 'dashboard';
      showPage(page);
    });

    // Oldal bet√∂lt√©sekor
    window.addEventListener('DOMContentLoaded', () => {
      const initialPage = location.hash.substring(1) || 'dashboard';
      showPage(initialPage);
    });

    // Initial page load (ha m√°r bet√∂lt√∂tt a DOM)
    if (document.readyState === 'loading') {
      // A DOMContentLoaded esem√©ny fogja kezelni
    } else {
      const initialPage = location.hash.substring(1) || 'dashboard';
      showPage(initialPage);
    }
  </script>
  <script>
    async function setupCoursesPageLogic() {
      if (window.coursesPageLoaded) return;
      window.coursesPageLoaded = true;

      const {
        initializeApp
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js");
      const {
        getAnalytics
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js");
      const {
        getFirestore,
        collection,
        getDocs,
        setDoc,
        doc,
        Timestamp
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");

      const firebaseConfig = {
        apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
        authDomain: "eu2k-hub.firebaseapp.com",
        projectId: "eu2k-hub",
        storageBucket: "eu2k-hub.firebasestorage.app",
        messagingSenderId: "560244867055",
        appId: "1:560244867055:web:c5bbfe3939fdec9f89001a",
        measurementId: "G-LB2WZ574GJ"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // D√°tum form√°z√°s preview-hoz
      const formatDatePreview = (raw) => {
        if (!raw) return '';
        if (raw.length >= 6) {
          return `${raw.slice(0, 4)}/${raw.slice(4, 6)}/${raw.slice(6)}`;
        } else if (raw.length >= 4) {
          return `${raw.slice(0, 4)}/${raw.slice(4)}`;
        }
        return raw;
      };

      // D√°tum input kezel√©se
      const handleDateInput = (inputEl, previewEl) => {
        inputEl.addEventListener('input', () => {
          let raw = inputEl.value.replace(/\D/g, '').slice(0, 8);
          inputEl.value = raw;
          previewEl.textContent = formatDatePreview(raw);
        });
      };

      handleDateInput(document.getElementById('dateNews'), document.getElementById('datePreviewNews'));
      handleDateInput(document.getElementById('dateEvent'), document.getElementById('datePreviewEvent'));

      // F√ºggv√©ny a mwc textfield-ek t√∂rl√©s√©re
      const clearMwTextFields = (containerId) => {
        document.querySelectorAll(`#${containerId} md-outlined-text-field`).forEach(el => {
          el.value = '';
        });
      };

      // H√≠r publik√°l√°sa
      document.getElementById('publishBtnNews').addEventListener('click', async () => {
        const title = document.getElementById('titleNews').value.trim();
        const hubExclusive = document.getElementById('hubExclusiveNews').checked;
        const author = document.getElementById('authorNews').value.trim();
        const desc = document.getElementById('descNews').value.trim();
        const image = document.getElementById('imageNews').value.trim();
        const link = document.getElementById('linkNews').value.trim();
        const rawDate = document.getElementById('dateNews').value.trim();

        const hibak = [];

        if (!title) hibak.push("Nincs megadva a c√≠m!");
        if (hubExclusive && !author) hibak.push("Hub Exkluz√≠v h√≠rn√©l k√∂telez≈ë a szerz≈ë megad√°sa!");
        if (!desc) hibak.push("Nincs megadva a le√≠r√°s!");
        if (!image) hibak.push("Nincs megadva a k√©p URL!");
        if (!link) hibak.push("Nincs megadva a hivatkoz√°s!");
        if (!rawDate) {
          hibak.push("Nincs megadva a d√°tum!");
        } else if (rawDate.length !== 8) {
          hibak.push("Hib√°s d√°tumform√°tum! √çrd be 8 sz√°mjeggyel, pl. 20250120.");
        } else {
          const year = rawDate.slice(0, 4);
          const month = rawDate.slice(4, 6);
          const day = rawDate.slice(6, 8);
          const dateObj = new Date(`${year}-${month}-${day}`);
          if (isNaN(dateObj)) {
            hibak.push("√ârv√©nytelen d√°tum!");
          }
        }

        if (hibak.length > 0) {
          document.getElementById('statusNews').innerHTML = hibak.join("<br>");
          return;
        }

        const year = rawDate.slice(0, 4);
        const month = rawDate.slice(4, 6);
        const day = rawDate.slice(6, 8);
        const dateObj = new Date(`${year}-${month}-${day}`);
        const timestamp = Timestamp.fromDate(dateObj);

        const hirekRef = collection(db, "homePageData", "news", "hirek");
        const snapshot = await getDocs(hirekRef);

        let maxId = 0;
        snapshot.forEach(docSnap => {
          const docId = parseInt(docSnap.id);
          if (!isNaN(docId) && docId > maxId) maxId = docId;
        });

        const newId = (maxId + 1).toString();

        await setDoc(doc(hirekRef, newId), {
          title,
          author: hubExclusive ? author : '',
          desc,
          image,
          link,
          hubExclusive,
          date: timestamp
        });

        document.getElementById('statusNews').textContent = "‚úÖ H√≠r sikeresen kiadva!";
        clearMwTextFields('newsForm');
        document.getElementById('datePreviewNews').textContent = '';
      });

      // Esem√©ny publik√°l√°sa
      document.getElementById('publishBtnEvent').addEventListener('click', async () => {
        const title = document.getElementById('titleEvent').value.trim();
        const place = document.getElementById('placeEvent').value.trim();
        const description = document.getElementById('descriptionEvent').value.trim();
        const image = document.getElementById('imageEvent').value.trim();
        const link = document.getElementById('linkEvent').value.trim();
        const rawDate = document.getElementById('dateEvent').value.trim();

        const hibak = [];

        if (!title) hibak.push("Nincs megadva a c√≠m!");
        if (!place) hibak.push("Nincs megadva a helysz√≠n!");
        if (!description) hibak.push("Nincs megadva a le√≠r√°s!");
        if (!image) hibak.push("Nincs megadva a k√©p URL!");
        if (!rawDate) {
          hibak.push("Nincs megadva a d√°tum!");
        } else if (rawDate.length !== 8) {
          hibak.push("Hib√°s d√°tumform√°tum! √çrd be 8 sz√°mjeggyel, pl. 20250120.");
        } else {
          const year = rawDate.slice(0, 4);
          const month = rawDate.slice(4, 6);
          const day = rawDate.slice(6, 8);
          const dateObj = new Date(`${year}-${month}-${day}`);
          if (isNaN(dateObj)) {
            hibak.push("√ârv√©nytelen d√°tum!");
          }
        }

        if (hibak.length > 0) {
          document.getElementById('statusEvent').innerHTML = hibak.join("<br>");
          return;
        }

        const year = rawDate.slice(0, 4);
        const month = rawDate.slice(4, 6);
        const day = rawDate.slice(6, 8);
        const dateObj = new Date(`${year}-${month}-${day}`);
        const timestamp = Timestamp.fromDate(dateObj);

        const esemenyekRef = collection(db, "homePageData", "events", "esemenyek");
        const snapshot = await getDocs(esemenyekRef);

        let maxId = 0;
        snapshot.forEach(docSnap => {
          const docId = parseInt(docSnap.id);
          if (!isNaN(docId) && docId > maxId) maxId = docId;
        });

        const newId = (maxId + 1).toString();

        await setDoc(doc(esemenyekRef, newId), {
          title,
          description,
          place,
          image,
          link,
          date: timestamp
        });

        document.getElementById('statusEvent').textContent = "Esem√©ny sikeresen publik√°lva!";
        clearMwTextFields('eventForm');
        document.getElementById('datePreviewEvent').textContent = '';
      });

      // Hub Exkluz√≠v checkbox logika
      document.getElementById('hubExclusiveNews').addEventListener('change', function () {
        const authorField = document.getElementById('authorNews');
        if (this.checked) {
          authorField.removeAttribute('disabled');
        } else {
          authorField.setAttribute('disabled', '');
          authorField.value = '';
        }
      });

      // Vissza gomb funkci√≥
      document.getElementById('backToHome').addEventListener('click', function (e) {
        e.preventDefault();
        location.hash = 'dashboard';
      });
    }
  </script>
</body>
<template id="courses-page">
  <div class="publish-layout">
    <div class="back-arrow-column">
      <md-filled-button id="backToHome" class="back-arrow-btn">
        <img src="/EU2K-Hub/assets/arrowback.svg" alt="Vissza" class="arrow-img">
      </md-filled-button>
    </div>
    <div class="publish-content">
      <header class="header">
        <div class="welcome-container">
          <img src="/EU2K-Hub/assets/add_news.svg" class="welcome-icon" alt="√öj H√≠r">
          <h1 class="welcome-text">√öj h√≠r publik√°l√°sa</h1>
        </div>
        <div class="header-icons">
          <a href="/EU2K-Hub/system/account.html" class="header-icon-link">
            <img src="/EU2K-Hub/assets/account_icon.svg" class="header-icon" alt="Account">
          </a>
          <a href="/EU2K-Hub/settings/settings.html" class="header-icon-link">
            <img src="/EU2K-Hub/assets/settings_icon.svg" class="header-icon" alt="Settings">
          </a>
        </div>
      </header>
      <section class="form-card">
        <div class="form" id="newsForm">
          <md-outlined-text-field label="C√≠m" id="titleNews"></md-outlined-text-field>
          <md-outlined-text-field label="Szerz≈ë" id="authorNews" disabled></md-outlined-text-field>
          <md-outlined-text-field label="Le√≠r√°s" id="descNews"></md-outlined-text-field>
          <md-outlined-text-field label="K√©p URL" id="imageNews"></md-outlined-text-field>
          <md-outlined-text-field label="Link" id="linkNews"></md-outlined-text-field>
          <md-outlined-text-field label="D√°tum (pl. 20250120)" id="dateNews" maxlength="8" type="text"
            autocomplete="off">
          </md-outlined-text-field>
          <div id="datePreviewNews" class="date-preview"></div>
          <div style="margin-bottom: 16px;">
            <md-checkbox id="hubExclusiveNews"></md-checkbox>
            <label for="hubExclusiveNews">Hub Exkluz√≠v</label>
          </div>
          <md-filled-button id="publishBtnNews">Publik√°l√°s</md-filled-button>
        </div>
        <p id="statusNews" class="status-text"></p>
      </section>

      <section class="form-card">
        <div class="welcome-container">
          <img src="/EU2K-Hub/assets/add_event.svg" class="welcome-icon" alt="√öj esem√©ny">
          <h1 class="welcome-text">√öj esem√©ny publik√°l√°sa</h1>
        </div>
        <div class="form" id="eventForm">
          <md-outlined-text-field label="C√≠m" id="titleEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Helysz√≠n" id="placeEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Le√≠r√°s" id="descriptionEvent"></md-outlined-text-field>
          <md-outlined-text-field label="K√©p URL" id="imageEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Link" id="linkEvent"></md-outlined-text-field>
          <md-outlined-text-field label="D√°tum (pl. 20250120)" id="dateEvent" maxlength="8" type="text"
            autocomplete="off">
          </md-outlined-text-field>
          <div id="datePreviewEvent" class="date-preview"></div>
          <md-filled-button id="publishBtnEvent">Publik√°l√°s</md-filled-button>
        </div>
        <p id="statusEvent" class="status-text"></p>
      </section>
    </div>
  </div>
</template>

<div id="site-footer" class="footer" aria-label="Site footer">
  <div class="footer-container">
    <div class="footer-left">
      <img src="../eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
    </div>
    <div class="footer-center">
      <a class="footer-privacy" href="/EU2K-Hub/index.html#privacy-policy">Adatkezel√©si T√°j√©koztat√≥</a>
    </div>
    <div class="footer-right">
      <img src="../eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
      <img src="../eu2k_dok_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
    </div>
  </div>
</div>

</html>