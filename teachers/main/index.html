<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EU2K Teacher Hub</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body,
    * {
      font-family: "Roboto", sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      font-variation-settings: "wdth" 100;
    }
  </style>
  <link rel="stylesheet" href="home.css">
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "s6n7qpfkv4");
  </script>
  <script type="importmap">
  {
    "imports": {
      "@material/web/": "https://esm.run/@material/web/"
    }
  }
</script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="module">
    // Firebase importok
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getAuth, signInWithRedirect, getRedirectResult, signOut, onAuthStateChanged, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    // V√°rjuk meg, hogy a DOM bet√∂lt≈ëdj√∂n
    document.addEventListener('DOMContentLoaded', async () => {
      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
        authDomain: "eu2k-hub.firebaseapp.com",
        projectId: "eu2k-hub",
        storageBucket: "eu2k-hub.firebasestorage.app",
        messagingSenderId: "560244867055",
        appId: "1:560244867055:web:c5bbfe3939fdec9f89001a",
        measurementId: "G-LB2WZ574GJ"
      };

      // Firebase inicializ√°l√°s
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      // Login gomb (redirect-tel)
      const loginBtn = document.getElementById("loginBtn");
      if (loginBtn) {
        loginBtn.addEventListener("click", () => {
          signInWithRedirect(auth, provider);
        });
      }

      // Visszat√©r√©si eredm√©ny feldolgoz√°sa
      getRedirectResult(auth)
        .then((result) => {
          if (result?.user) {
            console.log("Sikeres redirect login:", result.user.displayName);
          }
        })
        .catch((error) => {
          console.error("Redirect login hiba:", error);
        });

      // Logout gomb
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          signOut(auth).then(() => {
            console.log("Kijelentkezve.");
          });
        });
      }

      // Login √°llapot figyel√©se
      onAuthStateChanged(auth, (user) => {
        if (user) {
          console.log("Bejelentkezve:", user.displayName);
          if (loginBtn) loginBtn.style.display = "none";
          if (logoutBtn) logoutBtn.style.display = "inline-block";
        } else {
          if (loginBtn) loginBtn.style.display = "inline-block";
          if (logoutBtn) logoutBtn.style.display = "none";
        }
      });
    });
  </script>
</head>

<body>
  <div class="app-bg">
    <aside class="sidebar">
      <nav class="nav-menu">
        <a class="nav-item active" href="/main/index.html">
          <div class="nav-icon-container">
            <img src="/assets/control_panel.svg" class="nav-icon" alt="Vez√©rl≈ëpult">
          </div>
          <span>Vez√©rl≈ëpult</span>
        </a>
        <a class="nav-item" href="/main/qr-code.html">
          <div class="nav-icon-container">
            <img src="/assets/students.svg" class="nav-icon" alt="Di√°kok">
          </div>
          <span>Di√°kok</span>
        </a>
        <a class="nav-item" href="/main/youhub.html">
          <div class="nav-icon-container">
            <img src="/assets/calendar.svg" class="nav-icon" alt="Napt√°r">
          </div>
          <span>Napt√°r</span>
        </a>
        <a class="nav-item" href="/main/courses.html">
          <div class="nav-icon-container">
            <img src="/assets/hive.svg" class="nav-icon" alt="Hive">
          </div>
          <span>Hive</span>
        </a>
        <div class="sidebar-divider"></div>
        <a class="nav-item" href="/main/index.html">
          <div class="nav-icon-container">
            <img src="/assets/home_icon.svg" class="nav-icon" alt="Otthon">
          </div>
          <span>Otthon</span>
        </a>
        <a class="nav-item" href="/main/qr-code.html">
          <div class="nav-icon-container">
            <img src="/assets/qr_code_icon.svg" class="nav-icon" alt="QR-K√≥d">
          </div>
          <span>QR-K√≥d</span>
        </a>
        <a class="nav-item" href="/main/youhub.html">
          <div class="nav-icon-container">
            <img src="/assets/youhub_icon.svg" class="nav-icon" alt="YouHub">
          </div>
          <span>YouHub</span>
        </a>
        <a class="nav-item" href="/main/courses.html">
          <div class="nav-icon-container">
            <img src="/assets/courses_icon.svg" class="nav-icon" alt="Kurzusok">
          </div>
          <span>Kurzusok</span>
        </a>
      </nav>
    </aside>
    <main class="main-area">
      <div class="main-content">
        <header class="header">
          <div class="welcome-container">
            <img src="/assets/welcome_hand_icon.svg" class="welcome-icon" alt="Welcome">
            <h1 class="welcome-text">J√≥ reggelt!</h1>
          </div>
          <div class="header-icons">
            <a href="/system/account.html" class="header-icon-link">
              <img src="/assets/account_icon.svg" class="header-icon" alt="Account">
            </a>
            <a href="/settings/settings.html" class="header-icon-link">
              <img src="/assets/settings_icon.svg" class="header-icon" alt="Settings">
            </a>
          </div>
        </header>
        <section class="events-section">
          <div class="section-title">
            K√∂zelg≈ë Esem√©nyek
            <img src="/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>
          <div class="event-frame">
            <div class="top-cards-row">
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny Neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>
              <div class="event-container">
                <div class="red-card small"></div>
              </div>
            </div>
          </div>
        </section>
        <section class="news-section">
          <div class="section-title">
            H√≠rek
            <img src="/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>
          <div class="bottom-cards-row">
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
            <div class="news-card">
              <div class="red-rect"></div>
              <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
            </div>
          </div>
          <div style="text-align:center;margin-top:24px;">
            <md-filled-button id="publishBtnNav">H√≠r / Esem√©ny Publik√°l√°sa</md-filled-button>
          </div>
          <div style="text-align:center;margin-top:24px;">
            <md-filled-button id="loginBtn">üîê Bejelentkez√©s Google-lel</md-filled-button>
            <md-outlined-button id="logoutBtn" style="display: none;">üö™ Kijelentkez√©s</md-outlined-button>
          </div>
        </section>
        <section id="publish-section" style="display:none;"></section>
      </div>
    </main>
  </div>
  <div id="event-mask"></div>
  <script>
    // SPA routing √©s tartalomv√°lt√°s - Hash alap√∫ navig√°ci√≥
    const publishSection = document.getElementById('publish-section');
    const publishBtnNav = document.getElementById('publishBtnNav');
    const dashboardSections = [
      document.querySelector('.header'),
      document.querySelector('.events-section'),
      document.querySelector('.news-section')
    ];

    function showPage(pageId) {
      // Minden oldal elrejt√©se
      dashboardSections.forEach(section => section.style.display = 'none');
      publishSection.style.display = 'none';

      // Megfelel≈ë oldal megjelen√≠t√©se
      if (pageId === 'publish') {
        publishSection.style.display = '';

        // Template bet√∂lt√©se ha sz√ºks√©ges
        if (!publishSection.innerHTML.trim()) {
          const template = document.getElementById('courses-page');
          if (template) {
            publishSection.appendChild(template.content.cloneNode(true));
            setupCoursesPageLogic();
          }
        }
      } else {
        // Dashboard megjelen√≠t√©se (alap√©rtelmezett)
        dashboardSections.forEach(section => section.style.display = '');
      }
    }

    function navigate(event, pageId) {
      event.preventDefault();
      location.hash = pageId;
    }

    // Publik√°l√°s gomb esem√©nykezel≈ë
    if (publishBtnNav) {
      publishBtnNav.addEventListener('click', e => {
        navigate(e, 'publish');
      });
    }

    // Hash v√°ltoz√°s figyel√©se
    window.addEventListener('hashchange', () => {
      const page = location.hash.substring(1) || 'dashboard';
      showPage(page);
    });

    // Oldal bet√∂lt√©sekor
    window.addEventListener('DOMContentLoaded', () => {
      const initialPage = location.hash.substring(1) || 'dashboard';
      showPage(initialPage);
    });

    // Initial page load (ha m√°r bet√∂lt√∂tt a DOM)
    if (document.readyState === 'loading') {
      // A DOMContentLoaded esem√©ny fogja kezelni
    } else {
      const initialPage = location.hash.substring(1) || 'dashboard';
      showPage(initialPage);
    }
  </script>
  <script>
    async function setupCoursesPageLogic() {
      if (window.coursesPageLoaded) return;
      window.coursesPageLoaded = true;

      const {
        initializeApp
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js");
      const {
        getAnalytics
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js");
      const {
        getFirestore,
        collection,
        getDocs,
        setDoc,
        doc,
        Timestamp
      } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");

      const firebaseConfig = {
        apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
        authDomain: "eu2k-hub.firebaseapp.com",
        projectId: "eu2k-hub",
        storageBucket: "eu2k-hub.firebasestorage.app",
        messagingSenderId: "560244867055",
        appId: "1:560244867055:web:c5bbfe3939fdec9f89001a",
        measurementId: "G-LB2WZ574GJ"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // D√°tum form√°z√°s preview-hoz
      const formatDatePreview = (raw) => {
        if (!raw) return '';
        if (raw.length >= 6) {
          return `${raw.slice(0, 4)}/${raw.slice(4, 6)}/${raw.slice(6)}`;
        } else if (raw.length >= 4) {
          return `${raw.slice(0, 4)}/${raw.slice(4)}`;
        }
        return raw;
      };

      // D√°tum input kezel√©se
      const handleDateInput = (inputEl, previewEl) => {
        inputEl.addEventListener('input', () => {
          let raw = inputEl.value.replace(/\D/g, '').slice(0, 8);
          inputEl.value = raw;
          previewEl.textContent = formatDatePreview(raw);
        });
      };

      handleDateInput(document.getElementById('dateNews'), document.getElementById('datePreviewNews'));
      handleDateInput(document.getElementById('dateEvent'), document.getElementById('datePreviewEvent'));

      // F√ºggv√©ny a mwc textfield-ek t√∂rl√©s√©re
      const clearMwTextFields = (containerId) => {
        document.querySelectorAll(`#${containerId} md-outlined-text-field`).forEach(el => {
          el.value = '';
        });
      };

      // H√≠r publik√°l√°sa
      document.getElementById('publishBtnNews').addEventListener('click', async () => {
        const title = document.getElementById('titleNews').value.trim();
        const hubExclusive = document.getElementById('hubExclusiveNews').checked;
        const author = document.getElementById('authorNews').value.trim();
        const desc = document.getElementById('descNews').value.trim();
        const image = document.getElementById('imageNews').value.trim();
        const link = document.getElementById('linkNews').value.trim();
        const rawDate = document.getElementById('dateNews').value.trim();

        const hibak = [];

        if (!title) hibak.push("Nincs megadva a c√≠m!");
        if (hubExclusive && !author) hibak.push("Hub Exkluz√≠v h√≠rn√©l k√∂telez≈ë a szerz≈ë megad√°sa!");
        if (!desc) hibak.push("Nincs megadva a le√≠r√°s!");
        if (!image) hibak.push("Nincs megadva a k√©p URL!");
        if (!link) hibak.push("Nincs megadva a hivatkoz√°s!");
        if (!rawDate) {
          hibak.push("Nincs megadva a d√°tum!");
        } else if (rawDate.length !== 8) {
          hibak.push("Hib√°s d√°tumform√°tum! √çrd be 8 sz√°mjeggyel, pl. 20250120.");
        } else {
          const year = rawDate.slice(0, 4);
          const month = rawDate.slice(4, 6);
          const day = rawDate.slice(6, 8);
          const dateObj = new Date(`${year}-${month}-${day}`);
          if (isNaN(dateObj)) {
            hibak.push("√ârv√©nytelen d√°tum!");
          }
        }

        if (hibak.length > 0) {
          document.getElementById('statusNews').innerHTML = hibak.join("<br>");
          return;
        }

        const year = rawDate.slice(0, 4);
        const month = rawDate.slice(4, 6);
        const day = rawDate.slice(6, 8);
        const dateObj = new Date(`${year}-${month}-${day}`);
        const timestamp = Timestamp.fromDate(dateObj);

        const hirekRef = collection(db, "homePageData", "news", "hirek");
        const snapshot = await getDocs(hirekRef);

        let maxId = 0;
        snapshot.forEach(docSnap => {
          const docId = parseInt(docSnap.id);
          if (!isNaN(docId) && docId > maxId) maxId = docId;
        });

        const newId = (maxId + 1).toString();

        await setDoc(doc(hirekRef, newId), {
          title,
          author: hubExclusive ? author : '',
          desc,
          image,
          link,
          hubExclusive,
          date: timestamp
        });

        document.getElementById('statusNews').textContent = "‚úÖ H√≠r sikeresen kiadva!";
        clearMwTextFields('newsForm');
        document.getElementById('datePreviewNews').textContent = '';
      });

      // Esem√©ny publik√°l√°sa
      document.getElementById('publishBtnEvent').addEventListener('click', async () => {
        const title = document.getElementById('titleEvent').value.trim();
        const place = document.getElementById('placeEvent').value.trim();
        const description = document.getElementById('descriptionEvent').value.trim();
        const image = document.getElementById('imageEvent').value.trim();
        const link = document.getElementById('linkEvent').value.trim();
        const rawDate = document.getElementById('dateEvent').value.trim();

        const hibak = [];

        if (!title) hibak.push("Nincs megadva a c√≠m!");
        if (!place) hibak.push("Nincs megadva a helysz√≠n!");
        if (!description) hibak.push("Nincs megadva a le√≠r√°s!");
        if (!image) hibak.push("Nincs megadva a k√©p URL!");
        if (!rawDate) {
          hibak.push("Nincs megadva a d√°tum!");
        } else if (rawDate.length !== 8) {
          hibak.push("Hib√°s d√°tumform√°tum! √çrd be 8 sz√°mjeggyel, pl. 20250120.");
        } else {
          const year = rawDate.slice(0, 4);
          const month = rawDate.slice(4, 6);
          const day = rawDate.slice(6, 8);
          const dateObj = new Date(`${year}-${month}-${day}`);
          if (isNaN(dateObj)) {
            hibak.push("√ârv√©nytelen d√°tum!");
          }
        }

        if (hibak.length > 0) {
          document.getElementById('statusEvent').innerHTML = hibak.join("<br>");
          return;
        }

        const year = rawDate.slice(0, 4);
        const month = rawDate.slice(4, 6);
        const day = rawDate.slice(6, 8);
        const dateObj = new Date(`${year}-${month}-${day}`);
        const timestamp = Timestamp.fromDate(dateObj);

        const esemenyekRef = collection(db, "homePageData", "events", "esemenyek");
        const snapshot = await getDocs(esemenyekRef);

        let maxId = 0;
        snapshot.forEach(docSnap => {
          const docId = parseInt(docSnap.id);
          if (!isNaN(docId) && docId > maxId) maxId = docId;
        });

        const newId = (maxId + 1).toString();

        await setDoc(doc(esemenyekRef, newId), {
          title,
          description,
          place,
          image,
          link,
          date: timestamp
        });

        document.getElementById('statusEvent').textContent = "Esem√©ny sikeresen publik√°lva!";
        clearMwTextFields('eventForm');
        document.getElementById('datePreviewEvent').textContent = '';
      });

      // Hub Exkluz√≠v checkbox logika
      document.getElementById('hubExclusiveNews').addEventListener('change', function () {
        const authorField = document.getElementById('authorNews');
        if (this.checked) {
          authorField.removeAttribute('disabled');
        } else {
          authorField.setAttribute('disabled', '');
          authorField.value = '';
        }
      });

      // Vissza gomb funkci√≥
      document.getElementById('backToHome').addEventListener('click', function (e) {
        e.preventDefault();
        location.hash = 'dashboard';
      });
    }
  </script>
</body>
<template id="courses-page">
  <div class="publish-layout">
    <div class="back-arrow-column">
      <md-filled-button id="backToHome" class="back-arrow-btn">
        <img src="/assets/arrowback.svg" alt="Vissza" class="arrow-img">
      </md-filled-button>
    </div>
    <div class="publish-content">
      <header class="header">
        <div class="welcome-container">
          <img src="/assets/add_news.svg" class="welcome-icon" alt="√öj H√≠r">
          <h1 class="welcome-text">√öj h√≠r publik√°l√°sa</h1>
        </div>
        <div class="header-icons">
          <a href="/system/account.html" class="header-icon-link">
            <img src="/assets/account_icon.svg" class="header-icon" alt="Account">
          </a>
          <a href="/settings/settings.html" class="header-icon-link">
            <img src="/assets/settings_icon.svg" class="header-icon" alt="Settings">
          </a>
        </div>
      </header>
      <section class="form-card">
        <div class="form" id="newsForm">
          <md-outlined-text-field label="C√≠m" id="titleNews"></md-outlined-text-field>
          <md-outlined-text-field label="Szerz≈ë" id="authorNews" disabled></md-outlined-text-field>
          <md-outlined-text-field label="Le√≠r√°s" id="descNews"></md-outlined-text-field>
          <md-outlined-text-field label="K√©p URL" id="imageNews"></md-outlined-text-field>
          <md-outlined-text-field label="Link" id="linkNews"></md-outlined-text-field>
          <md-outlined-text-field label="D√°tum (pl. 20250120)" id="dateNews" maxlength="8" type="text"
            autocomplete="off">
          </md-outlined-text-field>
          <div id="datePreviewNews" class="date-preview"></div>
          <div style="margin-bottom: 16px;">
            <md-checkbox id="hubExclusiveNews"></md-checkbox>
            <label for="hubExclusiveNews">Hub Exkluz√≠v</label>
          </div>
          <md-filled-button id="publishBtnNews">Publik√°l√°s</md-filled-button>
        </div>
        <p id="statusNews" class="status-text"></p>
      </section>

      <section class="form-card">
        <div class="welcome-container">
          <img src="/assets/add_event.svg" class="welcome-icon" alt="√öj esem√©ny">
          <h1 class="welcome-text">√öj esem√©ny publik√°l√°sa</h1>
        </div>
        <div class="form" id="eventForm">
          <md-outlined-text-field label="C√≠m" id="titleEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Helysz√≠n" id="placeEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Le√≠r√°s" id="descriptionEvent"></md-outlined-text-field>
          <md-outlined-text-field label="K√©p URL" id="imageEvent"></md-outlined-text-field>
          <md-outlined-text-field label="Link" id="linkEvent"></md-outlined-text-field>
          <md-outlined-text-field label="D√°tum (pl. 20250120)" id="dateEvent" maxlength="8" type="text"
            autocomplete="off">
          </md-outlined-text-field>
          <div id="datePreviewEvent" class="date-preview"></div>
          <md-filled-button id="publishBtnEvent">Publik√°l√°s</md-filled-button>
        </div>
        <p id="statusEvent" class="status-text"></p>
      </section>
    </div>
  </div>
</template>

</html>