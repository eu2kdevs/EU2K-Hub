rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // -----------------------------
    // PROFILE PHOTOS
    // -----------------------------
    match /profilePhotos/{fileName} {
      allow read: if request.auth != null;

      allow write: if request.auth != null
        && (
          request.auth.uid == fileName
          || fileName.matches('^' + request.auth.uid + '\\.(jpg|png|jpeg)$')
        );
    }

    // -----------------------------
    // NEWS PICTURES
    // Only Cloud Functions can write (using Admin SDK)
    // -----------------------------
    match /newsPictures/{imageId} {
      allow read: if true;
      allow write: if false; // Cloud Functions use Admin SDK
    }

    // -----------------------------
    // OTHER FILES
    // ⚠️ WARNING: This catch-all rule is potentially dangerous!
    // TODO: Narrow down to specific paths in future refactor
    // -----------------------------
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}