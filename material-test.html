<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material 3 Expressive Test</title>
    <style>
        :root {
            color-scheme: dark;
            --md-sys-color-primary: rgb(155 212 160);
            --md-sys-color-surface-tint: rgb(155 212 160);
            --md-sys-color-on-primary: rgb(0 57 21);
            --md-sys-color-primary-container: rgb(27 81 41);
            --md-sys-color-on-primary-container: rgb(182 241 187);
            --md-sys-color-secondary: rgb(157 212 158);
            --md-sys-color-on-secondary: rgb(2 57 19);
            --md-sys-color-secondary-container: rgb(30 81 39);
            --md-sys-color-on-secondary-container: rgb(184 241 185);
            --md-sys-color-tertiary: rgb(154 212 162);
            --md-sys-color-on-tertiary: rgb(0 57 23);
            --md-sys-color-tertiary-container: rgb(25 81 42);
            --md-sys-color-on-tertiary-container: rgb(181 241 189);
            --md-sys-color-error: rgb(255 179 178);
            --md-sys-color-on-error: rgb(86 29 32);
            --md-sys-color-error-container: rgb(115 51 53);
            --md-sys-color-on-error-container: rgb(255 218 217);
            --md-sys-color-background: rgb(16 21 16);
            --md-sys-color-on-background: rgb(224 228 220);
            --md-sys-color-surface: rgb(16 21 16);
            --md-sys-color-on-surface: rgb(224 228 220);
            --md-sys-color-surface-variant: rgb(65 73 65);
            --md-sys-color-on-surface-variant: rgb(193 201 190);
            --md-sys-color-outline: rgb(139 147 137);
            --md-sys-color-outline-variant: rgb(65 73 65);
            --md-sys-color-shadow: rgb(0 0 0);
            --md-sys-color-scrim: rgb(0 0 0);
            --md-sys-color-inverse-surface: rgb(224 228 220);
            --md-sys-color-inverse-on-surface: rgb(45 50 44);
            --md-sys-color-inverse-primary: rgb(53 105 63);
            --md-sys-color-primary-fixed: rgb(182 241 187);
            --md-sys-color-on-primary-fixed: rgb(0 33 9);
            --md-sys-color-primary-fixed-dim: rgb(155 212 160);
            --md-sys-color-on-primary-fixed-variant: rgb(27 81 41);
            --md-sys-color-secondary-fixed: rgb(184 241 185);
            --md-sys-color-on-secondary-fixed: rgb(0 33 8);
            --md-sys-color-secondary-fixed-dim: rgb(157 212 158);
            --md-sys-color-on-secondary-fixed-variant: rgb(30 81 39);
            --md-sys-color-tertiary-fixed: rgb(181 241 189);
            --md-sys-color-on-tertiary-fixed: rgb(0 33 11);
            --md-sys-color-tertiary-fixed-dim: rgb(154 212 162);
            --md-sys-color-on-tertiary-fixed-variant: rgb(25 81 42);
            --md-sys-color-surface-dim: rgb(16 21 16);
            --md-sys-color-surface-bright: rgb(54 58 53);
            --md-sys-color-surface-container-lowest: rgb(11 15 11);
            --md-sys-color-surface-container-low: rgb(24 29 24);
            --md-sys-color-surface-container: rgb(28 33 28);
            --md-sys-color-surface-container-high: rgb(38 43 38);
            /* Állítható nagyítás a Flutter iframe-hez */
            --flutter-scale: 1.35;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #101510;
            color: var(--md-sys-color-on-background);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--md-sys-color-surface-container);
            padding: 16px 24px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .header h1 {
            color: var(--md-sys-color-primary);
            font-size: 24px;
            font-weight: 500;
        }

        .header p {
            color: var(--md-sys-color-on-surface-variant);
            font-size: 14px;
            margin-top: 4px;
        }

        .iframe-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* Alap Flutter iframe stílus */
        .flutter-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: transparent;
        }
        /* Növelt méret: az indicatorContainer-ben lévő Flutter iframe nagyítása */
        #indicatorContainer iframe {
            transform: scale(var(--flutter-scale, 1.35));
            transform-origin: center center;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--md-sys-color-background);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            color: var(--md-sys-color-on-background);
            font-size: 16px;
            margin-top: 16px;
        }

        .indicator-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #101510;
        }

        .under-gradient-strip {
            position: absolute;
            left: 0;
            right: 0;
            /* Below the indicator centerline: 50% + ~88px */
            top: calc(50% + 88px);
            height: 24px;
            background: linear-gradient(to bottom, #101510 0%, rgba(16, 21, 16, 0) 100%);
            pointer-events: none;
            z-index: 50; /* Above iframe if needed */
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            padding: 8px 16px;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            transform: translateY(-1px);
        }

        .control-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Material Test - Flutter Integration</h1>
        <p>Flutter projekt beágyazása iframe-mel</p>
    </div>
    
    <div class="iframe-container">
        <div class="loading-overlay" id="loadingOverlay">
            <div>
                <div class="loading-text">Flutter alkalmazás betöltése...</div>
            </div>
        </div>
        
        <div class="indicator-container" id="indicatorContainer">
            <!-- Flutter iframes will be dynamically inserted here -->
        </div>
        <div class="under-gradient-strip"></div>
        
        <div class="controls">
            <button id="showContained" class="control-btn">Contained Loading</button>
            <button id="showUncontained" class="control-btn">Uncontained Loading</button>
            <button id="hideIndicator" class="control-btn">Hide Indicator</button>
        </div>
    </div>

    <!-- Include Flutter Handler -->
    <script src="/EU2K-Hub/assets/js/flutter-handler.js"></script>
    
    <script>
        // Flutter Handler integration
        const loadingOverlay = document.getElementById('loadingOverlay');
        const indicatorContainer = document.getElementById('indicatorContainer');
        const showContainedBtn = document.getElementById('showContained');
        const showUncontainedBtn = document.getElementById('showUncontained');
        const hideIndicatorBtn = document.getElementById('hideIndicator');

        let currentIndicator = null;

        // Wait for Flutter Handler to be ready
        function waitForFlutterHandler() {
            return new Promise((resolve) => {
                if (window.flutterHandler) {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (window.flutterHandler) {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                }
            });
        }

        // Initialize the application
        async function init() {
            await waitForFlutterHandler();
            
            console.log('Flutter Handler ready, checking preload status...');
            
            // Check if iframes are preloaded
            const checkPreloadStatus = () => {
            const containedReady = window.flutterHandler.isReady('contained');
            const uncontainedReady = window.flutterHandler.isReady('uncontained');
                
                if (containedReady && uncontainedReady) {
                    console.log('All Flutter iframes are ready');
                    loadingOverlay.classList.add('hidden');
                } else {
                    console.log('Waiting for Flutter iframes to load...');
                    setTimeout(checkPreloadStatus, 500);
                }
            };
            
            checkPreloadStatus();
        }

        // Show contained loading indicator
        function showContained() {
            if (currentIndicator) {
                window.flutterHandler.hideLoadingIndicator(currentIndicator);
            }
            
            const success = window.flutterHandler.showLoadingIndicator('contained', indicatorContainer, {
                fadeIn: true,
                fadeInDuration: 300
            });
            
            if (success) {
                currentIndicator = 'contained';
                console.log('Showing contained loading indicator');
                const iframe = window.flutterHandler.iframes.get('contained');
                if (iframe) {
                    iframe.classList.add('scaled-iframe');
                }
            } else {
                console.error('Failed to show contained loading indicator');
            }
        }

        // Show uncontained loading indicator
        function showUncontained() {
            if (currentIndicator) {
                window.flutterHandler.hideLoadingIndicator(currentIndicator);
            }
            
            const success = window.flutterHandler.showLoadingIndicator('uncontained', indicatorContainer, {
                fadeIn: true,
                fadeInDuration: 300
            });
            
            if (success) {
                currentIndicator = 'uncontained';
                console.log('Showing uncontained loading indicator');
                const iframe = window.flutterHandler.iframes.get('uncontained');
                if (iframe) {
                    iframe.classList.add('scaled-iframe');
                }
            } else {
                console.error('Failed to show uncontained loading indicator');
            }
        }

        // Hide current loading indicator
        function hideIndicator() {
            if (currentIndicator) {
                window.flutterHandler.hideLoadingIndicator(currentIndicator, {
                    fadeOut: true,
                    fadeOutDuration: 300
                });
                currentIndicator = null;
                console.log('Hiding loading indicator');
            }
        }

        // Event listeners
        showContainedBtn.addEventListener('click', showContained);
        showUncontainedBtn.addEventListener('click', showUncontained);
        hideIndicatorBtn.addEventListener('click', hideIndicator);

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', init);

        // Debug functions
        window.showContainedIndicator = showContained;
        window.showUncontainedIndicator = showUncontained;
        window.hideLoadingIndicator = hideIndicator;
        window.getFlutterHandler = () => window.flutterHandler;
    </script>
</body>
</html>