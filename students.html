<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Üdvözöllek az EU2K Hub-ban! Fedezd fel a legújabb eseményeket, híreket és tanulási lehetőségeket egy helyen.">
  <title data-translate="pages.students.title" data-translate-fallback="Diákjaim">Diákjaim</title>
  <link rel="stylesheet" href="students.css">
  <link rel="stylesheet" href="assets/css/consent-banner.css">
  <link rel="icon" href="favicon.ico">
  <script>
    (function(){
      if (!document.getElementById('eu2k-page-overlay')) {
        var o = document.createElement('div');
        o.id = 'eu2k-page-overlay';
        o.style.cssText = 'position:fixed;inset:0;z-index:9999;background:#000000;border-radius:32px;opacity:1;transition:opacity 300ms ease-in-out;';
        var inner = document.createElement('div');
        inner.style.cssText = 'position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#000000;border-radius:32px;';
        var m = document.createElement('div');
        m.id = 'eu2k-overlay-mount';
        m.style.cssText = 'position:relative;width:100%;height:100%';
        inner.appendChild(m);
        o.appendChild(inner);
        document.documentElement.appendChild(o);
      }
    })();
  </script>
  <style>
    /* Typography imports to match Figma */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body,
    * {
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      font-variation-settings: "wdth" 100;
    }

    /* Scrollbar elrejtése a news carousel-ben */
    #event-frame {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #event-frame::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Ensure events don't slide under header */
    .events-section { margin-top: 8px; }

    /* Footer links spacing */
    .footer-center { display: flex; gap: 8px; align-items: center; justify-content: center; }
  </style>
  <script src="assets/js/page-overlay-loader.js"></script>
  <script>
    // Fallback: if overlay loader fails (e.g., due to path issues), ensure overlay is removed
    window.addEventListener('load', function() {
      try {
        var o = document.getElementById('eu2k-page-overlay');
        if (o) {
          o.style.opacity = '0';
          o.style.pointerEvents = 'none';
          setTimeout(function(){ try { o.remove(); } catch(e){} }, 300);
        }
      } catch (e) { /* no-op */ }
    });
  </script>
  <script src="assets/js/permissions.js"></script>
  <script src="assets/js/translations.js"></script>
  <script src="assets/js/account-tooltip.js"></script>
  <script>
    // Fordítási rendszer inicializálása
    document.addEventListener('DOMContentLoaded', async () => {
      if (window.translationManager) {
        try {
          if (!window.translationManager.isInitialized && window.translationManager.init) {
            await window.translationManager.init();
          }
          if (window.translationManager.applyTranslations) {
            window.translationManager.applyTranslations();
          }
        } catch (e) {
          console.error('[Index] Translation error:', e);
        }
      }
    });
    // Nyelvváltás storage eseményre is
    window.addEventListener('storage', async (evt) => {
      if (evt.key === 'eu2k_language' && window.translationManager) {
        try {
          await window.translationManager.switchLanguage(evt.newValue || 'hu');
          window.translationManager.applyTranslations?.();
        } catch (e) {
          console.error('[Index] Storage translation error:', e);
        }
      }
    });
  </script>
  <!-- <script src="assets/js/welcome-screen.js"></script> -->
  <script src="assets/js/auth-state.js"></script>
  <script src="assets/js/test_firebase.js" type="module"></script>
  <script src="assets/js/firebase-performance.js" type="module"></script>
  <script src="assets/js/youhub-notification-toaster.js" type="module"></script>
  <script src="assets/js/first-input-delay.js"></script>
  <script src="assets/global/hub-maintenance-overlay.js"></script>
  <script type="text/javascript" data-gdpr-required>
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "s6n7qpfkv4");
  </script>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    // Firebase Analytics GDPR szerint beleegyezést igényel
    import { getFirestore, collection, onSnapshot, query, orderBy, limit, startAfter, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getStorage, ref as storageRef, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Firebase Analytics csak GDPR beleegyezés után inicializálódik
    let analytics = null;
    if (window.eu2kGDPR && window.eu2kGDPR.hasConsent()) {
      analytics = getAnalytics(app);
    } else {
      // Várunk a GDPR beleegyezésre
      window.addEventListener('eu2k-gdpr-scripts-loaded', () => {
        if (!analytics) {
          analytics = getAnalytics(app);
        }
      });
    }
    const db = getFirestore(app);
    const storage = getStorage(app);
    const functions = getFunctions(app, 'europe-west1');

    // Make Firebase app and services globally available
    window.firebaseApp = app;
    window.db = db;
    window.functions = functions;
    window.createHttpsCallable = (name) => httpsCallable(functions, name);
    window.storage = storage;

    // Import Firestore debug module
    import('./assets/js/firestore-debug.js').catch(err => {
      console.warn('Firestore debug module not loaded:', err);
    });

    // Import Firebase test module
    import('./assets/js/test_firebase.js').catch(err => {
      console.warn('Firebase test module not loaded:', err);
    });

    /* ---------------------- INIT ----------------------- */
    window.addEventListener("load", () => {
      console.log('Page loaded, initializing...');

        // Info banner persistence (hide on close, remember in localStorage)
        try {
          const INFO_BANNER_KEY = 'eu2k-hide-info-banner';
          const banner = document.querySelector('.info-banner');
          // Ensure default key exists and is 'false' (banner shown by default)
          try { if (localStorage.getItem(INFO_BANNER_KEY) === null) localStorage.setItem(INFO_BANNER_KEY, 'false'); } catch(_) {}

          // BEFORE anything else: if key is true, do not show banner at all
          try {
            if (localStorage.getItem(INFO_BANNER_KEY) === 'true' && banner) {
              banner.style.setProperty('display', 'none', 'important');
              // notify spacing logic
              try { window.dispatchEvent(new Event('eu2k-banner-visibility-changed')); } catch(_) {}
            }
          } catch(_) {}

          // Use capture on the whole document to guarantee we see the click
          document.addEventListener('click', (e) => {
            const target = e.target && e.target.closest ? e.target.closest('.info-banner .banner-btn') : null;
            if (!target) return;
            e.preventDefault();
            e.stopPropagation();
            const isPrimary = target.classList.contains('primary');
            const isSecondary = target.classList.contains('secondary');
            if (isPrimary) {
              try { localStorage.setItem(INFO_BANNER_KEY, 'true'); console.log('[InfoBanner] Close clicked → stored flag'); } catch(err) { console.warn('[InfoBanner] LS write failed', err); }
              const b = document.querySelector('.info-banner');
              if (b) { b.style.setProperty('display','none','important'); console.log('[InfoBanner] Banner hidden via click'); }
              try { window.dispatchEvent(new Event('eu2k-banner-visibility-changed')); } catch(_) {}
              return false;
            }
            if (isSecondary) {
              try { console.log('[InfoBanner] Feedback clicked'); window.open('#feedback', '_blank'); } catch(err) { console.warn('[InfoBanner] Feedback open failed', err); }
              return false;
            }
          }, true);
        } catch (e) { /* no-op */ }
    });

  </script>
</head>

<body>
  <div class="app-bg">
    <!-- Sidebar / Navigation Rail (left) -->
    <aside class="sidebar" role="navigation" aria-label="Fő navigáció">
      <div class="nav-frame">
        <div class="nav-shell">
          <nav class="nav-rail">
            <a class="rail-item nav-btn" href="index.html" aria-current="page">
              <div class="rail-icon">
                <img src="assets/navbar/home.svg" alt="Otthon" />
              </div>
              <span class="rail-label" data-translate="navigation.home">Otthon</span>
            </a>

            <a class="rail-item nav-btn" href="qr-code.html">
              <div class="rail-icon">
                <img src="assets/navbar/qr_code.svg" alt="QR-Kód" />
              </div>
              <span class="rail-label" data-translate="navigation.qr" data-translate-fallback="QR-Kód">QR-Kód</span>
            </a>

            <a class="rail-item nav-btn" href="youhub.html">
              <div class="rail-icon">
                <img src="assets/navbar/youhub.svg" alt="YouHub" />
              </div>
              <span class="rail-label" data-translate="navigation.youhub">YouHub</span>
            </a>

            <!-- Class Hub (YouHub és Event Hub közé) -->

            <!-- Event Hub Hub (Class Hub és Food Hub közé) -->

            <!-- Food Hub (Event Hub után)-->

          </nav>
        </div>
      </div>
    </aside>

    <main class="main-area">
      <div class="main-scroll-area">
          <!-- Header -->
          <header class="header">
            <div class="header-content">
              <div class="welcome-container">
                <img src="assets/navbar/students.svg" class="welcome-icon" alt="Diákjaim">
                <span class="welcome-text" data-translate="pages.students.heading" data-translate-fallback="Diákjaim">Diákjaim</span>
              </div>
              <div class="header-icon-container">
                <div class="header-icon-gradient">
                  <div class="header-icon-wrapper" id="headerSettingsWrapper">
                    <a href="settings.html" class="header-icon-btn" id="headerSettingsBtn">
                      <img src="assets/general/settings.svg" alt="Settings">
                    </a>
                  </div>
                  <div class="header-icon-wrapper" id="headerAccountWrapper" style="display: none;">
                    <button class="header-icon-btn" id="headerAccountBtn">
                      <img src="assets/general/account.svg" alt="Account">
                    </button>
                  </div>
                  <button class="header-login-btn" id="headerLoginBtn" data-translate="pages.general.login" style="display: none;">
                    Bejelentkezés
                  </button>
                </div>
              </div>
            </div>
            <!-- Notification / Info Banner -->
            <section class="info-banner" aria-label="Információ">
              <!-- TODO(Figma): Replace icon if specified in banner design -->
              <div class="info-banner-icon-container">
                <img class="info-banner-icon" src="assets/general/banners/info.svg" alt="Info" />
              </div>
              <div class="banner-content">
                <div class="banner-texts">
                  <span class="info-banner-title" data-translate="pages.index.banner.title" data-translate-fallback="Ez az új dizájn.">Ez az új dizájn.</span>
                  <span class="info-banner-desc" data-translate="pages.index.banner.description" data-translate-fallback="Reméljük neked is tetszik az Európa Dizájn Rendszer. Ha bármi kétséged van, jelezz vissza, akár innen is.">Reméljük neked is tetszik az Európa Dizájn Rendszer. Ha bármi kétséged van, jelezz vissza, akár innen is.</span>
                </div>
                <div class="banner-actions-wrapper">
                  <div class="banner-actions">
                    <button class="banner-btn secondary" type="button" data-translate="pages.index.banner.feedback" data-translate-fallback="Visszajelzés">Visszajelzés</button>
                    <button class="banner-btn primary" type="button" data-translate="pages.index.banner.close" data-translate-fallback="Bezárás">Bezárás</button>
                  </div>
                </div>
              </div>
            </section>
          </header>

        <div class="main-content">
          <!-- Event Container: 3 cards (60% / 30% / 10%) with 32px gaps -->
          <section class="events-container" aria-label="Események">
            <div class="event-card event-card--lg">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="Kép helyőrző" />
              <div class="event-card-overlay event-card-overlay--lg">
                <div class="event-card-title">Title</div>
                <div class="event-card-desc">Body</div>
                <div class="event-card-date" data-translate="pages.index.event_date_place" data-translate-fallback="Dátum és Hely">Dátum és Hely</div>
              </div>
            </div>

            <div class="event-card event-card--md">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="Kép helyőrző" />
              <div class="event-card-overlay event-card-overlay--md">
                <div class="event-card-title">Title</div>
                <div class="event-card-desc">Body</div>
                <div class="event-card-date" data-translate="pages.index.event_date_place" data-translate-fallback="Dátum és Hely">Dátum és Hely</div>
              </div>
            </div>

            <div class="event-card event-card--sm">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="Kép helyőrző" />
            </div>
          </section>

          <script type="module">
            import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

            function lsLoggedInFallback() {
              try { return localStorage.getItem('eu2k-auth-logged-in') === 'true'; } catch { return false; }
            }

            function updateHeaderIcons(loggedIn) {
              const settingsWrapper = document.getElementById('headerSettingsWrapper');
              const accountWrapper = document.getElementById('headerAccountWrapper');
              const loginBtn = document.getElementById('headerLoginBtn');
              const gradientContainer = document.querySelector('.header-icon-gradient');
              if (!settingsWrapper || !accountWrapper || !loginBtn || !gradientContainer) return;

              if (loggedIn) {
                settingsWrapper.style.display = 'flex';
                accountWrapper.style.display = 'flex';
                loginBtn.style.display = 'none';
                gradientContainer.classList.remove('has-login'); // Csak zöld, nincs gradient
              } else {
                settingsWrapper.style.display = 'flex';
                accountWrapper.style.display = 'none';
                loginBtn.style.display = 'flex';
                gradientContainer.classList.add('has-login'); // Van gradient, mert van kék gomb
              }
            }

            try {
              const auth = getAuth();
              onAuthStateChanged(auth, (user) => {
                updateHeaderIcons(!!user);
              });
            } catch (e) {
              // Last resort: localStorage fallback
              updateHeaderIcons(lsLoggedInFallback());
              // Keep in sync with localStorage changes
              window.addEventListener('storage', () => updateHeaderIcons(lsLoggedInFallback()));
              setInterval(() => updateHeaderIcons(lsLoggedInFallback()), 1000);
            }

            // Bejelentkezés gomb kattintás
            const loginBtnEl = document.getElementById('headerLoginBtn');
            if (loginBtnEl) {
              loginBtnEl.addEventListener('click', function() {
                window.location.href = 'onboarding.html';
              });
            }
          </script>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
          <!-- Left Column -->
          <div class="footer-left">
            <!-- Logo and participated section -->
            <div class="footer-logo-container">
              <img src="assets/general/footer/eu2k_hub.png" alt="EU2K Hub">
              <span class="footer-participated-text" data-translate="footer.participated">Részt vett még:</span>
              <div class="footer-participated-logos">
                <img src="assets/general/footer/eu2k.png" alt="EU2K">
                <img src="assets/general/footer/eu2k_devs.png" alt="EU2K Devs">
                <img src="assets/general/footer/eu2k_dok.png" alt="EU2K Dok">
                <img src="assets/general/footer/eu2k_ujsag.png" alt="EU2K Újság">
              </div>
            </div>

            <!-- Copyright -->
            <div class="footer-copyright" data-translate="footer.copyright">
              © 2025 EU2K Devs és Európa 2000 Gimnázium. All Rights Reserved.
            </div>

            <!-- Social icons -->
            <div class="footer-social">
              <img src="assets/general/footer/eu2k_ujsag.svg" alt="EU2K Újság" onclick="window.open('https://sites.google.com/view/eu2k-ujsag', '_blank')">
              <img src="assets/general/footer/x.svg" alt="X (Twitter)" onclick="window.open('https://x.com/eu2kdevs', '_blank')">
              <img src="assets/general/footer/instagram.svg" alt="Instagram" onclick="window.open('https://instagram.com/eu2k.devs', '_blank')">
              <img src="assets/general/footer/yt.svg" alt="YouTube" onclick="window.open('https://youtube.com/@eu2kdevs', '_blank')">
            </div>
          </div>

          <!-- Right Column -->
          <div class="footer-right">
            <!-- Jogi Nyilatkozatok -->
            <div class="footer-section-first">
              <div class="footer-section-title" data-translate="footer.legal.title">Jogi Nyilatkozatok</div>
              <div class="footer-section-items">
                <a href="privacy-policy.html" class="footer-item" data-translate="footer.legal.privacy">Adatvédelmi&nbsp;Tájékoztató</a>
                <a href="terms-of-service.html" class="footer-item" data-translate="footer.legal.terms">Használati&nbsp;Feltételek</a>
              </div>
            </div>

            <!-- Hubs -->
            <div class="footer-section">
              <div class="footer-section-title" data-translate="footer.hubs.title">Hubs</div>
              <div class="footer-section-items">
                <div class="footer-item">YouHub</div>
                <div class="footer-item">Class&nbsp;Hub</div>
                <div class="footer-item">Food&nbsp;Hub</div>
                <div class="footer-item">Event&nbsp;Hub</div>
                <div class="footer-item">Fitness&nbsp;Hub<span class="beta-badge">BETA</span></div>
              </div>
            </div>

          </div>
        </footer>
      </div>
    </main>
  </div>

  <!-- Developer Mode Popup -->
  <div id="devModePopup" class="permission-overlay-scroll-area" style="display: none;">
    <div class="permission-container">
      <button class="permission-close-btn" onclick="closeDevModePopup()">
        <img src="assets/general/close.svg" alt="Bezárás">
      </button>
      <div class="permission-content">
        <h2 class="permission-title" data-translate="youhub.dev_mode.title" data-translate-fallback="Developer Mód">Developer Mód</h2>
        <p class="permission-text" data-translate="youhub.dev_mode.text" data-translate-fallback="Jelszó megadása:">Jelszó megadása:</p>
        <input type="password" id="devModePassword" class="dev-mode-input" data-translate-placeholder="youhub.dev_mode.password_placeholder" placeholder="Jelszó">
        <button class="permission-ok-btn" onclick="checkDevModePassword()" data-translate="youhub.dev_mode.login_button" data-translate-fallback="Bejelentkezés">Bejelentkezés</button>
      </div>
    </div>
  </div>

  <script src="assets/js/developer-mode.js"></script>
  <script src="assets/js/account-tooltip.js"></script>
  <script src="assets/js/footer.js"></script>
  <script src="assets/js/consent-banner.js"></script>
  <script src="assets/js/staff-timer.js"></script>
  <script src="assets/js/staff-nav-items.js"></script>
  <script>
    // Update title and heading after translations load
    document.addEventListener('DOMContentLoaded', () => {
      if (window.translationManager) {
        const updateTexts = () => {
          const title = document.querySelector('title');
          const welcomeText = document.querySelector('.welcome-text');
          
          if (title && window.translationManager.getTranslation('pages.students.title')) {
            title.textContent = window.translationManager.getTranslation('pages.students.title');
          }
          
          if (welcomeText && window.translationManager.getTranslation('pages.students.heading')) {
            welcomeText.textContent = window.translationManager.getTranslation('pages.students.heading');
          }
        };
        
        // Wait for translations to be loaded
        if (window.translationManager.isInitialized) {
          updateTexts();
        } else {
          window.translationManager.init().then(() => {
            updateTexts();
          });
        }
      }
    });

    // Check session and apply/remove blur
    async function checkSessionAndUpdateBlur() {
      const scrollArea = document.querySelector('.main-scroll-area');
      if (!scrollArea) return;

      try {
        // Wait for Firebase
        let retries = 0;
        while ((!window.firebaseApp || !window.functions) && retries < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          retries++;
        }

        if (!window.firebaseApp || !window.functions) {
          console.warn('[Students] Firebase not available for session check');
          scrollArea.classList.add('session-inactive');
          return;
        }

        const { getAuth } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");
        const auth = getAuth(window.firebaseApp);

        await new Promise((resolve) => {
          if (auth.currentUser) {
            resolve();
          } else {
            const unsubscribe = auth.onAuthStateChanged(() => {
              unsubscribe();
              resolve();
            });
          }
        });

        if (!auth.currentUser) {
          scrollArea.classList.add('session-inactive');
          return;
        }

        const { httpsCallable } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js");
        const checkSession = httpsCallable(window.functions, 'staffSessionCheck');
        const result = await checkSession();

        if (result.data.active) {
          scrollArea.classList.remove('session-inactive');
        } else {
          scrollArea.classList.add('session-inactive');
        }
      } catch (error) {
        console.error('[Students] Error checking session:', error);
        scrollArea.classList.add('session-inactive');
      }
    }

    // Check on load
    document.addEventListener('DOMContentLoaded', () => {
      checkSessionAndUpdateBlur();
      // Check periodically
      setInterval(checkSessionAndUpdateBlur, 5000);
    });
  </script>
</body>

</html>