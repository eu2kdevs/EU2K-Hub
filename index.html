<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="√údv√∂z√∂llek az EU2K Hub-ban! Fedezd fel a leg√∫jabb esem√©nyeket, h√≠reket √©s tanul√°si lehet≈ës√©geket egy helyen.">
  <title data-translate="pages.index.title" data-translate-fallback="EU2K Hub">EU2K Hub</title>
  <link rel="stylesheet" href="home.css">
  <link rel="stylesheet" href="assets/css/consent-banner.css">
  <link rel="icon" href="favicon.ico">
  <script>
    (function(){
      if (!document.getElementById('eu2k-page-overlay')) {
        var o = document.createElement('div');
        o.id = 'eu2k-page-overlay';
        o.style.cssText = 'position:fixed;inset:0;z-index:9999;background:#000000;border-radius:32px;opacity:1;transition:opacity 300ms ease-in-out;';
        var inner = document.createElement('div');
        inner.style.cssText = 'position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#000000;border-radius:32px;';
        var m = document.createElement('div');
        m.id = 'eu2k-overlay-mount';
        m.style.cssText = 'position:relative;width:100%;height:100%';
        inner.appendChild(m);
        o.appendChild(inner);
        document.documentElement.appendChild(o);
      }
    })();
  </script>
  <style>
    /* Typography imports to match Figma */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body,
    * {
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      font-variation-settings: "wdth" 100;
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #newsRow {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #newsRow::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #event-frame {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #event-frame::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Ensure events don't slide under header */
    .events-section { margin-top: 8px; }

    /* Horizontal news carousel behavior */
    .news-carousel { overflow: visible; }
    #newsRow {
      display: flex;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
      gap: 12px;
    }

    /* Footer links spacing */
    .footer-center { display: flex; gap: 8px; align-items: center; justify-content: center; }
  </style>
  <script src="assets/js/page-overlay-loader.js"></script>
  <script>
    // Fallback: if overlay loader fails (e.g., due to path issues), ensure overlay is removed
    window.addEventListener('load', function() {
      try {
        var o = document.getElementById('eu2k-page-overlay');
        if (o) {
          o.style.opacity = '0';
          o.style.pointerEvents = 'none';
          setTimeout(function(){ try { o.remove(); } catch(e){} }, 300);
        }
      } catch (e) { /* no-op */ }
    });
  </script>
  <script src="assets/js/permissions.js"></script>
  <script src="assets/js/translations.js"></script>
  <!-- <script src="assets/js/welcome-screen.js"></script> -->
  <script src="assets/js/auth-state.js"></script>
  <script src="assets/js/test_firebase.js" type="module"></script>
  <script src="assets/js/firebase-performance.js" type="module"></script>
  <script src="assets/js/youhub-notification-toaster.js" type="module"></script>
  <script src="assets/js/first-input-delay.js"></script>
  <script src="assets/global/hub-maintenance-overlay.js"></script>
  <script type="text/javascript" data-gdpr-required>
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "s6n7qpfkv4");
  </script>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    // Firebase Analytics GDPR szerint beleegyez√©st ig√©nyel
    import { getFirestore, collection, onSnapshot, query, orderBy, limit, startAfter, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getStorage, ref as storageRef, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Firebase Analytics csak GDPR beleegyez√©s ut√°n inicializ√°l√≥dik
    let analytics = null;
    if (window.eu2kGDPR && window.eu2kGDPR.hasConsent()) {
      analytics = getAnalytics(app);
    } else {
      // V√°runk a GDPR beleegyez√©sre
      window.addEventListener('eu2k-gdpr-scripts-loaded', () => {
        if (!analytics) {
          analytics = getAnalytics(app);
        }
      });
    }
    const db = getFirestore(app);
    const storage = getStorage(app);
    const functions = getFunctions(app, 'europe-west1');

    // Make db and functions globally available
    window.db = db;
    window.functions = functions;
    window.createHttpsCallable = (name) => httpsCallable(functions, name);
    window.storage = storage;

    // Import Firestore debug module
    import('./assets/js/firestore-debug.js').catch(err => {
      console.warn('Firestore debug module not loaded:', err);
    });

    // Import Firebase test module
    import('./assets/js/test_firebase.js').catch(err => {
      console.warn('Firebase test module not loaded:', err);
    });

    /* ---------------------- NEWS ----------------------- */
    let allNewsData = []; // √ñsszes h√≠r adat

    // Sz√∂veg limit√°l√°sa
    function limitText(text, maxLength) {
      if (!text) return '';
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }
    
    // Le√≠r√°s limit√°l√°sa 1 sorra - iterat√≠van r√∂vid√≠t
    function limitDescriptionToOneLine(element, text, maxLength) {
      if (!text || !element) return '';
      
      // El≈ësz√∂r alkalmazzuk a karakter limitet
      let limitedText = text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
      element.textContent = limitedText;
      
      // Ellen≈ërizz√ºk, hogy 1 sorba f√©r-e
      const lineHeight = parseFloat(getComputedStyle(element).lineHeight);
      const actualHeight = element.scrollHeight;
      
      // Ha t√∂bb mint 1 sor, iterat√≠van r√∂vid√≠ts√ºk
      if (actualHeight > lineHeight * 1.5) {
        let currentLength = limitedText.length - 3; // -3 a '...' miatt
        
        while (currentLength > 10 && element.scrollHeight > lineHeight * 1.5) {
          currentLength -= 4; // Vegy√ºnk el 4 karaktert
          limitedText = text.substring(0, currentLength) + '...';
          element.textContent = limitedText;
        }
      }
      
      return limitedText;
    }
    
    // H√≠r k√°rtya l√©trehoz√°sa
    function createNewsCard(newsData) {
      const card = document.createElement('div');
      card.className = 'news-card';
      card.dataset.newsId = newsData.id || '';
      
      // K√©p
      const img = document.createElement('img');
      img.className = 'news-card-image';
      img.src = newsData.image || 'assets/general/image_placeholder_blue.svg';
      img.alt = newsData.title || 'H√≠r k√©pe';
      img.loading = 'lazy';
      
      // Sz√∂vegek kont√©nere
      const contentContainer = document.createElement('div');
      contentContainer.className = 'news-card-content';
      
      // C√≠m (max 20 karakter)
      const title = document.createElement('h3');
      title.className = 'news-card-title';
      title.textContent = limitText(newsData.title || 'H√≠r neve', 20);
      
      // Le√≠r√°s (max 40 karakter, 1 sor)
      const description = document.createElement('p');
      description.className = 'news-card-description';
      const descText = newsData.description || newsData.desc || 'H√≠r le√≠r√°sa';
      description.textContent = descText; // El≈ësz√∂r tegy√ºk be a teljes sz√∂veget
      
      // D√°tum
      const date = document.createElement('p');
      date.className = 'news-card-date';
      const dateValue = newsData.date?.toDate ? newsData.date.toDate() : (newsData.date ? new Date(newsData.date) : new Date());
      date.textContent = dateValue.toLocaleDateString('hu-HU');
      
      contentContainer.appendChild(title);
      contentContainer.appendChild(description);
      contentContainer.appendChild(date);
      
      card.appendChild(img);
      card.appendChild(contentContainer);
      
      // DOM-ba rak√°s ut√°n limit√°ljuk a le√≠r√°st 1 sorra
      setTimeout(() => {
        limitDescriptionToOneLine(description, descText, 40);
      }, 0);
      
      // Kattinthat√≥s√°g
      if (newsData.link && newsData.link.trim() !== '') {
        card.style.cursor = 'pointer';
          card.onclick = () => {
          let url = newsData.link.trim();
            if (!url.startsWith("http://") && !url.startsWith("https://")) url = "https://" + url;
            window.open(url, "_blank");
          };
        }

      return card;
    }


    // H√≠rek bet√∂lt√©se Firebase-b≈ël
    async function loadNews() {
      console.log('üîÑ Loading news...');
      try {
        const hirekRef = collection(db, "homePageData", "news", "hirek");
        const snapshot = await getDocs(hirekRef);
        console.log('üì∞ News snapshot:', snapshot.docs.length, 'documents found');

        if (snapshot.docs.length === 0) {
          console.warn('‚ö†Ô∏è No news documents found');
          initEmptyNewsRow();
          return;
        }

        // Rendezz√ºk ID szerint cs√∂kken≈ë sorrendben
        allNewsData = snapshot.docs
          .map(doc => ({ id: doc.id, ...doc.data() }))
          .sort((a, b) => {
          const idA = parseInt(a.id) || 0;
          const idB = parseInt(b.id) || 0;
            return idB - idA;
          });

        console.log('üì∞ Loaded', allNewsData.length, 'news items');
        initNewsRow();
      } catch (error) {
        console.error('‚ùå Error loading news:', error);
        initEmptyNewsRow();
      }
    }
    
    // News row inicializ√°l√°sa - egyszer≈± lista
    function initNewsRow() {
      const newsRow = document.getElementById('newsRow');
      if (!newsRow) return;
      
      newsRow.innerHTML = '';
      
      console.log('üìã Creating news cards for', allNewsData.length, 'news items');
      
      // Annyi k√°rtya, amennyi h√≠r van
      allNewsData.forEach((newsData, index) => {
        const card = createNewsCard(newsData);
        newsRow.appendChild(card);
        console.log(`‚úÖ Created card ${index}: ${newsData.title}`);
      });
      
      console.log('‚úÖ News row initialized with', allNewsData.length, 'cards');
    }
    
    // √úres news row placeholder-rel
    function initEmptyNewsRow() {
      const newsRow = document.getElementById('newsRow');
      if (!newsRow) return;
      
      newsRow.innerHTML = '';
      
      const placeholderData = {
        title: 'Valami baj van',
        description: 'Nemsok√°ra kijav√≠tjuk',
        image: 'assets/general/image_placeholder_blue.svg',
        date: new Date()
      };
      
      const card = createNewsCard(placeholderData);
      newsRow.appendChild(card);
    }

    /* ---------------------- EVENTS ----------------------- */
    let eventsListenerAttached = false;

    function loadEvents() {
      if (eventsListenerAttached) return;
      eventsListenerAttached = true;

      const eventsRef = collection(db, 'homePageData', 'events', 'esemenyek');

      onSnapshot(eventsRef, (snapshot) => {
        try {
          const now = new Date();
          now.setHours(0, 0, 0, 0); // Mai nap 00:00:00
          
          const docs = snapshot.docs
            .map(doc => {
              const data = doc.data();
              const dateValue = data.date?.toDate ? data.date.toDate() : (data.date ? new Date(data.date) : null);
              return { 
                id: parseInt(doc.id, 10), 
                rawId: doc.id, 
                data: data,
                date: dateValue
              };
            })
            .filter(item => !Number.isNaN(item.id) && item.date) // Csak valid ID-vel √©s d√°tummal
            .filter(item => item.date >= now) // Csak mai vagy j√∂v≈ëbeli esem√©nyek
            .sort((a, b) => a.date - b.date); // D√°tum szerint n√∂vekv≈ë (legk√∂zelebbi el≈ësz√∂r)

          // Els≈ë 3 legk√∂zelebbi j√∂v≈ëbeli esem√©ny
          const orderedEvents = [
            docs[0] || null, // Legk√∂zelebbi ‚Üí Large card
            docs[1] || null, // K√∂vetkez≈ë ‚Üí Medium card
            docs[2] || null  // Harmadik ‚Üí Small card
          ];

          console.log('[Events] Snapshot received:', {
            totalDocs: snapshot.docs.length,
            ordered: orderedEvents.map(ev => ev ? { id: ev.id, rawId: ev.rawId, hasImage: !!extractImageUrl(ev.data) } : null)
          });

          const cardMap = [
            { selector: '.event-card--lg', includeText: true },
            { selector: '.event-card--md', includeText: true },
            { selector: '.event-card--sm', includeText: false }
          ];

          cardMap.forEach((cfg, index) => {
            const cardEl = document.querySelector(cfg.selector);
            if (!cardEl) return;
            applyEventToCard(cardEl, orderedEvents[index], cfg.includeText);
            
            // Force overlay width for large card to prevent dynamic override
            if (cardEl.classList.contains('event-card--lg')) {
              const overlay = cardEl.querySelector('.event-card-overlay--lg');
              if (overlay) {
                const cardWidth = cardEl.offsetWidth || cardEl.clientWidth;
                const maxOverlayWidth = Math.min(cardWidth * 0.5, 600);
                const minOverlayWidth = 280;
                const finalWidth = Math.max(minOverlayWidth, maxOverlayWidth);
                overlay.style.setProperty('width', `${finalWidth}px`, 'important');
                overlay.style.setProperty('max-width', `${finalWidth}px`, 'important');
                overlay.style.setProperty('min-width', `${minOverlayWidth}px`, 'important');
                overlay.style.setProperty('left', 'auto', 'important');
              }
            }
          });

          console.log('[Events] Cards updated from Firestore snapshot.');
        } catch (err) {
          console.error('‚ùå Error while processing events snapshot:', err);
        }
      }, (error) => {
        console.error('‚ùå Error listening to events:', error);
      });
    }

    function extractImageUrl(data) {
      if (!data || typeof data !== 'object') return '';

      const directCandidates = [
        data.image, data.imageUrl, data.imageURL, data.imageLarge, data.image_large,
        data.imageUrlLarge, data.imageURLLarge, data.coverImage, data.coverUrl,
        data.coverURL, data.bannerImage, data.heroImage, data.heroUrl, data.heroURL,
        data.thumbnail, data.thumbnailUrl, data.thumbnailURL
      ];

      for (const candidate of directCandidates) {
        if (typeof candidate === 'string' && candidate.trim()) return candidate.trim();
      }

      if (Array.isArray(data.images)) {
        const firstImg = data.images.find(item => typeof item === 'string' && item.trim());
        if (firstImg) return firstImg.trim();
      }

      if (data.images && typeof data.images === 'object') {
        const nested = Object.values(data.images).find(val => typeof val === 'string' && val.trim());
        if (nested) return nested.trim();
      }

      if (data.assets && typeof data.assets === 'object') {
        const assetCandidates = [data.assets.hero, data.assets.cover, data.assets.large, data.assets.main];
        for (const candidate of assetCandidates) {
          if (typeof candidate === 'string' && candidate.trim()) return candidate.trim();
        }
      }

      return '';
    }

    async function resolveImageUrl(raw, cardLabel) {
      if (!raw || typeof raw !== 'string') return '';
      const trimmed = raw.trim();
      if (!trimmed) return '';
      if (/^https?:\/\//i.test(trimmed)) return trimmed;

      if (!storage) {
        console.warn('[Events] Storage not available to resolve image path:', trimmed);
        return '';
      }

      try {
        const ref = storageRef(storage, trimmed);
        const downloadUrl = await getDownloadURL(ref);
        console.log('[Events] Resolved storage image for', cardLabel, '‚Üí', downloadUrl);
        return downloadUrl;
      } catch (err) {
        console.warn('[Events] Failed to resolve storage image path:', trimmed, err);
        return '';
      }
    }

    function applyEventToCard(cardEl, eventDoc, includeText) {
      const imgEl = cardEl.querySelector('.event-card-bg');
      const titleEl = includeText ? cardEl.querySelector('.event-card-title') : null;
      const descEl = includeText ? cardEl.querySelector('.event-card-desc') : null;
      const dateEl = includeText ? cardEl.querySelector('.event-card-date') : null;
      const overlayEl = cardEl.querySelector('.event-card-overlay--lg, .event-card-overlay--md');
      
      // Get or create link button container
      let linkBtnContainer = cardEl.querySelector('.event-card-link-btn-container');
      if (!linkBtnContainer) {
        linkBtnContainer = document.createElement('div');
        linkBtnContainer.className = 'event-card-link-btn-container';
        if (overlayEl) {
          overlayEl.appendChild(linkBtnContainer);
        } else {
          cardEl.appendChild(linkBtnContainer);
        }
      }

      const resetCard = () => {
        if (imgEl) {
          imgEl.src = 'assets/general/image_placeholder_blue.svg';
          imgEl.alt = 'K√©p hely≈ërz≈ë';
        }
        if (titleEl) titleEl.textContent = '';
        if (descEl) descEl.textContent = '';
        if (dateEl) dateEl.textContent = 'D√°tum √©s Hely';
        if (linkBtnContainer) {
          linkBtnContainer.innerHTML = '';
          linkBtnContainer.style.display = 'none';
        }
        cardEl.style.cursor = 'default';
        cardEl.onclick = null;
        delete cardEl.dataset.eventDate;
        delete cardEl.dataset.eventId;
      };

      if (!eventDoc) {
        resetCard();
            return;
          }

      const { id, rawId, data } = eventDoc;
      const title = (data.title || '').toString();
      const description = (data.description || data.desc || '').toString();
      const link = (data.link || '').toString().trim();
      const imageUrl = extractImageUrl(data);
      const dateValue = data.date?.toDate ? data.date.toDate() : data.date;
      const place = (data.place || '').toString().trim();
      
      // Validate link
      const isValidLink = link && (link.startsWith('http://') || link.startsWith('https://') || link.includes('.'));

      console.log('[Events] Applying card:', {
        card: cardEl.className,
        rawId,
        imageUrl,
        title,
        hasText: includeText
      });

      if (imgEl) {
        const requestToken = `${rawId || id}-${Date.now()}`;
        cardEl.dataset.imageRequestToken = requestToken;

        const applyResolvedImage = (resolvedUrl) => {
          if (cardEl.dataset.imageRequestToken !== requestToken) return;
          if (resolvedUrl) {
            imgEl.src = resolvedUrl;
            imgEl.alt = title ? `${title} ‚Äì esem√©ny k√©pe` : 'Esem√©ny k√©pe';
          } else {
            imgEl.src = 'assets/general/image_placeholder_blue.svg';
            imgEl.alt = 'K√©p hely≈ërz≈ë';
          }
        };

        if (imageUrl) {
          resolveImageUrl(imageUrl, cardEl.className).then(applyResolvedImage);
            } else {
          applyResolvedImage('');
        }
      }

      if (titleEl) {
        // Remove existing icon first
        const existingIcon = titleEl.querySelector('.event-card-link-icon');
        if (existingIcon) existingIcon.remove();
        
        // Set title text
        titleEl.textContent = title;
        
        // Add icon before title if link exists
        if (isValidLink) {
          const icon = document.createElement('img');
          icon.className = 'event-card-link-icon';
          icon.src = 'assets/general/utility/external_link.svg';
          icon.alt = '';
          titleEl.insertBefore(icon, titleEl.firstChild);
        }
        titleEl.style.maxWidth = '';
      }
      if (descEl) {
        descEl.textContent = description;
        descEl.style.maxWidth = '';
        
        // Limit√°ljuk 3 sorra, √©s az utols√≥ 3 karakter legyen ...
        setTimeout(() => {
          const lineHeight = parseFloat(getComputedStyle(descEl).lineHeight);
          const maxHeight = lineHeight * 3;
          
          if (descEl.scrollHeight > maxHeight) {
            let text = description;
            // Iterat√≠van r√∂vid√≠ts√ºk, am√≠g 3 sorba f√©r
            while (descEl.scrollHeight > maxHeight && text.length > 10) {
              text = text.substring(0, text.length - 4);
              descEl.textContent = text + '...';
            }
          }
        }, 100);
      }
      
      // Format and set date (with optional place)
      if (dateEl) {
        let dateText = '';
        
        // Format date if available
        if (dateValue) {
          const date = dateValue instanceof Date ? dateValue : new Date(dateValue);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          dateText = `${year}.${month}.${day}`;
        }
        
        // Add place if available
        if (dateText && place) {
          dateText += ` | ${place}`;
        } else if (place) {
          dateText = place;
        } else if (!dateText) {
          dateText = 'D√°tum √©s Hely';
        }
        
        dateEl.textContent = dateText;
      }

      // Handle link button
      if (isValidLink && linkBtnContainer) {
        linkBtnContainer.innerHTML = '';
        const linkBtn = document.createElement('button');
        linkBtn.className = 'event-card-link-btn';
        linkBtn.textContent = 'K√ºls≈ës Inform√°ci√≥k';
        linkBtn.onclick = (e) => {
          e.stopPropagation();
          let url = link;
          if (!/^https?:\/\//i.test(url)) {
            url = 'https://' + url;
          }
          window.open(url, '_blank');
        };
        linkBtnContainer.appendChild(linkBtn);
        linkBtnContainer.style.display = 'flex';
      } else if (linkBtnContainer) {
        linkBtnContainer.innerHTML = '';
        linkBtnContainer.style.display = 'none';
      }

      // Remove card-level click handler, button handles it
      cardEl.style.cursor = 'default';
      cardEl.onclick = null;

      if (dateValue) {
        const storedDate = dateValue instanceof Date ? dateValue.toISOString() : dateValue;
        cardEl.dataset.eventDate = storedDate;
            } else {
        delete cardEl.dataset.eventDate;
      }

      if (Number.isFinite(id)) {
        cardEl.dataset.eventId = id.toString();
      } else {
        delete cardEl.dataset.eventId;
      }
    }

    /* ---------------------- INIT ----------------------- */
    window.addEventListener("load", () => {
      console.log('Page loaded, initializing...');

      // DOM elemek ellen≈ërz√©se
      const newsRow = document.getElementById('newsRow');
      console.log('üîç DOM check:', {
        newsRow: !!newsRow,
        db: !!window.db
      });

      // Kis k√©sleltet√©s, hogy biztosan bet√∂lt≈ëdjenek a DOM elemek √©s Firebase
      setTimeout(() => {
        console.log('Starting delayed initialization...');
        
        // News bet√∂lt√©se
          loadNews();
        
        // Events bet√∂lt√©se
        loadEvents();
        
      }, 200);

        // Info banner persistence (hide on close, remember in localStorage)
        try {
          const INFO_BANNER_KEY = 'eu2k-hide-info-banner';
          const banner = document.querySelector('.info-banner');
          // Ensure default key exists and is 'false' (banner shown by default)
          try { if (localStorage.getItem(INFO_BANNER_KEY) === null) localStorage.setItem(INFO_BANNER_KEY, 'false'); } catch(_) {}

          // BEFORE anything else: if key is true, do not show banner at all
          try {
            if (localStorage.getItem(INFO_BANNER_KEY) === 'true' && banner) {
              banner.style.setProperty('display', 'none', 'important');
              // notify spacing logic
              try { window.dispatchEvent(new Event('eu2k-banner-visibility-changed')); } catch(_) {}
            }
          } catch(_) {}

          // Use capture on the whole document to guarantee we see the click
          document.addEventListener('click', (e) => {
            const target = e.target && e.target.closest ? e.target.closest('.info-banner .banner-btn') : null;
            if (!target) return;
            e.preventDefault();
            e.stopPropagation();
            const isPrimary = target.classList.contains('primary');
            const isSecondary = target.classList.contains('secondary');
            if (isPrimary) {
              try { localStorage.setItem(INFO_BANNER_KEY, 'true'); console.log('[InfoBanner] Close clicked ‚Üí stored flag'); } catch(err) { console.warn('[InfoBanner] LS write failed', err); }
              const b = document.querySelector('.info-banner');
              if (b) { b.style.setProperty('display','none','important'); console.log('[InfoBanner] Banner hidden via click'); }
              try { window.dispatchEvent(new Event('eu2k-banner-visibility-changed')); } catch(_) {}
              return false;
            }
            if (isSecondary) {
              try { console.log('[InfoBanner] Feedback clicked'); window.open('#feedback', '_blank'); } catch(err) { console.warn('[InfoBanner] Feedback open failed', err); }
              return false;
            }
          }, true);
        } catch (e) { /* no-op */ }
    });

    // Resize event m√°r nincs sz√ºks√©g, mert a k√°rty√°k fix m√©ret≈±ek
  </script>
</head>

<body>
  <!-- TODO(Figma): Replace the structure with exact assets from HomeScreen (Carousel canvas ‚Üí HomeScreen frame).
       Keep scripts untouched. Icons/images below are placeholders pointing to closest matches in /assets. -->

  <div class="app-bg">
    <!-- Sidebar / Navigation Rail (left) -->
    <aside class="sidebar" role="navigation" aria-label="F≈ë navig√°ci√≥">
      <div class="nav-frame">
        <div class="nav-shell">
          <nav class="nav-rail">

          <a class="rail-item nav-btn is-active" href="index.html" aria-current="page">
          <div class="rail-icon">
              <img src="assets/navbar/home.svg" alt="Otthon" />
          </div>
          <span class="rail-label" data-translate="navigation.home">Otthon</span>
        </a>

          <a class="rail-item nav-btn" href="qr-code.html">
          <div class="rail-icon">
              <img src="assets/navbar/qr_code.svg" alt="QR-K√≥d" />
          </div>
          <span class="rail-label" data-translate="navigation.qr" data-translate-fallback="QR-K√≥d">QR-K√≥d</span>
        </a>

          <a class="rail-item nav-btn" href="youhub.html">
          <div class="rail-icon">
              <img src="assets/navbar/youhub.svg" alt="YouHub" />
          </div>
          <span class="rail-label" data-translate="navigation.youhub">YouHub</span>
        </a>

          <!-- Class Hub (YouHub √©s Event Hub k√∂z√©) -->
          <!-- <a class="rail-item nav-btn" href="teachers/index.html">
            <div class="rail-icon">
              <img src="assets/navbar/class_hub.svg" alt="Class Hub" />
          </div>
            <span class="rail-label">Class Hub</span>
          </a> -->

          <!-- <a class="rail-item nav-btn" href="event_hub.html">
          <div class="rail-icon">
              <img src="assets/navbar/event_hub.svg" alt="Event Hub" />
          </div>
          <span class="rail-label" data-translate="navigation.event_hub">Event Hub</span>
          </a> -->

          <!-- Food Hub -->
          <!-- <a class="rail-item nav-btn" href="youhub.html#food-hub">
            <div class="rail-icon">
              <img src="assets/navbar/food_hub.svg" alt="Food Hub" />
            </div>
            <span class="rail-label">Food Hub</span>
          </a> -->

      </nav>
        </div>
      </div>
    </aside>

    <main class="main-area">
      <div class="main-scroll-area">
          <!-- Header -->
          <header class="header">
            <div class="header-content">
            <div class="welcome-container">
                <img src="assets/home/welcome_hand_icon.svg" class="welcome-icon" alt="Welcome">
                <span class="welcome-text" data-translate="pages.index.welcome" data-translate-fallback="√údv√∂z√∂llek a Hub-ban!">√údv√∂z√∂llek a Hub-ban!</span>
            </div>
              <div class="header-icon-container">
                <div class="header-icon-gradient">
                  <div class="header-icon-wrapper" id="headerSettingsWrapper">
                    <a href="/settings" class="header-icon-btn" id="headerSettingsBtn">
                      <img src="assets/general/settings.svg" alt="Settings">
                    </a>
                  </div>
                  <div class="header-icon-wrapper" id="headerAccountWrapper" style="display: none;">
                    <a href="system/account.html" class="header-icon-btn" id="headerAccountBtn">
                      <img src="assets/general/account.svg" alt="Account">
              </a>
            </div>
                  <button class="header-login-btn" id="headerLoginBtn" data-translate="pages.general.login" style="display: none;">
                    Bejelentkez√©s
                  </button>
            </div>
                </div>
                    </div>
            <!-- Notification / Info Banner -->
            <section class="info-banner" aria-label="Inform√°ci√≥">
              <!-- TODO(Figma): Replace icon if specified in banner design -->
              <div class="info-banner-icon-container">
                <img class="info-banner-icon" src="assets/general/banners/info.svg" alt="Info" />
                    </div>
              <div class="banner-content">
                <div class="banner-texts">
                  <span class="info-banner-title">Ez az √∫j diz√°jn.</span>
                  <span class="info-banner-desc">Rem√©lj√ºk neked is tetszik az Eur√≥pa Diz√°jn Rendszer. Ha b√°rmi k√©ts√©ged van, jelezz vissza, ak√°r innen is.</span>
                  </div>
                <div class="banner-actions-wrapper">
                  <div class="banner-actions">
                    <button class="banner-btn secondary" type="button">Visszajelz√©s</button>
                    <button class="banner-btn primary" type="button">Bez√°r√°s</button>
                  </div>
                </div>
              </div>
            </section>
          </header>

        <div class="main-content">
          <!-- Event Container: 3 cards (60% / 30% / 10%) with 32px gaps -->
          <section class="events-container" aria-label="Esem√©nyek">
            <div class="event-card event-card--lg">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="K√©p hely≈ërz≈ë" />
              <div class="event-card-overlay event-card-overlay--lg">
                <div class="event-card-title">Title</div>
                <div class="event-card-desc">Body</div>
                <div class="event-card-date">D√°tum √©s Hely</div>
                  </div>
                </div>

            <div class="event-card event-card--md">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="K√©p hely≈ërz≈ë" />
              <div class="event-card-overlay event-card-overlay--md">
                <div class="event-card-title">Title</div>
                <div class="event-card-desc">Body</div>
                <div class="event-card-date">D√°tum √©s Hely</div>
                  </div>
                </div>

            <div class="event-card event-card--sm">
              <img class="event-card-bg" src="assets/general/image_placeholder_blue.svg" alt="K√©p hely≈ërz≈ë" />
                </div>
          </section>

          <!-- News Section -->
          <section class="news-section">
            <!-- News Row Container -->
            <div id="newsRow">
              <!-- News cards will be dynamically generated here -->
            </div>
          </section>

          <script type="module">
            import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

            function lsLoggedInFallback() {
              try { return localStorage.getItem('eu2k-auth-logged-in') === 'true'; } catch { return false; }
            }

            function updateHeaderIcons(loggedIn) {
              const settingsWrapper = document.getElementById('headerSettingsWrapper');
              const accountWrapper = document.getElementById('headerAccountWrapper');
              const loginBtn = document.getElementById('headerLoginBtn');
              const gradientContainer = document.querySelector('.header-icon-gradient');
              if (!settingsWrapper || !accountWrapper || !loginBtn || !gradientContainer) return;

              if (loggedIn) {
                settingsWrapper.style.display = 'flex';
                accountWrapper.style.display = 'flex';
                loginBtn.style.display = 'none';
                gradientContainer.classList.remove('has-login'); // Csak z√∂ld, nincs gradient
              } else {
                settingsWrapper.style.display = 'flex';
                accountWrapper.style.display = 'none';
                loginBtn.style.display = 'flex';
                gradientContainer.classList.add('has-login'); // Van gradient, mert van k√©k gomb
              }
            }

            try {
              const auth = getAuth();
              onAuthStateChanged(auth, (user) => {
                updateHeaderIcons(!!user);
              });
            } catch (e) {
              // Last resort: localStorage fallback
              updateHeaderIcons(lsLoggedInFallback());
              // Keep in sync with localStorage changes
              window.addEventListener('storage', () => updateHeaderIcons(lsLoggedInFallback()));
              setInterval(() => updateHeaderIcons(lsLoggedInFallback()), 1000);
            }

            // Bejelentkez√©s gomb kattint√°s
            const loginBtnEl = document.getElementById('headerLoginBtn');
            if (loginBtnEl) {
              loginBtnEl.addEventListener('click', function() {
                window.location.href = 'onboarding.html';
              });
            }
          </script>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
          <!-- Left Column -->
          <div class="footer-left">
            <!-- Logo and participated section -->
            <div class="footer-logo-container">
              <img src="assets/general/footer/eu2k_hub.png" alt="EU2K Hub">
              <span class="footer-participated-text">R√©szt vett m√©g:</span>
              <div class="footer-participated-logos">
                <img src="assets/general/footer/eu2k.png" alt="EU2K">
                <img src="assets/general/footer/eu2k_devs.png" alt="EU2K Devs">
                <img src="assets/general/footer/eu2k_dok.png" alt="EU2K Dok">
                <img src="assets/general/footer/eu2k_ujsag.png" alt="EU2K √öjs√°g">
              </div>
            </div>

            <!-- Copyright -->
            <div class="footer-copyright">
              ¬© 2025 EU2K Devs √©s Eur√≥pa 2000 Gimn√°zium. All Rights Reserved.
            </div>

            <!-- Social icons -->
            <div class="footer-social">
              <img src="assets/general/footer/eu2k_ujsag.svg" alt="EU2K √öjs√°g" onclick="window.open('https://sites.google.com/view/eu2k-ujsag', '_blank')">
              <img src="assets/general/footer/x.svg" alt="X (Twitter)" onclick="window.open('https://x.com/eu2kdevs', '_blank')">
              <img src="assets/general/footer/instagram.svg" alt="Instagram" onclick="window.open('https://instagram.com/eu2k.devs', '_blank')">
              <img src="assets/general/footer/yt.svg" alt="YouTube" onclick="window.open('https://youtube.com/@eu2kdevs', '_blank')">
            </div>
          </div>

          <!-- Right Column -->
          <div class="footer-right">
            <!-- Jogi Nyilatkozatok -->
            <div class="footer-section-first">
              <div class="footer-section-title">Jogi Nyilatkozatok</div>
              <div class="footer-section-items">
                <a href="/privacy-policy" class="footer-item">Adatv√©delmi&nbsp;T√°j√©koztat√≥</a>
                <a href="/terms-of-service" class="footer-item">Haszn√°lati&nbsp;Felt√©telek</a>
                <div class="footer-item">El≈ëzetes-szoftver<br>haszn√°lati&nbsp;t√°j√©koztat√≥ja</div>
              </div>
            </div>

            <!-- Hubs -->
            <div class="footer-section">
              <div class="footer-section-title">Hubs</div>
              <div class="footer-section-items">
                <div class="footer-item">YouHub</div>
                <div class="footer-item">Class&nbsp;Hub</div>
                <div class="footer-item">Food&nbsp;Hub</div>
                <div class="footer-item">Event&nbsp;Hub</div>
                <div class="footer-item">Fitness&nbsp;Hub<span class="beta-badge">BETA</span></div>
              </div>
            </div>

          </div>
        </footer>
      </div>
    </main>
  </div>

  
  <!-- <script>
    // Check if user has accepted terms of service and redirect to appropriate onboarding
    // COMMENTED OUT: Redirect to onboarding disabled
    /*
    document.addEventListener('DOMContentLoaded', () => {
      // FIRST: Check if user is already logged in and has completed onboarding
      const isLoggedIn = localStorage.getItem('eu2k-auth-logged-in') === 'true';
      const onboardingCompleted = localStorage.getItem('onboardingCompleted') === 'true';
      const termsAccepted = localStorage.getItem('termsAccepted') === 'true';
      
      console.log('üîç Index.html redirect check:', {
        isLoggedIn,
        onboardingCompleted,
        termsAccepted
      });
      
      // If user is logged in and onboarding is completed, stay on index.html
      if (isLoggedIn && onboardingCompleted && termsAccepted) {
        console.log('‚úÖ User is fully set up, staying on index.html');
        // Mark as visited to prevent welcome screen redirect
        if (window.welcomeScreenManager) {
          window.welcomeScreenManager.markAsVisited();
        }
        return;
      }
      
      // Only redirect to onboarding if terms are not accepted
      if (termsAccepted !== 'true') {
        console.log('üìã Terms not accepted, redirecting to onboarding...');
        
        const userType = localStorage.getItem('eu2k-user-type');
        
        if (isLoggedIn && userType) {
          // Redirect to appropriate onboarding based on user type
          switch (userType) {
            case 'student':
              window.location.href = 'welcome/onboarding_student.html#student-profile';
              break;
            case 'parent':
              window.location.href = 'welcome/onboarding_parent.html#parent-profile';
              break;
            case 'teacher':
              window.location.href = 'welcome/onboarding_teacher.html#teacher-profile';
              break;
            default:
              // Default to student onboarding if user type is unknown
              window.location.href = 'welcome/onboarding_student.html';
          }
        } else {
          // Not logged in, redirect to default student onboarding
          window.location.href = 'welcome/onboarding_student.html';
        }
      }
    });
    */
  </script>
  <script type="module">
    import { getAuth, signInWithPopup, OAuthProvider } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const auth = getAuth();

    // Glob√°lis Microsoft bejelentkez√©s f√ºggv√©ny
    window.startMicrosoftSignIn = async () => {
      console.log('üîê Microsoft bejelentkez√©s ind√≠t√°sa...');
      try {
        const provider = new OAuthProvider('microsoft.com');
        try { provider.setCustomParameters?.({ prompt: 'select_account' }); } catch {}

        const result = await signInWithPopup(auth, provider);
        const user = result?.user;
        console.log('‚úÖ Microsoft bejelentkez√©s sikeres:', user);

        localStorage.setItem('eu2k-auth-logged-in', 'true');

        const termsAccepted = localStorage.getItem('termsAccepted') === 'true';
        const userType = localStorage.getItem('eu2k-user-type') || 'student';
        if (!termsAccepted) {
          switch (userType) {
            case 'student':
              window.location.href = 'welcome/onboarding_student.html#student-profile';
              return;
            case 'parent':
              window.location.href = 'welcome/onboarding_parent.html#parent-profile';
              return;
            case 'teacher':
              window.location.href = 'welcome/onboarding_teacher.html#teacher-profile';
              return;
            default:
              window.location.href = 'welcome/onboarding_student.html';
              return;
          }
        }

        window.location.href = 'index.html';
      } catch (error) {
        console.error('‚ùå Microsoft bejelentkez√©s hiba:', error);
        const msg = (error && (error.message || error.code)) || 'Ismeretlen hiba';
        alert('Microsoft bejelentkez√©s nem √©rhet≈ë el: ' + msg);
      }
    };

    window.isMicrosoftSignInAvailable = () => {
      try {
        return typeof window.startMicrosoftSignIn === 'function';
      } catch {
        return false;
      }
    };
  </script> -->
  <script src="assets/js/footer.js"></script>
  <script src="assets/js/consent-banner.js"></script>
</body>

</html>