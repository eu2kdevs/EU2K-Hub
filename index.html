<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="√údv√∂z√∂llek az EU2K Hub-ban! Fedezd fel a leg√∫jabb esem√©nyeket, h√≠reket √©s tanul√°si lehet≈ës√©geket egy helyen.">
  <title data-translate="pages.index.title" data-translate-fallback="EU2K Hub">EU2K Hub</title>
  <link rel="stylesheet" href="home.css">
  <link rel="icon" href="/EU2K-Hub/favicon.ico">
  <script>
    (function(){
      if (!document.getElementById('eu2k-page-overlay')) {
        var o = document.createElement('div');
        o.id = 'eu2k-page-overlay';
        o.style.cssText = 'position:fixed;inset:0;z-index:9999;background:#0B0F0B;border-radius:32px;opacity:1;transition:opacity 300ms ease-in-out;';
        var inner = document.createElement('div');
        inner.style.cssText = 'position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#0B0F0B;border-radius:32px;';
        var m = document.createElement('div');
        m.id = 'eu2k-overlay-mount';
        m.style.cssText = 'position:relative;width:100%;height:100%';
        inner.appendChild(m);
        o.appendChild(inner);
        document.documentElement.appendChild(o);
      }
    })();
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

    body,
    * {
      font-family: "Roboto", sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      font-variation-settings: "wdth" 100;
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #newsRow {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #newsRow::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Scrollbar elrejt√©se a news carousel-ben */
    #event-frame {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* Internet Explorer 10+ */
    }

    #event-frame::-webkit-scrollbar {
      display: none;
      /* WebKit */
    }

    /* Ensure events don't slide under header */
    .events-section { margin-top: 8px; }

    /* Horizontal news carousel behavior */
    .news-carousel { overflow: visible; }
    #newsRow {
      display: flex;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
      gap: 12px;
    }

    /* Footer links spacing */
    .footer-center { display: flex; gap: 8px; align-items: center; justify-content: center; }
  </style>
  <script src="/EU2K-Hub/assets/js/page-overlay-loader.js"></script>
  <script src="/EU2K-Hub/assets/js/permissions.js"></script>
  <script data-src="/EU2K-Hub/assets/js/translations.js"></script>
  <!-- <script data-src="/EU2K-Hub/assets/js/welcome-screen.js"></script>
  <script data-src="/EU2K-Hub/assets/js/auth-state.js"></script> -->
  <script data-src="/EU2K-Hub/assets/js/test_firebase.js" type="module"></script>
  <script data-src="/EU2K-Hub/assets/js/firebase-performance.js" type="module"></script>
  <script data-src="/EU2K-Hub/assets/js/first-input-delay.js"></script>
  <script data-src="/EU2K-Hub/assets/js/new-things-popup.js"></script>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "s6n7qpfkv4");
  </script>
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import 'https://unpkg.com/@material/web@2.0.0/all.js';
    import { styles as typescaleStyles } from 'https://unpkg.com/@material/web@2.0.0/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore, collection, onSnapshot, query, orderBy, limit, startAfter, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const functions = getFunctions(app, 'europe-west1');

    // Make db and functions globally available
    window.db = db;
    window.functions = functions;
    window.createHttpsCallable = (name) => httpsCallable(functions, name);

    // Import Firestore debug module
    import('./assets/js/firestore-debug.js').catch(err => {
      console.warn('Firestore debug module not loaded:', err);
    });

    // Import Firebase test module
    import('./assets/js/test_firebase.js').catch(err => {
      console.warn('Firebase test module not loaded:', err);
    });

    /* ---------------------- NEWS ----------------------- */
    let lastVisible = null;
    let loadingNews = false;
    const pageSize = 14; // Friss√≠tve 14 k√°rty√°ra

    // Fallback news data
    function loadFallbackNews() {
      console.log('üì∞ Loading fallback news data...');
      const fallbackNews = [
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        },
        {
          title: "Valami baj van.",
          desc: "Nemsok√°ra kijav√≠tjuk.",
          image: "/EU2K-Hub/assets/placeholder_img.svg",
          link: "#"
        }
      ];

      const cards = document.querySelectorAll("#newsRow .news-card");

      fallbackNews.slice(0, cards.length).forEach((newsItem, index) => {
        const card = cards[index];

        // k√©p
        const rect = card.querySelector(".red-rect");
        if (rect) {
          rect.style.backgroundImage = `url(${newsItem.image})`;
          rect.style.backgroundSize = "cover";
          rect.style.backgroundPosition = "center";
          rect.style.backgroundColor = "var(--red)";
        }

        // c√≠m
        const titleSpan = card.querySelector(".news-label > span:first-child");
        if (titleSpan) {
          let title = newsItem.title;
          if (title.length > 30) title = title.substring(0, 30) + "...";
          titleSpan.textContent = title;
        }

        // le√≠r√°s
        const descSpan = card.querySelector(".news-label > span.desc");
        if (descSpan) {
          let desc = newsItem.desc;
          if (desc.length > 60) desc = desc.substring(0, 60) + "...";
          descSpan.textContent = desc;
        }

        // kattinthat√≥s√°g
        card.style.cursor = (newsItem.link !== "#") ? "pointer" : "default";
        card.onclick = null; // Clear previous onclick
        if (newsItem.link !== "#") {
          card.onclick = () => {
            let url = newsItem.link.trim();
            if (!url.startsWith("http://") && !url.startsWith("https://")) url = "https://" + url;
            window.open(url, "_blank");
          };
        }
      });

      console.log('‚úÖ Fallback news loaded successfully');
    }

    // Load h√≠rek
    async function loadNews() {
      console.log('üîÑ Loading news...');
      try {
        const hirekRef = collection(db, "homePageData", "news", "hirek");
        console.log('üîó Trying to connect to collection: homePageData/news/hirek');

        // Lek√©rj√ºk az √∂sszes dokumentumot
        const snapshot = await getDocs(hirekRef);
        console.log('üì∞ News snapshot:', snapshot.docs.length, 'documents found');

        // Debug: log all document IDs and their order
        snapshot.docs.forEach((doc, index) => {
          console.log(`üìÑ Document ${index}: ID=${doc.id}, data:`, doc.data());
        });

        if (snapshot.docs.length === 0) {
          console.warn('‚ö†Ô∏è No news documents found in Firebase collection');
          // Use fallback data
          loadFallbackNews();
          return;
        }

        // Rendezz√ºk a dokumentumokat ID szerint cs√∂kken≈ë sorrendben (legnagyobb sz√°m el√∂l)
        const sortedDocs = snapshot.docs.sort((a, b) => {
          const idA = parseInt(a.id) || 0;
          const idB = parseInt(b.id) || 0;
          return idB - idA; // Cs√∂kken≈ë sorrend
        });

        console.log('üì∞ Sorted news by ID (desc):', sortedDocs.map(doc => doc.id));

        const cards = document.querySelectorAll("#newsRow .news-card");
        console.log('üéØ Found', cards.length, 'news cards in DOM');

        if (cards.length === 0) {
          console.error('‚ùå No news cards found! Check if #newsRow exists and contains .news-card elements');
          return;
        }

        // Az √∂sszes el√©rhet≈ë dokumentumot feldolgozzuk, de maximum annyi k√°rty√°t t√∂lt√ºnk fel, amennyi van
        const docsToProcess = sortedDocs.slice(0, Math.min(sortedDocs.length, cards.length));
        console.log(`üì∞ Processing ${docsToProcess.length} news items for ${cards.length} cards`);

        docsToProcess.forEach((doc, index) => {
          const data = doc.data();
          const card = cards[index];
          console.log(`üìÑ Processing news ${index + 1}: ID=${doc.id}, Title="${data.title || 'No title'}"`);

          // k√©p
          const rect = card.querySelector(".red-rect");
          if (rect) {
            if (data.image && data.image.trim() !== '') {
              rect.style.backgroundImage = `url(${data.image})`;
              rect.style.backgroundSize = "cover";
              rect.style.backgroundPosition = "center";
              rect.style.backgroundColor = "transparent";
            } else {
              rect.style.backgroundImage = '';
              rect.style.backgroundColor = "var(--red)";
            }
          }

          // c√≠m
          const titleSpan = card.querySelector(".news-label > span:first-child");
          if (titleSpan) {
            let title = data.title || "Nincs c√≠m";
            if (title.length > 30) title = title.substring(0, 30) + "...";
            titleSpan.textContent = title;
          }

          // le√≠r√°s - a description mez≈ë haszn√°lata
          const descSpan = card.querySelector(".news-label > span.desc");
          if (descSpan) {
            let desc = data.description || data.desc || "";
            if (desc.length > 60) desc = desc.substring(0, 60) + "...";
            descSpan.textContent = desc;
          }

          // kattinthat√≥s√°g
          card.style.cursor = (data.link && data.link.trim() !== '') ? "pointer" : "default";
          card.onclick = null; // Clear previous onclick
          if (data.link && data.link.trim() !== '') {
            card.onclick = () => {
              let url = data.link.trim();
              if (!url.startsWith("http://") && !url.startsWith("https://")) url = "https://" + url;
              window.open(url, "_blank");
            };
          }
        });

        console.log('‚úÖ News loading completed successfully');
      } catch (error) {
        console.error('‚ùå Error loading news:', error);
        console.log('üîÑ Falling back to placeholder content...');

        // Fallback: Load fallback news instead of just placeholders
        loadFallbackNews();
      }
    }

    // Dinamikus m√©retez√©s a h√≠rk√°rty√°khoz ‚Äì minden k√°rtya megmarad, a marad√©k scrollozhat√≥
    function handleNewsCardResize() {
      const newsRow = document.getElementById("newsRow");
      const cards = Array.from(document.querySelectorAll("#newsRow .news-card"));

      if (!newsRow || cards.length === 0) return;

      const containerWidth = newsRow.clientWidth;
      const defaultCardWidth = 272; // Alap√©rtelmezett k√°rtya sz√©less√©g
      const cardGap = 12;            // K√°rty√°k k√∂z√∂tti t√°vols√°g
      const minCards = 2;            // Minimum l√°that√≥ k√°rtya

      // Sz√°moljuk ki, h√°ny k√°rtya f√©r el teljesen a l√°that√≥ r√©szben
      let maxVisibleCards = Math.min(cards.length, 7);
      for (let cardCount = maxVisibleCards; cardCount >= minCards; cardCount--) {
        const totalWidth = (defaultCardWidth * cardCount) + (cardGap * (cardCount - 1));
        if (totalWidth <= containerWidth) {
          maxVisibleCards = cardCount;
          break;
        }
      }

      console.log(`üìè Container width: ${containerWidth}px, showing ${maxVisibleCards} cards`);

      // Sz√°moljuk ki az extra helyet a l√°that√≥ k√°rty√°k k√∂z√∂tt
      const totalUsedWidth = (defaultCardWidth * maxVisibleCards) + (cardGap * (maxVisibleCards - 1));
      let newCardWidth = defaultCardWidth;
      if (containerWidth > totalUsedWidth && maxVisibleCards > 0) {
        const extraSpace = containerWidth - totalUsedWidth;
        newCardWidth = defaultCardWidth + extraSpace / maxVisibleCards;
      }

      // √Åll√≠tsuk be az √∂sszes k√°rty√°t
      cards.forEach((card, index) => {
        card.style.display = 'flex';              // Mindig l√°that√≥ a DOM-ban
        card.style.minWidth = `${newCardWidth}px`;
        card.style.maxWidth = `${newCardWidth}px`;
        card.style.width = `${newCardWidth}px`;
        card.style.marginRight = `${cardGap}px`;  // T√°vols√°g a k√∂vetkez≈ë k√°rty√°hoz
      });

      console.log(`üìè Cards resized to: ${newCardWidth.toFixed(1)}px each`);
    }

    // Carousel gombok
    function initNewsCarousel() {
      const row = document.getElementById("newsRow");
      const leftBtn = document.querySelector(".carousel-btn.left");
      const rightBtn = document.querySelector(".carousel-btn.right");

      const lb = document.getElementById('newsLeftBtn') || leftBtn;
      const rb = document.getElementById('newsRightBtn') || rightBtn;

      lb.addEventListener("click", () => {
        const row = document.getElementById("newsRow");
        const card = row.querySelector(".news-card"); // mindig a l√°that√≥ k√°rtya
        if (!card) return;
        const cardWidth = card.offsetWidth + 12; // k√°rtya + gap
        row.scrollBy({ left: -cardWidth, behavior: "smooth" });
      });

      rb.addEventListener("click", () => {
        const row = document.getElementById("newsRow");
        const card = row.querySelector(".news-card"); // mindig a l√°that√≥ k√°rtya
        if (!card) return;
        const cardWidth = card.offsetWidth + 12; // k√°rtya + gap
        row.scrollBy({ left: cardWidth, behavior: "smooth" });
      });

      // Wheel: shift vertical wheel to horizontal scroll
      row.addEventListener('wheel', (e) => {
        if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
          e.preventDefault();
          row.scrollLeft += e.deltaY;
        }
      }, { passive: false });

      // infinite scroll trigger
      row.addEventListener("scroll", () => {
        if (row.scrollLeft + row.clientWidth >= row.scrollWidth - 50) {
          loadNews(false);
        }
      });

      // M√©retez√©s inicializ√°l√°sa
      handleNewsCardResize();
    }

    /* ---------------------- EVENTS ----------------------- */
    function handleDynamicLayout() {
      const mainContent = document.querySelector('.main-content');
      const containers = Array.from(document.querySelectorAll('.event-container'));
      if (!mainContent || containers.length === 0) return;

      const mainContentWidth = mainContent.clientWidth;
      const availableWidth = mainContentWidth - 64;

      const defaultWidths = [120, 400, 400, 400, 120, 120, 56];
      const defaultHeights = [205, 205, 205, 205, 205, 205, 205];
      const hideOrder = [4, 3, 2, 0, 5];

      containers.forEach(c => c.classList.remove("hidden"));

      let totalWidth = defaultWidths.reduce((a, b) => a + b, 0) + (defaultWidths.length - 1) * 8;

      for (let i = 0; i < hideOrder.length; i++) {
        if (totalWidth <= availableWidth) break;
        const idx = hideOrder[i];
        containers[idx].classList.add("hidden");
        totalWidth -= defaultWidths[idx] + 8;
      }

      const visibleContainers = containers.filter(c => !c.classList.contains('hidden'));
      if (visibleContainers.length > 0) {
        const visibleWidths = visibleContainers.map(c => defaultWidths[containers.indexOf(c)]);
        const visibleTotalWidth = visibleWidths.reduce((a, b) => a + b, 0) + (visibleContainers.length - 1) * 8;
        const scaleRatio = Math.min(1 + (availableWidth - visibleTotalWidth) / visibleTotalWidth, 1.5);

        visibleContainers.forEach(c => {
          const idx = containers.indexOf(c);
          const card = c.querySelector('.red-card');
          if (card) {
            card.style.width = `${defaultWidths[idx] * scaleRatio}px`;
            card.style.height = `${defaultHeights[idx] * scaleRatio}px`;
          }
        });
      }

      loadEvents();
    }

    async function loadEvents() {
      console.log('Loading events...');
      try {
        const eventsRef = collection(db, 'homePageData', 'events', 'esemenyek');
        console.log('Trying to connect to database...');

        const snapshot = await getDocs(eventsRef);
        console.log('Events snapshot:', snapshot.docs.length, 'documents found');

        // Debug: log all document IDs
        snapshot.docs.forEach((doc, index) => {
          console.log(`Event Document ${index}: ID=${doc.id}, data:`, doc.data());
        });

        if (snapshot.docs.length === 0) {
          console.warn('No event documents found in Firebase collection');
          return;
        }

        let events = [];
        const now = new Date();
        // Minden esem√©nyt figyelembe vesz√ºnk, nem csak a k√∂vetkez≈ë 1 h√≥napot,
        // √≠gy a k√∂zeli m√∫lt esem√©nyei is beker√ºlnek, √©s a legk√∂zelebbi esem√©ny
        // val√≥ban k√∂z√©pre ker√ºlhet

        snapshot.forEach(doc => {
          const data = doc.data();
          const eventDate = data.date?.toDate ? data.date.toDate() : null;
          if (!eventDate) return;
          events.push({ id: parseInt(doc.id), data, date: eventDate });
        });

        console.log('Collected events (all with valid date):', events.length);
        events.sort((a, b) => a.id - b.id);

        let closestEventIndex = -1;
        let minDateDiff = Infinity;

        events.forEach((event, index) => {
          const diff = Math.abs(event.date - now);
          if (diff < minDateDiff) {
            minDateDiff = diff;
            closestEventIndex = index;
          }
        });

        if (closestEventIndex === -1 && events.length > 0) {
          closestEventIndex = events.length - 1; // Leg√∫jabb (legnagyobb ID)
        }

        // Lok√°lis kont√©nerek √©s l√°that√≥ kont√©nerek meghat√°roz√°sa az aktu√°lis layout alapj√°n
        const containers = Array.from(document.querySelectorAll('.event-container'));
        const visibleContainers = containers.filter(c => !c.classList.contains('hidden'));
        if (visibleContainers.length === 0) {
          console.warn('No visible event containers found after layout calculation');
          return;
        }
        // Prefer√°lt k√∂z√©p: a 3 nagy k√°rtya k√∂z√ºl a 2. (containers[2]) ha l√°that√≥,
        // ha nem, pr√≥b√°ljuk a containers[1]-et, majd containers[3]-at, v√©g√ºl fallback k√∂z√©pre
        const preferOrder = [2, 1, 3];
        let centerContainerIndex = Math.floor(visibleContainers.length / 2);
        for (const idx of preferOrder) {
          const el = containers[idx];
          const visibleIdx = el ? visibleContainers.indexOf(el) : -1;
          if (visibleIdx !== -1) {
            centerContainerIndex = visibleIdx;
            break;
          }
        }
        const arrangedIndices = new Array(visibleContainers.length).fill(null);

        if (closestEventIndex !== -1) {
          arrangedIndices[centerContainerIndex] = closestEventIndex;

          // R√©gebbi esem√©nyek (kisebb ID) elhelyez√©se balra
          let leftIndex = centerContainerIndex - 1;
          for (let i = closestEventIndex - 1; i >= 0 && leftIndex >= 0; i--) {
            arrangedIndices[leftIndex--] = i;
          }

          // √öjabb esem√©nyek (nagyobb ID) elhelyez√©se jobbra
          let rightIndex = centerContainerIndex + 1;
          for (let i = closestEventIndex + 1; i < events.length && rightIndex < visibleContainers.length; i++) {
            arrangedIndices[rightIndex++] = i;
          }
        }

        visibleContainers.forEach((container, i) => {
          const itemIndex = arrangedIndices[i];
          const item = itemIndex != null ? events[itemIndex] : null;

          const card = container.querySelector('.red-card');
          const titleSpan = container.querySelector('.event-label-text > span:first-child');
          const descSpan = container.querySelector('.event-label-text > span.desc');
          const placeSpan = container.querySelector('.event-label-text > span.place');
          const arrowContainer = container.querySelector('.arrow-container');

          if (!item) {
            if (card) {
              card.style.backgroundImage = '';
              card.style.backgroundColor = '';
            }
            if (titleSpan) titleSpan.textContent = '';
            if (descSpan) descSpan.textContent = '';
            if (placeSpan) placeSpan.textContent = '';
            if (arrowContainer) {
              arrowContainer.style.opacity = '0';
              arrowContainer.style.cursor = 'default';
              arrowContainer.onclick = (e) => e.stopPropagation();
            }
            return;
          }

          console.log(`Processing event ${i + 1}: ID=${item.id}, Title="${item.data.title || 'No title'}"`);

          if (card) {
            if (item.data.image && item.data.image.trim() !== '') {
              card.style.backgroundImage = `url(${item.data.image})`;
              card.style.backgroundSize = 'cover';
              card.style.backgroundPosition = 'center';
              card.style.backgroundColor = 'transparent';
            } else {
              card.style.backgroundImage = '';
              card.style.backgroundColor = 'var(--red)';
            }
          }

          if (titleSpan) {
            let title = item.data.title || "Nincs c√≠m";
            if (title.length > 30) title = title.substring(0, 30) + '...';
            titleSpan.textContent = title;
          }

          if (descSpan) {
            let desc = item.data.description || "";
            if (desc.length > 50) desc = desc.substring(0, 50) + '...';
            descSpan.textContent = desc;
          }

          if (placeSpan) {
            const placeText = (item.data.place || '').toString().trim();
            if (placeText) {
              placeSpan.textContent = "Helysz√≠n: " + placeText;
              placeSpan.style.display = '';
            } else {
              placeSpan.textContent = '';
              placeSpan.style.display = 'none';
            }
          }

          if (arrowContainer) {
            if (item.data.link && item.data.link.trim() !== '') {
              arrowContainer.style.opacity = '1';
              arrowContainer.style.cursor = 'pointer';
              arrowContainer.style.filter = 'none';
              arrowContainer.onclick = (e) => {
                e.stopPropagation();
                let url = item.data.link.trim();
                if (!url.startsWith('http://') && !url.startsWith('https://')) url = 'https://' + url;
                window.open(url, '_blank');
              };
            } else {
              arrowContainer.style.opacity = '0.3';
              arrowContainer.style.cursor = 'not-allowed';
              arrowContainer.style.filter = 'grayscale(100%)';
              arrowContainer.onclick = (e) => e.stopPropagation();
            }
          }
        });

        console.log('Events loading completed successfully');
      } catch (error) {
        console.error('‚ùå Error loading events:', error);
      }
    }

    /* ---------------------- INIT ----------------------- */
    window.addEventListener("load", () => {
      console.log('Page loaded, initializing...');

      // DOM elemek ellen≈ërz√©se
      const newsRow = document.getElementById('newsRow');
      const newsCards = document.querySelectorAll('#newsRow .news-card');
      console.log('üîç DOM check:', {
        newsRow: !!newsRow,
        newsCardsCount: newsCards.length,
        db: !!window.db
      });

      if (!newsRow) {
        console.error('‚ùå newsRow element not found!');
        return;
      }

      if (newsCards.length === 0) {
        console.error('‚ùå No news cards found!');
        return;
      }

      // Kis k√©sleltet√©s, hogy biztosan bet√∂lt≈ëdjenek a DOM elemek √©s Firebase
      setTimeout(() => {
        console.log('Starting delayed initialization...');
        loadNews();
        handleDynamicLayout();
        initNewsCarousel();
        // Kis k√©sleltet√©s a h√≠rek bet√∂lt√©se ut√°n a m√©retez√©shez
        setTimeout(handleNewsCardResize, 100);
      }, 200);
    });

    window.addEventListener("resize", () => {
      handleDynamicLayout();
      handleNewsCardResize();
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const mainContent = document.querySelector('.main-content');
      const header = document.querySelector('.header');

      let lastScrollTop = 0;
      let ticking = false;

      mainContent.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            const scrollTop = mainContent.scrollTop;

            if (scrollTop > lastScrollTop + 5) {
              header.classList.add('hide');
            } else if (scrollTop < lastScrollTop - 5) {
              header.classList.remove('hide');
            }

            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            ticking = false;
          });
          ticking = true;
        }
      });
    });
  </script>
</head>

<body>
  <div class="app-bg">
    <aside class="sidebar">
      <nav class="nav-menu">
        <button class="nav-item-list" type="button" aria-label="Men√º">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/navbar/menu.svg" class="nav-icon" alt="Men√º">
          </div>
          <span data-translate="navigation.menu">Men√º</span>
        </button>
        <a class="nav-item active" href="index.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/navbar/home.svg" class="nav-icon" alt="Otthon">
          </div>
          <span data-translate="navigation.home">Otthon</span>
        </a>
        <a class="nav-item" href="qr-code.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/navbar/qr_code.svg" class="nav-icon" alt="QR-K√≥d">
          </div>
          <span data-translate="navigation.qr" data-translate-fallback="QR-K√≥d">QR-K√≥d</span>
        </a>
        <a class="nav-item" href="youhub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/navbar/youhub.svg" class="nav-icon" alt="YouHub">
          </div>
          <span data-translate="navigation.youhub">YouHub</span>
        </a>
        <a class="nav-item" href="event_hub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/navbar/event_hub.svg" class="nav-icon" alt="Event Hub">
          </div>
          <span data-translate="navigation.event_hub">Event Hub</span>
        </a>
      </nav>
    </aside>
    <script>
    (function() {
      const sidebar = document.querySelector('.sidebar');
      const navMenu = document.querySelector('.nav-menu');
      const toggleButton = document.querySelector('.list-button');
      const navItems = document.querySelectorAll('.nav-menu .nav-item');
      const icons = document.querySelectorAll('.nav-menu .nav-icon');

      // Sidebar toggle
      if (sidebar && toggleButton) {
        toggleButton.addEventListener('click', () => {
          const isOpenNow = sidebar.classList.toggle('open');
          if (navMenu) navMenu.classList.toggle('nav-menu-open', isOpenNow);
          navItems.forEach(item => item.classList.toggle('nav-item-open', isOpenNow));
          toggleButton.classList.toggle('nav-item-open-list', isOpenNow);
          icons.forEach(iconEl => iconEl.classList.toggle('nav-icon-open', isOpenNow));

          // Toggle menu icon src
          const icon = toggleButton.querySelector('.nav-icon');
          if (icon) {
            icon.src = isOpenNow ? '/EU2K-Hub/assets/navbar/menu_open.svg' : '/EU2K-Hub/assets/navbar/menu.svg';
          }
        });
      }

      // Update icons based on existing "active" class
      function updateNavIcons() {
        document.querySelectorAll('.nav-item:not(.list-button) .nav-icon').forEach(img => {
          const item = img.closest('.nav-item');
          if (!item) return;

          const isActive = item.classList.contains('active'); // csak olvassuk
          const src = img.getAttribute('src') || '';
          if (src.includes('/assets/navbar/')) {
            if (isActive && !src.includes('/assets/navbar/filled/')) {
              img.setAttribute('src', src.replace('/assets/navbar/', '/assets/navbar/filled/'));
            } else if (!isActive && src.includes('/assets/navbar/filled/')) {
              img.setAttribute('src', src.replace('/assets/navbar/filled/', '/assets/navbar/'));
            }
          }
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        // markActiveNavItem() elt√°vol√≠tva, mert nem akarjuk piszk√°lni az "active"-ot
        updateNavIcons(); 
      });

    })();
    </script>
    <main class="main-area">
      <div class="main-content">
        <header class="header">
          <div class="welcome-container">
            <img src="/EU2K-Hub/assets/welcome_hand_icon.svg" class="welcome-icon" alt="Welcome">
            <span class="welcome-text" data-translate="pages.index.welcome"
              data-translate-fallback="√údv√∂z√∂llek a Hub-ban!">√údv√∂z√∂llek a Hub-ban!</span>
          </div>
          <div class="header-icons">
            <a href="/EU2K-Hub/system/account.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/account_icon.svg" class="header-icon" alt="Account">
            </a>
            <a href="/EU2K-Hub/settings/settings.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/settings_icon.svg" class="header-icon" alt="Settings">
            </a>
          </div>
        </header>
        <section class="events-section">
          <div class="section-title-top">
            <span data-translate="pages.index.upcoming_events" data-translate-fallback="K√∂zelg≈ë Esem√©nyek">K√∂zelg≈ë
              Esem√©nyek</span>
            <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>
          <div class="event-frame">
            <div class="top-cards-row">
              <!-- Medium 1 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Large 1 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Large 2 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Large 3 -->
              <div class="event-container">
                <div class="red-card large"></div>
                <div class="event-label">
                  <div class="event-label-text">
                    <span>Esem√©ny neve</span>
                    <span class="desc">Esem√©ny le√≠r√°sa</span>
                    <span class="place">Esem√©ny Helye</span>
                  </div>
                  <div class="arrow-container">
                    <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
                  </div>
                </div>
              </div>

              <!-- Medium 2 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Medium 3 -->
              <div class="event-container">
                <div class="red-card medium"></div>
              </div>

              <!-- Small -->
              <div class="event-container">
                <div class="red-card small"></div>
              </div>

            </div>
          </div>
        </section>
        <section class="news-section">
          <div class="section-title">
            <span data-translate="pages.index.news" data-translate-fallback="H√≠rek">H√≠rek</span>
            <img src="/EU2K-Hub/assets/arrow_forward.svg" class="arrow-icon" alt="Tov√°bb">
          </div>

          <!-- carousel wrapper -->
          <div class="news-carousel">
            <button class="carousel-btn left" id="newsLeftBtn">‚Äπ</button>

            <div class="bottom-cards-row" id="newsRow">
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
              <div class="news-card">
                <div class="red-rect"></div>
                <div class="news-label"><span>Title</span><span class="desc">Description</span></div>
              </div>
            </div>

            <button class="carousel-btn right" id="newsRightBtn">‚Ä∫</button>
          </div>
          
        </section>
      </div>
      <div id="site-footer" class="footer" aria-label="Site footer">
        <div class="footer-container">
          <div class="footer-left">
            <img src="/EU2K-Hub/eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
          </div>
          <div class="footer-center">
            <a class="footer-privacy" data-translate="pages.index.privacy_policy" href="/EU2K-Hub/privacy_policy.html">Adatkezel√©si T√°j√©koztat√≥</a>
            <a class="footer-privacy" data-translate="pages.index.terms_of_service" href="/EU2K-Hub/terms_of_service.html">Haszn√°lati Felt√©telek</a>
          </div>
          <div class="footer-right">
            <img src="/EU2K-Hub/eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
            <img src="/EU2K-Hub/eu2k_dok_logo_hor_dark_smoller_by_width.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
          </div>
        </div>
      </div>
    </main>
  </div>
  <div id="event-mask"></div>

  <script>
    // Check if user has accepted terms of service and redirect to appropriate onboarding
    document.addEventListener('DOMContentLoaded', () => {
      // FIRST: Check if user is already logged in and has completed onboarding
      const isLoggedIn = localStorage.getItem('eu2k-auth-logged-in') === 'true';
      const onboardingCompleted = localStorage.getItem('onboardingCompleted') === 'true';
      const termsAccepted = localStorage.getItem('termsAccepted') === 'true';
      
      console.log('üîç Index.html redirect check:', {
        isLoggedIn,
        onboardingCompleted,
        termsAccepted
      });
      
      // If user is logged in and onboarding is completed, stay on index.html
      if (isLoggedIn && onboardingCompleted && termsAccepted) {
        console.log('‚úÖ User is fully set up, staying on index.html');
        // Mark as visited to prevent welcome screen redirect
        if (window.welcomeScreenManager) {
          window.welcomeScreenManager.markAsVisited();
        }
        return;
      }
      
      // Only redirect to onboarding if terms are not accepted
      if (termsAccepted !== 'true') {
        console.log('üìã Terms not accepted, redirecting to onboarding...');
        
        const userType = localStorage.getItem('eu2k-user-type');
        
        if (isLoggedIn && userType) {
          // Redirect to appropriate onboarding based on user type
          switch (userType) {
            case 'student':
              window.location.href = '/EU2K-Hub/welcome/onboarding_student.html#student-profile';
              break;
            case 'parent':
              window.location.href = '/EU2K-Hub/welcome/onboarding_parent.html#parent-profile';
              break;
            case 'teacher':
              window.location.href = '/EU2K-Hub/welcome/onboarding_teacher.html#teacher-profile';
              break;
            default:
              // Default to student onboarding if user type is unknown
              window.location.href = '/EU2K-Hub/welcome/onboarding_student.html';
          }
        } else {
          // Not logged in, redirect to default student onboarding
          window.location.href = '/EU2K-Hub/welcome/onboarding_student.html';
        }
      }
    });
  </script>
</body>

</html>