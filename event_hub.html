<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="√ñr√ºl√ºnk hogy ennyire √©rdekl≈ëdsz a Kurzusok ir√°nt, de egyel≈ëre m√©g fejleszt√©s alatt van, √©s nem alkalmas a mostani √°llapot√°ban a haszn√°latra. N√©zz vissza k√©s≈ëbb üëã">

  <title data-translate="pages.event_hub.title">Event Hub</title>
  <link rel="stylesheet" href="event_hub.css">
  <link rel="icon" href="/EU2K-Hub/favicon.ico">
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import { styles as typescaleStyles } from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script src="/EU2K-Hub/assets/js/permissions.js"></script>
  <script src="/EU2K-Hub/assets/js/translations.js"></script>
  <script src="/EU2K-Hub/assets/js/welcome-screen.js"></script>
  <script src="/EU2K-Hub/assets/js/auth-state.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBRRVx6BtQtCDKjFYA8yh9qYrcUONmkkwI",
      authDomain: "eu2k-hub.firebaseapp.com",
      projectId: "eu2k-hub",
      storageBucket: "eu2k-hub.firebasestorage.app",
      messagingSenderId: "560244867055",
      appId: "1:560244867055:web:3cd51b85baead94989001a",
      measurementId: "G-2JDPR089WD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    enableIndexedDbPersistence(db).catch((err) => {
      if (err.code == 'failed-precondition') {
        console.log("T√∂bb tab nyitva, nem lehet offline m√≥dban persist√°lni");
      } else if (err.code == 'unimplemented') {
        console.log("A b√∂ng√©sz≈ë nem t√°mogatja az offline persistenci√°t");
      }
    });

    // Make db globally available
    window.db = db;

    // Load featured event data
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    
    async function loadFeaturedEvent() {
       try {
         const docRef = doc(db, 'event_hub', 'featured');
         const docSnap = await getDoc(docRef);
         
         if (docSnap.exists()) {
           const data = docSnap.data();
           
           // Update title
           if (data.title) {
             document.getElementById('featured-title').textContent = data.title;
           }
           
           // Update subtitle with desc
           if (data.desc) {
             let descText = data.desc;
             if (descText.length > 50) {
               // Find the best break point around 50 characters
               let firstLine = descText.substring(0, 50);
               let lastSpaceIndex = firstLine.lastIndexOf(' ');
               
               if (lastSpaceIndex > 30) {
                 firstLine = descText.substring(0, lastSpaceIndex);
                 let secondLine = descText.substring(lastSpaceIndex + 1);
                 
                 if (secondLine.length > 50) {
                   secondLine = secondLine.substring(0, 47) + '...';
                 }
                 
                 descText = firstLine + '\n' + secondLine;
               } else {
                 // If no good break point, just cut at 47 and add ...
                 descText = descText.substring(0, 47) + '...';
               }
             }
             
             document.getElementById('featured-subtitle').innerHTML = descText.replace(/\n/g, '<br>');
           }
           
           // Update image if imageURL is not empty
           if (data.imageURL && data.imageURL.trim() !== '') {
             document.getElementById('featured-image').src = data.imageURL;
           }
           
           // Store joinCode for later use
           if (data.joinCode) {
             window.featuredEventJoinCode = data.joinCode;
           }
         } else {
           console.log('No featured event data found, creating sample data...');
           // Create sample data for testing
           const sampleData = {
             title: 'Kiemelt Esem√©ny',
             desc: 'Ez egy hosszabb teszt esem√©ny le√≠r√°sa, amely meghaladja az √∂tven karaktert √©s demonstr√°lja a sort√∂r√©s funkcionalit√°st',
             joinCode: 'TEST123',
             imageURL: 'https://picsum.photos/800/400'
           };
           
           await setDoc(docRef, sampleData);
           console.log('Sample data created, reloading...');
           
           // Update UI with sample data
           document.getElementById('featured-title').textContent = sampleData.title;
           
           // Apply same desc formatting for sample data
           let descText = sampleData.desc;
           if (descText.length > 50) {
             let firstLine = descText.substring(0, 50);
             let lastSpaceIndex = firstLine.lastIndexOf(' ');
             
             if (lastSpaceIndex > 30) {
               firstLine = descText.substring(0, lastSpaceIndex);
               let secondLine = descText.substring(lastSpaceIndex + 1);
               
               if (secondLine.length > 50) {
                 secondLine = secondLine.substring(0, 47) + '...';
               }
               
               descText = firstLine + '\n' + secondLine;
             } else {
               descText = descText.substring(0, 47) + '...';
             }
           }
           
           document.getElementById('featured-subtitle').innerHTML = descText.replace(/\n/g, '<br>');
           document.getElementById('featured-image').src = sampleData.imageURL;
           window.featuredEventJoinCode = sampleData.joinCode;
         }
       } catch (error) {
         console.error('Error loading featured event:', error);
       }
     }
    
    // Load data when page loads
    document.addEventListener('DOMContentLoaded', loadFeaturedEvent);

    // Import Firestore debug module
    import('./assets/js/firestore-debug.js').catch(err => {
      console.warn('Firestore debug module not loaded:', err);
    });
  </script>
</head>

<body>
  <div class="app-bg">
    <aside class="sidebar">
      <nav class="nav-menu">
        <a class="nav-item" href="index.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/home_icon.svg" class="nav-icon" alt="Otthon">
          </div>
          <span data-translate="navigation.home">Otthon</span>
        </a>
        <a class="nav-item" href="qr-code.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/qr_code_icon.svg" class="nav-icon" alt="QR-K√≥d">
          </div>
          <span data-translate="navigation.qr">QR-K√≥d</span>
        </a>
        <a class="nav-item" href="youhub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/youhub_icon.svg" class="nav-icon" alt="YouHub">
          </div>
          <span data-translate="navigation.youhub">YouHub</span>
        </a>
        <a class="nav-item active" href="event_hub.html">
          <div class="nav-icon-container">
            <img src="/EU2K-Hub/assets/event_hub_icon.svg" class="nav-icon" alt="Event Hub">
          </div>
          <span data-translate="navigation.event_hub">Event Hub</span>
        </a>
      </nav>
    </aside>
    <main class="main-area">
      <div class="main-content">
        <header class="header">
          <div class="welcome-container">
            <img src="/EU2K-Hub/assets/event_hub_icon.svg" class="event-hub-icon" alt="Event Hub" style="margin-bottom: 4px;">
            <h1 class="event-hub-text" data-translate="pages.event-hub.title" style="margin-top: 0; margin-bottom: 4px;">Event Hub</h1>
            <p class="event-hub-desc" data-translate="pages.event-hub.description">Kiemelt Esem√©ny:</p>
          </div>
          <div class="header-icons">
            <a href="/EU2K-Hub/system/account.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/account_icon.svg" class="header-icon" alt="Account">
            </a>
            <a href="/EU2K-Hub/settings/settings.html" class="header-icon-link">
              <img src="/EU2K-Hub/assets/settings_icon.svg" class="header-icon" alt="Settings">
            </a>
          </div>
        </header>
        <!-- Event Hub layout: Left column highlighted event card -->
         <section class="event-hub-container">
           <div class="event-columns">
             <div class="left-column">
               <article class="featured-event-card" aria-label="Kiemelt esem√©ny">
                <div class="featured-actions">
                  <md-fab id="join-fab" class="join-fab" label="Csatlakoz√°s" aria-label="Csatlakoz√°s">
                    <img src="/EU2K-Hub/assets/event_hub/add_light.svg" alt="Add" class="chip-icon" slot="icon" />
                  </md-fab>
               </div>
                 <div class="featured-background">
                   <img id="featured-image" src="assets/placeholder_img.svg" alt="Esem√©ny k√©p" class="featured-bg-image" />
                   <div class="featured-overlay"></div>
                 </div>
                 <div class="featured-content">
                   <div class="featured-text">
                     <h2 id="featured-title" class="featured-title">Title</h2>
                     <div id="featured-subtitle" class="featured-subtitle">Subtitle</div>
                     <div class="chips-row">
                       <button class="chip" type="button" aria-label="Add to my itinerary">
                         <img src="/EU2K-Hub/assets/event_hub/calendar.svg" alt="napt√°r ikon" class="chip-icon" />
                         <span>Add to my itinerary</span>
                       </button>
                       <div class="chip" aria-label="12 mins from hotel">
                         <img src="/EU2K-Hub/assets/event_hub/walk.svg" alt="s√©ta ikon" class="chip-icon" />
                         <span>12 mins from hotel</span>
                       </div>
                     </div>
                   </div>
                 </div>
               </article>
             </div>
             <div class="right-column">
               <!-- Egyel≈ëre √ºres: csak a bal oldali kiemelt k√°rty√°t k√©sz√≠tj√ºk el -->
             </div>
           </div>
         </section>
         
         <!-- Anim√°lt FAB gomb -->
         <div class="floating-fab" id="floating-fab">
            <span class="fab-text">√öj esem√©ny</span>
            <span class="fab-icon">+</span>
          </div>
         
         <!-- FAB opci√≥k -->
         <div id="fab-options" class="fab-options">
           <div class="fab-option" data-action="event">
             <img src="/EU2K-Hub/assets/event_hub/event.svg" alt="Esem√©ny" class="fab-option-icon" />
             <span>Esem√©ny</span>
           </div>
           <div class="fab-option" data-action="meeting">
             <img src="/EU2K-Hub/assets/event_hub/meeting.svg" alt="Tal√°lkoz√≥" class="fab-option-icon" />
             <span>Tal√°lkoz√≥</span>
           </div>
           <div class="fab-option" data-action="course">
             <img src="/EU2K-Hub/assets/event_hub/courses.svg" alt="Kurzus" class="fab-option-icon" />
             <span>Kurzus</span>
           </div>
         </div>
       </div>
        <div id="site-footer" class="footer" aria-label="Site footer">
        <div class="footer-container">
          <div class="footer-left">
            <img src="/EU2K-Hub/eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
          </div>
          <div class="footer-center">
            <a class="footer-privacy" data-translate="pages.index.privacy_policy" href="/EU2K-Hub/privacy_policy.html">Adatkezel√©si T√°j√©koztat√≥</a>
            <a class="footer-privacy" data-translate="pages.index.terms_of_service" href="/EU2K-Hub/terms_of_service.html">Haszn√°lati Felt√©telek</a>
          </div>
          <div class="footer-right">
            <img src="/EU2K-Hub/eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
            <img src="/EU2K-Hub/eu2k_dok_logo_hor_dark_smoller_by_width.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
          </div>
        </div>
      </div>
    </main>
  </div>
  <div id="event-mask"></div>

  <script>
    // Featured event bet√∂lt√©se Firestore-b√≥l
    async function loadFeaturedEvent() {
      try {
        // Ellen≈ërizz√ºk, hogy a Firebase inicializ√°lva van-e
        if (typeof db === 'undefined') {
          console.warn('Firebase nincs inicializ√°lva, placeholder adatok haszn√°lata');
          return;
        }
        
        const { doc, getDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        
        const featuredDocRef = doc(db, 'event_hub', 'featured');
        const featuredDoc = await getDoc(featuredDocRef);
        
        if (featuredDoc.exists()) {
          const data = featuredDoc.data();
          
          // Adatok friss√≠t√©se
          document.getElementById('featured-title').textContent = data.title || 'Title';
          
          // Apply desc formatting with line breaks
          let descText = data.desc || 'Subtitle';
          if (descText.length > 50) {
            // Find the best break point around 50 characters
            let firstLine = descText.substring(0, 50);
            let lastSpaceIndex = firstLine.lastIndexOf(' ');
            
            if (lastSpaceIndex > 30) {
              firstLine = descText.substring(0, lastSpaceIndex);
              let secondLine = descText.substring(lastSpaceIndex + 1);
              
              if (secondLine.length > 50) {
                secondLine = secondLine.substring(0, 47) + '...';
              }
              
              descText = firstLine + '\n' + secondLine;
            } else {
              // If no good break point, just cut at 47 and add ...
              descText = descText.substring(0, 47) + '...';
            }
          }
          
          document.getElementById('featured-subtitle').innerHTML = descText.replace(/\n/g, '<br>');
          
          if (data.photoURL) {
            document.getElementById('featured-image').src = data.photoURL;
          }
          
          // JoinCode t√°rol√°sa a FAB gombban
          if (data.joinCode) {
            document.getElementById('join-fab').setAttribute('data-join-code', data.joinCode);
          }
        } else {
          console.log('Nincs featured event dokumentum, placeholder adatok haszn√°lata');
        }
      } catch (error) {
        console.error('Hiba a featured event bet√∂lt√©sekor:', error);
        console.log('Placeholder adatok haszn√°lata');
      }
    }
    
    // FAB gomb anim√°ci√≥k
    let fabExpanded = false;
    
    function initializeFAB() {
      const floatingFab = document.getElementById('floating-fab');
      const fabOptions = document.getElementById('fab-options');
      const fabIcon = floatingFab.querySelector('.fab-icon');
      const fabText = floatingFab.querySelector('.fab-text');
      
      floatingFab.addEventListener('click', () => {
        if (!fabExpanded) {
          // Kinyit√°s
          fabExpanded = true;
          floatingFab.classList.add('expanded');
          fabOptions.classList.add('visible');
          fabIcon.textContent = '√ó';
        } else {
          // Bez√°r√°s
          closeFAB();
        }
      });
      
      // Opci√≥k kezel√©se
      const options = document.querySelectorAll('.fab-option');
      options.forEach(option => {
        option.addEventListener('click', (e) => {
          const action = e.currentTarget.getAttribute('data-action');
          console.log('FAB opci√≥ kiv√°lasztva:', action);
          // Itt k√©s≈ëbb hozz√°adhat√≥k a specifikus m≈±veletek
        });
      });
    }
    
    function closeFAB() {
      const floatingFab = document.getElementById('floating-fab');
      const fabOptions = document.getElementById('fab-options');
      const fabIcon = floatingFab.querySelector('.fab-icon');
      
      fabExpanded = false;
      floatingFab.classList.remove('expanded');
      fabOptions.classList.remove('visible');
      fabIcon.textContent = '+';
    }
    
    // Join FAB kezel√©se
    function initializeJoinFAB() {
      const joinFab = document.getElementById('join-fab');
      joinFab.addEventListener('click', () => {
        const joinCode = joinFab.getAttribute('data-join-code');
        if (joinCode) {
          // √Åtir√°ny√≠t√°s a join URL-re
          window.location.href = `/EU2K-Hub/joinURL?id=${joinCode}`;
        } else {
          console.warn('Nincs join k√≥d be√°ll√≠tva');
        }
      });
    }
    
    // Inicializ√°l√°s oldal bet√∂lt√©sekor
    document.addEventListener('DOMContentLoaded', () => {
      loadFeaturedEvent();
      initializeFAB();
      initializeJoinFAB();
    });
    
    // Feedback gomb √©s popup kezel√©se
    const feedbackButton = document.querySelector('.feedback-button'); // Changed to querySelector
    const feedbackPopup = document.getElementById('feedbackPopup');

    if (feedbackButton && feedbackPopup) {
      // Feedback popup megnyit√°sa
      feedbackButton.addEventListener('click', () => {
        feedbackPopup.style.display = 'flex';
        feedbackPopup.classList.remove('closing');
      });

      // Popup bez√°r√°sa overlay-re kattint√°skor
      feedbackPopup.addEventListener('click', (e) => {
        if (e.target === feedbackPopup) {
          closeFeedbackPopup();
        }
      });
    }

    // Bez√°r√≥ f√ºggv√©ny anim√°ci√≥val
    function closeFeedbackPopup() {
      const feedbackPopup = document.getElementById('feedbackPopup');
      if (feedbackPopup) {
        feedbackPopup.classList.add('closing');
        setTimeout(() => {
          feedbackPopup.style.display = 'none';
          feedbackPopup.classList.remove('closing');
        }, 300); // 300ms anim√°ci√≥ ut√°n bez√°r√°s
      }
    }

    // Kateg√≥ria gombok kezel√©se
    const feedbackCategoryBtns = document.querySelectorAll('.feedback-category-btn');
    feedbackCategoryBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // Elt√°vol√≠tjuk az active oszt√°lyt minden gombr√≥l
        feedbackCategoryBtns.forEach(b => b.classList.remove('active'));
        // Hozz√°adjuk az active oszt√°lyt az aktu√°lis gombhoz
        btn.classList.add('active');
      });
    });

    // Feedback bek√ºld√©s f√ºggv√©ny
    async function submitFeedback() {
      try {
        // Form adatok √∂sszegy≈±jt√©se
        const titleInput = document.querySelector('.feedback-title-input');
        const descriptionInput = document.querySelector('.feedback-input');
        const activeCategory = document.querySelector('.feedback-category-btn.active');

        // Valid√°ci√≥
        if (!titleInput.value.trim()) {
          showToast('K√©rlek add meg a c√≠met!', 'error');
          return;
        }
        if (!descriptionInput.value.trim()) {
          showToast('K√©rlek √≠rj le valamit!', 'error');
          return;
        }
        if (!activeCategory) {
          showToast('K√©rlek v√°lassz kateg√≥ri√°t!', 'error');
          return;
        }

        // Kateg√≥ria meghat√°roz√°sa
        const categoryData = activeCategory.getAttribute('data-category');
        const collectionName = categoryData === 'function' ? 'fix_things' : 'new_recommendations';

        // Firestore v9 f√ºggv√©nyek import√°l√°sa
        const { collection, doc, getDocs, setDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");

        // K√∂vetkez≈ë dokumentum ID meghat√°roz√°sa
        const collectionRef = collection(db, 'homePageData', 'feedback', collectionName);
        const snapshot = await getDocs(collectionRef);

        let nextId = 1;
        if (!snapshot.empty) {
          const docIds = snapshot.docs.map(docSnapshot => parseInt(docSnapshot.id)).filter(id => !isNaN(id));
          if (docIds.length > 0) {
            nextId = Math.max(...docIds) + 1;
          }
        }

        // √öj feedback dokumentum l√©trehoz√°sa
        const feedbackData = {
          title: titleInput.value.trim(),
          description: descriptionInput.value.trim(),
          class: '8.E', // Hardcoded am√≠g nincs Firebase Auth - ut√°na jobDescription lesz
          timestamp: serverTimestamp()
        };

        const newDocRef = doc(collectionRef, nextId.toString());
        await setDoc(newDocRef, feedbackData);

        // Sikeres bek√ºld√©s - toast megjelen√≠t√©se
        showToast('‚úì Sikeresen bek√ºldted a visszajelz√©st!', 'success');

        // Form resetel√©se
        titleInput.value = '';
        descriptionInput.value = '';

        // Popup bez√°r√°sa
        closeFeedbackPopup();

      } catch (error) {
        console.error('Hiba a feedback bek√ºld√©sekor:', error);
        showToast('Hiba t√∂rt√©nt a bek√ºld√©s sor√°n. Pr√≥b√°ld √∫jra!', 'error');
      }
    }

    // √Åltal√°nos toast megjelen√≠t≈ë f√ºggv√©ny
    function showToast(message, type = 'success') {
      // Megl√©v≈ë toast elt√°vol√≠t√°sa
      const existingToast = document.querySelector('.feedback-toast');
      if (existingToast) {
        existingToast.remove();
      }

      // √öj toast l√©trehoz√°sa
      const toast = document.createElement('div');
      toast.className = `feedback-toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      // Megjelen√≠t√©s
      setTimeout(() => toast.classList.add('show'), 10);

      // 3 m√°sodperc ut√°n elt≈±nik
      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');

        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 3000);
    }
  </script>
  <div id="site-footer" class="footer" aria-label="Site footer">
    <div class="footer-container">
      <div class="footer-left">
        <img src="/EU2K-Hub/eu2k_hub_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Hub Log√≥">
      </div>
      <div class="footer-center">
        <a class="footer-privacy" data-translate="pages.index.privacy_policy" href="/EU2K-Hub/privacy_policy.html">Adatkezel√©si T√°j√©koztat√≥</a>
            <a class="footer-privacy" data-translate="pages.index.terms_of_service" href="/EU2K-Hub/terms_of_service.html">Haszn√°lati Felt√©telek</a>
      </div>
      <div class="footer-right">
        <img src="/EU2K-Hub/eu2k_devs_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K Devs Log√≥">
        <img src="/EU2K-Hub/eu2k_dok_logo_hor_dark.png" class="footer-logo-wide" alt="EU2K D√ñK Log√≥">
      </div>
    </div>
  </div>
</body>

</html>